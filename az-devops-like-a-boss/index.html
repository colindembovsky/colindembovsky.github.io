<!DOCTYPE html>
<html lang="en"><head><title>az devops cli like a boss | Colin’s ALM Corner</title><meta name="generator" content="Jekyll v3.9.0" /><meta property="og:title" content="az devops cli like a boss" /><meta name="author" content="Colin Dembovsky" /><meta property="og:locale" content="en" /><meta name="description" content="One of the best features of Azure DevOps is the extensive API. However, while having a REST API is great, interacting with a service at HTTP level can be frustrating. In this post, I examine the az devops cli using 10 practical examples." /><meta property="og:description" content="One of the best features of Azure DevOps is the extensive API. However, while having a REST API is great, interacting with a service at HTTP level can be frustrating. In this post, I examine the az devops cli using 10 practical examples." /><link rel="canonical" href="https://github.com/pages/colindembovsky/az-devops-like-a-boss/" /><meta property="og:url" content="https://github.com/pages/colindembovsky/az-devops-like-a-boss/" /><meta property="og:site_name" content="Colin’s ALM Corner" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-07-20T19:59:14+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="az devops cli like a boss" /><meta name="twitter:site" content="@colindembovsky" /><meta name="twitter:creator" content="@colindembovsky" /> <script type="application/ld+json"> {"description":"One of the best features of Azure DevOps is the extensive API. However, while having a REST API is great, interacting with a service at HTTP level can be frustrating. In this post, I examine the az devops cli using 10 practical examples.","url":"https://github.com/pages/colindembovsky/az-devops-like-a-boss/","@type":"BlogPosting","headline":"az devops cli like a boss","dateModified":"2020-07-20T19:59:14+00:00","datePublished":"2020-07-20T19:59:14+00:00","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://github.com/pages/colindembovsky/assets/img/logo.png"},"name":"Colin Dembovsky"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://github.com/pages/colindembovsky/az-devops-like-a-boss/"},"author":{"@type":"Person","name":"Colin Dembovsky"},"@context":"https://schema.org"}</script><meta name="keywords" content="devops,github,actions,build,ci,cd"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Colin's ALM Corner"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="application-name" content="Colin's ALM Corner"><meta name="theme-color" content="rgb(5,19,24)"><meta name="generator" content="Hydejack v9.1.4" /><link rel="alternate" href="https://github.com/pages/colindembovsky/az-devops-like-a-boss/" hreflang="en"><link type="application/atom+xml" rel="alternate" href="https://github.com/pages/colindembovsky/feed.xml" title="Colin's ALM Corner" /><link rel="shortcut icon" href="/pages/colindembovsky/assets/icons/favicon.ico"><link rel="apple-touch-icon" href="/pages/colindembovsky/assets/icons/icon-192x192.png"><link rel="manifest" href="/pages/colindembovsky/assets/site.webmanifest"><link rel="dns-prefetch" href="https://fonts.googleapis.com"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preload" href="/pages/colindembovsky/assets/img/swipe.svg" as="image" id="_hrefSwipeSVG"><link rel="dns-prefetch" href="/pages/colindembovsky/assets/js/search-worker-9.1.4.js" as="worker" id="_hrefSearch"> <script>!function(r,c){"use strict";function a(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}r.loadJS=function(e,t){var n=c.createElement("script");n.src=e,t&&a(n,"load",t,{once:!0});t=c.scripts[0];return t.parentNode.insertBefore(n,t),n},r._loaded=!1,r.loadJSDeferred=function(e,t){var n=c.createElement("script");function o(){r._loaded=!0,t&&a(n,"load",t,{once:!0});var e=c.scripts[0];e.parentNode.insertBefore(n,e)}return n.src=e,r._loaded?o():a(r,"load",o,{once:!0}),n},r.setRel=r.setRelStylesheet=function(e){a(c.getElementById(e),"load",function(){this.rel="stylesheet"},{once:!0})}}(window,document); !function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this); !function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this); !function(w) { w._baseURL = '/pages/colindembovsky/'; w._publicPath = '/pages/colindembovsky/assets/js/'; w._noPushState = false; w._noDrawer = false; w._noNavbar = false; w._noToc = false; w._noSearch = false; w._advertise = false; w._search = { DATA_URL: '/pages/colindembovsky/assets/sitedata.json?no-cache', STORAGE_KEY: 'mini-search/pages/colindembovsky/', INDEX_KEY: 'index--2021-11-18T20:23:33+00:00', }; w._clapButton = false; }(window);</script> <script async src="/pages/colindembovsky/assets/bower_components/MathJax/es5/tex-mml-chtml.js" id="_MathJax"></script> <!--[if gt IE 8]><!----><style id="_styleInline"> .clearfix,.sidebar-social::after{content:"";display:table;clear:both}.color-transition,body,p,hr,.hr,.hr-after::after,.hr-bottom,.message,.note-sm,.note,#markdown-toc,.navbar,.nav-btn-bar,.nav-btn,.content .avatar{transition:none}#_dark-mode{font-size:1.25rem}@media screen{body.light-mode{--body-color: #333;--body-bg: #fff;--border-color: #ebebeb;--gray: #777;--gray-bg: rgba(0,0,0,0.025);--gray-text: #666;--menu-text: #bbb;--inv-body-color: #ccc;--inv-body-bg: var(--dark-mode-body-bg)}body.light-mode .content{-webkit-font-smoothing:initial;-moz-osx-font-smoothing:initial}body.dark-mode{--body-color: #ccc;--body-bg: var(--dark-mode-body-bg);--border-color: var(--dark-mode-border-color);--gray: rgba(255,255,255,.5);--gray-bg: rgba(255,255,255,.033);--gray-text: rgba(255,255,255,.625);--menu-text: rgba(255,255,255,.25);--inv-body-color: #333;--inv-body-bg: #fff}body.dark-mode .content{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media screen and (prefers-color-scheme: dark){body{--body-color: #ccc;--body-bg: var(--dark-mode-body-bg);--border-color: var(--dark-mode-border-color);--gray: rgba(255,255,255,.5);--gray-bg: rgba(255,255,255,.033);--gray-text: rgba(255,255,255,.625);--menu-text: rgba(255,255,255,.25);--inv-body-color: #333;--inv-body-bg: #fff}body .content{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.tippy-content{-webkit-font-smoothing:initial;-moz-osx-font-smoothing:initial}}html{--font-family: Noto Sans,Helvetica,Arial,sans-serif;--font-family-heading: Roboto Slab,Helvetica,Arial,sans-serif;--code-font-family: Fira Code,Menlo,Monaco,Consolas,monospace;--body-color: #333;--body-bg: #fff;--border-color: #ebebeb;--gray: #777;--gray-bg: rgba(0,0,0,0.025);--gray-text: #666;--menu-text: #bbb;--inv-body-color: #ccc;--inv-body-bg: var(--dark-mode-body-bg);--root-font-size: 15px;--root-font-size-medium: 16px;--root-font-size-large: 17px;--root-font-size-print: 8pt;--root-line-height: 1.75;--font-weight: 400;--font-weight-bold: 700;--font-weight-heading: 700;--content-width-5: 54rem;--content-margin-5: 4rem;--sidebar-width: 21rem;--half-content: 31rem;--break-point-3: 64em;--break-point-5: 86em;--break-point-dynamic: 1664px}html .content{-webkit-font-smoothing:initial;-moz-osx-font-smoothing:initial}*{box-sizing:border-box}html,body{margin:0;padding:0}html{font-family:var(--font-family);font-size:var(--root-font-size);line-height:var(--root-line-height)}body{color:var(--body-color);background-color:var(--body-bg);font-weight:var(--font-weight);overflow-y:scroll}.content img,.img,.content video,.video{max-width:100%;height:auto}.lead{margin-left:-1rem;margin-right:-1rem;margin-bottom:1.5rem}img.lead,video.lead{display:block;max-width:calc(100% + 2rem);width:calc(100% + 2rem);height:auto}.heading,.f1,h1,.h1,.f2,h2,.h2,.f3,h3,.h3,.f4,h4,.h4,.post-date,.sidebar-nav-item,.f5,h5,.h5,.f6,h6,.h6{font-family:var(--font-family-heading);font-weight:var(--font-weight-heading)}.f1,h1,.h1{font-size:2rem;line-height:1.3}.f2,h2,.h2{font-size:1.5rem;line-height:1.4}.f3,h3,.h3{font-size:1.2em;line-height:1.5}.f4,h4,.h4,.post-date,.sidebar-nav-item{font-size:1.08rem;line-height:1.6}.f5,h5,.h5{font-size:1.04rem;line-height:1.7}.f6,h6,.h6{font-size:1rem}.content h1>a,.content .h1>a{text-decoration:none;border-bottom:none}@media screen and (max-width: 42em){.content h1,.content .h1{font-size:1.7rem;line-height:1.35}}@media screen and (min-width: 86em){.content h1,.content .h1{font-size:2.4rem;line-height:1.25}}@media screen and (min-width: 1664px){body:not(.no-large-headings) .content h1,body:not(.no-large-headings) .content .h1{width:calc(100% + 50vw - 32rem);font-size:3rem;line-height:1.2}}@media screen and (min-width: 124em){body:not(.no-large-headings) .content h1,body:not(.no-large-headings) .content .h1{font-size:4rem;line-height:1.1}}h1,h2,h3,.h1,.h2,.h3{margin:4rem 0 1rem}h4,h5,h6,.h4,.post-date,.h5,.h6{margin:3rem 0 .5rem}p{margin-top:0;margin-bottom:1rem}p.lead{font-size:1.2em;margin-top:1.5rem;margin-bottom:1.5rem;padding:0 1rem}ul,ol,dl{margin-top:0;margin-bottom:1rem}ul,ol{padding-left:1.25rem}hr,.hr{border:0;margin:1rem 0;border-top:1px solid var(--border-color)}.hr-after::after{content:"";display:block;margin:1rem 0;border-top:1px solid var(--border-color)}.hr-bottom{border-bottom:1px solid var(--border-color);padding-bottom:.75rem;margin-bottom:1rem}.page{margin-bottom:3em}.page li+li{margin-top:.25rem}.page>header{position:relative;margin-bottom:1.5rem}@media screen and (min-width: 1664px){body:not(.no-third-column) .page>header>.lead+.note-sm,body:not(.no-third-column) .page>header>.lead+.note,body:not(.no-third-column) .page>header>.lead+#markdown-toc,body:not(.no-third-column) .page>header>a.no-hover+.note-sm,body:not(.no-third-column) .page>header>a.no-hover+.note,body:not(.no-third-column) .page>header>a.no-hover+#markdown-toc{position:absolute;right:-25rem;width:21rem;bottom:0;margin-bottom:0}}.page-title,.post-title{margin-top:0}.post-date{display:flex;justify-content:space-between;margin-top:-.6rem;height:2rem;margin-bottom:.85rem;color:var(--gray)}.post-date>.ellipsis,#breadcrumbs.post-date>ul{cursor:pointer}.post-date [class^="icon-"]{display:inline-block;font-size:smaller;margin-right:.25rem}.related-posts{padding-left:0;list-style:none;margin-bottom:2rem}.related-posts>li,.related-posts>li+li{margin-top:1rem}.message,.note-sm,.note,#markdown-toc{margin-bottom:1rem;padding:1rem;color:var(--gray-text);background-color:var(--gray-bg);margin-left:-1rem;margin-right:-1rem}.note-sm,.note,#markdown-toc{background:transparent;color:var(--body-color);font-size:smaller;border-left:1px solid var(--border-color);padding:1.2rem 1rem 0 1rem;margin:1rem -1rem;position:relative}.note-sm:before,.note:before,#markdown-toc:before{font-size:0.667rem;font-weight:bold;font-style:normal;letter-spacing:.025rem;text-transform:uppercase;color:var(--menu-text);position:absolute;top:0}.note-sm[title]:before,[title].note:before,[title]#markdown-toc:before{content:attr(title) !important}.note{font-size:1rem}@media screen{body::before{content:'';width:.5rem;background:var(--gray-bg);position:fixed;left:0;top:0;bottom:0}}@media (min-width: 64em){body::before{width:21rem}}@media (min-width: 1664px){body::before{width:calc(50% - 31rem)}}@media screen and (min-width: 42em){html{font-size:var(--root-font-size-medium)}}@media screen and (min-width: 124em){html{font-size:var(--root-font-size-large)}}#breadcrumbs>ul{height:1rem;margin:-1.5rem 0 .5rem;padding:0;font-size:.667rem;color:var(--menu-text);text-transform:uppercase;width:100%;list-style:none}#breadcrumbs>ul>li{display:inline}#breadcrumbs>ul>li a{color:var(--gray);text-decoration:none;border-bottom:none}.fl{float:left}.fr{float:right}.mb4{margin-bottom:4rem}.mb6{margin-bottom:6rem}.mt0{margin-top:0}.mt1{margin-top:1rem}.mt2{margin-top:2rem}.mt3{margin-top:3rem}.mt4{margin-top:4rem}.pb0{padding-bottom:0}.ml1{margin-left:1rem}.mr1{margin-right:1rem}.sixteen-nine{position:relative}.sixteen-nine::before{display:block;content:"";width:100%;padding-top:56.25%}.sixteen-nine>*{position:absolute;top:0;left:0;right:0;bottom:0}.sixteen-ten{position:relative}.sixteen-ten::before{display:block;content:"";width:100%;padding-top:62.5%}.sixteen-ten>*{position:absolute;top:0;left:0;right:0;bottom:0}.four-three{position:relative}.four-three::before{display:block;content:"";width:100%;padding-top:75%}.four-three>*{position:absolute;top:0;left:0;right:0;bottom:0}.sr-only{display:none}.larger{font-size:larger}.smaller{font-size:smaller}.clearfix,.sidebar-social::after{content:"";display:table;clear:both}.ellipsis,#breadcrumbs>ul{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.border{border:1px solid var(--border-color)}@media (min-width: 42em){.border-radius,.lead,.page .aspect-ratio.sixteen-nine.lead{border-radius:.5rem}}.fallback-img{background-position:center;background-repeat:no-repeat;background-image:url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB3aWR0aD0iMTYwIiBoZWlnaHQ9IjkwIiB2aWV3Qm94PSIwIDAgMTYwIDkwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxnIHRyYW5zZm9ybT0ibWF0cml4KDAuMDQ4ODI4LCAwLCAwLCAwLjA0Nzk5MSwgNTQuOTk5OTczLCAyMC40MjgxNDgpIj4KICAgIDxwYXRoIHN0eWxlPSJmaWxsOnJnYmEoMTI4LDEyOCwxMjgsLjMzKSIgZD0iTTk1OS44ODQgMTI4YzAuMDQwIDAuMDM0IDAuMDgyIDAuMDc2IDAuMTE2IDAuMTE2djc2Ny43N2MtMC4wMzQgMC4wNDAtMC4wNzYgMC4wODItMC4xMTYgMC4xMTZoLTg5NS43N2MtMC4wNDAtMC4wMzQtMC4wODItMC4wNzYtMC4xMTQtMC4xMTZ2LTc2Ny43NzJjMC4wMzQtMC4wNDAgMC4wNzYtMC4wODIgMC4xMTQtMC4xMTRoODk1Ljc3ek05NjAgNjRoLTg5NmMtMzUuMiAwLTY0IDI4LjgtNjQgNjR2NzY4YzAgMzUuMiAyOC44IDY0IDY0IDY0aDg5NmMzNS4yIDAgNjQtMjguOCA2NC02NHYtNzY4YzAtMzUuMi0yOC44LTY0LTY0LTY0djB6Ii8+CiAgICA8cGF0aCBzdHlsZT0iZmlsbDpyZ2JhKDEyOCwxMjgsMTI4LC4zMykiIGQ9Ik04MzIgMjg4YzAgNTMuMDIwLTQyLjk4IDk2LTk2IDk2cy05Ni00Mi45OC05Ni05NiA0Mi45OC05NiA5Ni05NiA5NiA0Mi45OCA5NiA5NnoiLz4KICAgIDxwYXRoIHN0eWxlPSJmaWxsOnJnYmEoMTI4LDEyOCwxMjgsLjMzKSIgZD0iTTg5NiA4MzJoLTc2OHYtMTI4bDIyNC0zODQgMjU2IDMyMGg2NGwyMjQtMTkyeiIvPgogIDwvZz4KPC9zdmc+")}hy-push-state a{color:var(--body-color)}@supports not ((text-decoration-thickness: initial) and (text-underline-offset: initial)){hy-push-state a{text-decoration:none;border-bottom:2px solid}}@supports (text-decoration-thickness: initial) and (text-underline-offset: initial){hy-push-state a{text-decoration-style:solid;text-underline-offset:.35rem;text-decoration-thickness:2px}}hy-push-state a.no-hover{border-bottom:none;text-decoration-thickness:unset;text-underline-offset:unset}.content a:not(.btn):not(.no-hover){border-color:var(--accent-color-faded)}@supports (text-decoration-thickness: initial) and (text-underline-offset: initial){.content a:not(.btn):not(.no-hover){text-decoration-color:var(--accent-color-faded)}}.content .aspect-ratio{overflow:hidden}.content .aspect-ratio img{margin:0;width:100%;height:100%;background-color:var(--gray-bg)}hy-drawer{width:100%;position:relative;overflow:hidden;display:block;z-index:4}@media screen and (min-width: 64em){hy-drawer{position:fixed;width:21rem;top:0;left:0;bottom:0;margin-left:0}hy-drawer.cover{position:relative;width:100%}}@media screen and (min-width: 1664px){hy-drawer{width:calc(50% - 31rem)}}.sidebar{position:relative;display:flex;justify-content:center;align-items:center;color:rgba(255,255,255,0.75);text-align:center;min-height:100vh}.sidebar.invert{color:rgba(32,32,32,0.75)}.sidebar a{color:#fff;border-bottom-color:rgba(255,255,255,0.2);text-decoration-color:rgba(255,255,255,0.2)}.sidebar.invert a{color:#222;border-bottom-color:rgba(32,32,32,0.2);text-decoration-color:rgba(32,32,32,0.2)}.sidebar-bg{position:absolute;top:0;left:calc(50% - 50vw);width:100vw;height:100%;background:#202020 center / cover}.sidebar-bg::after{content:"";position:absolute;top:0;left:0;bottom:0;right:0;background:rgba(0,0,0,0.05)}.sidebar-bg.sidebar-overlay::after{background:linear-gradient(to bottom, rgba(32,32,32,0) 0%, rgba(32,32,32,0.5) 50%, rgba(32,32,32,0) 100%)}.sidebar-sticky{position:relative;z-index:3;max-width:21rem;padding:1.5rem;contain:content}.sidebar-about .avatar{margin-bottom:1.5rem}.sidebar-about>a.sidebar-title{text-decoration:none}.sidebar-about>a.sidebar-title>h2{margin:0;padding-bottom:.5rem}.sidebar-about>a.sidebar-title::after{content:'';display:block;border-bottom:2px solid;margin:0 auto .5rem;width:4rem;border-color:rgba(255,255,255,0.2);transition:border-color 250ms}.sidebar-about>a.sidebar-title:hover::after{border-color:#fff;transition:border-color 50ms}.sidebar.invert .sidebar-about>a.sidebar-title::after{border-color:rgba(32,32,32,0.2)}.sidebar.invert .sidebar-about>a.sidebar-title:hover::after{border-color:#222}.sidebar-nav>ul{list-style:none;padding-left:0}.sidebar-nav-item{display:inline-block;margin-bottom:.5rem}@media (min-width: 64em){#_main.no-drawer #_menu{display:none}#_main.no-drawer .nav-btn-bar>:nth-child(2){border:none}}.sidebar-social>ul{display:inline-block;list-style:none;padding-left:0;margin-bottom:0}.sidebar-social>ul>li{float:left}.sidebar-social>ul>li>a{display:inline-block;text-align:center;font-size:1.4rem;width:3rem;height:4rem;padding:.5rem 0;line-height:3rem;text-decoration:none;border-bottom-width:2px;border-bottom-style:solid}.sidebar-social>ul li+li{margin-top:0}.fixed-common,.fixed-top,.fixed-bottom{position:fixed;left:0;width:100%;z-index:2}.fixed-top{top:0}.fixed-bottom{bottom:0}.navbar>.content{position:relative;padding-top:0;padding-bottom:0;min-height:0;max-height:5rem}.nav-btn-bar{margin:0 -1rem;background-color:white;background-color:var(--body-bg);height:5rem;display:flex;align-items:center;position:relative}.nav-btn-bar>:first-child,.nav-btn-bar>:last-child{border:none}.nav-btn{background:none;border:none;text-decoration:none;display:flex;align-items:center;justify-content:center;width:3.25rem;height:5rem;color:var(--menu-text);border-right:1px solid var(--border-color);border-left:1px solid var(--border-color);margin-left:-1px}#markdown-toc{margin:2rem -1rem 2rem calc(-1rem + 1px);padding-left:2.5rem;padding-bottom:.5rem}#markdown-toc:before{left:1rem}@media screen and (min-width: 1664px){body:not(.no-toc) #markdown-toc{position:absolute;z-index:4;width:20.5rem;right:0;margin:auto;overflow:auto}}@media screen and (min-width: 1664px){body.no-break-layout:not(.no-toc) #markdown-toc{width:calc(50% - 31rem)}}.content{margin-left:auto;margin-right:auto;padding:8rem 1rem 12rem}@media screen{.content{padding-left:1.5rem;min-height:100vh}}@media screen and (min-width: 42em){.content{max-width:42rem}}@media screen and (min-width: 54em){.content{max-width:48rem}}@media screen and (min-width: 64em){.content{padding-left:1rem;margin-left:24rem;margin-right:3rem}}@media screen and (min-width: 86em){.content{padding-top:9rem;margin-left:25rem;margin-right:4rem;max-width:54rem}}@media screen and (min-width: 1664px){.content{margin:auto}}.large-only{display:none}@media screen and (min-width: 1664px){.large-only{display:block}}.avatar{width:7rem;height:7rem;border-radius:100%;overflow:hidden;display:inline-block}.avatar img{width:100%}.content .avatar{float:right;box-sizing:content-box;border:1rem solid var(--body-bg);transition:border-color 1s ease;margin-top:-1.5rem;margin-right:-1rem}hr.dingbat{display:none}.center-image{margin:auto;display:block}.note:before{content:"Note"}.page>header>.note-sm:before,.page>header>.note:before,.page>header>#markdown-toc:before{content:"Description"}#markdown-toc:before{content:"Table of Contents"}.layout-resume .note-sm:before,.layout-resume .note:before,.layout-resume #markdown-toc:before{content:"Summary"} .clearfix,main:not(.layout-resume) .columns::after{content:"";display:table;clear:both}.color-transition,main:not(.layout-resume) .project-card{transition:none}main:not(.layout-resume) .columns{margin-left:-1rem;display:flex;flex-wrap:wrap;contain:content;padding-top:1rem;margin-top:1rem;padding-right:1rem;margin-right:-1rem}main:not(.layout-resume) .column{float:left;padding-left:1rem;margin-bottom:2rem;width:100%;display:flex}@media screen and (min-width: 42em){main:not(.layout-resume) .columns{margin-left:-2rem;margin-right:-2rem}main:not(.layout-resume) .column-1-2{width:50%}}@media screen and (min-width: 1664px){main:not(.layout-resume) .columns-break{width:calc(50vw + 25rem)}main:not(.layout-resume) .columns-break>.column-1-2,main:not(.layout-resume) .columns-break>.column-1{width:27.5rem}}@media print{main:not(.layout-resume) .columns{display:block}main:not(.layout-resume) .column{display:block;width:50%}}main:not(.layout-resume) .project-card{width:100%;color:var(--gray-text);background-color:var(--gray-bg);padding-bottom:1rem;position:relative;overflow:hidden;box-shadow:0.125rem 0.125rem 1rem rgba(0,0,0,0.2);contain:content;border-radius:.5rem;page-break-inside:avoid;transition:transform 500ms ease;will-change:transform}main:not(.layout-resume) .project-card:hover{transform:translateY(-0.25rem);transition:transform 250ms ease}main:not(.layout-resume) .project-card>a.flip-project{display:block}main:not(.layout-resume) .project-card>a.flip-project .project-card-img{margin-bottom:0}main:not(.layout-resume) .project-card>a.flip-project .project-card-img img{display:block;border-top-left-radius:.5rem;border-top-right-radius:.5rem}main:not(.layout-resume) .project-card a{position:relative;z-index:1}main:not(.layout-resume) .project-card a.fill-card{position:absolute;top:0;left:0;right:0;bottom:0;z-index:0}main:not(.layout-resume) .project-card>.project-card-title,main:not(.layout-resume) .project-card>.project-card-text{text-align:center;padding:0 1rem}main:not(.layout-resume) .project-card>.project-card-title{display:block;font-size:1.08rem;margin-top:.75rem;margin-bottom:.25rem;color:inherit}main:not(.layout-resume) .project-card>.project-card-text{margin:.25rem 0}main:not(.layout-resume) .column-1>.project-card>.project-card-title{font-size:1.2rem}main:not(.layout-resume) .column-1>.project-card>.project-card-text{font-size:1rem}</style><link rel="preload" as="style" href="/pages/colindembovsky/assets/css/hydejack-9.1.4.css" id="_stylePreload"><link rel="preload" as="style" href="/pages/colindembovsky/assets/icomoon/style.css" id="_iconsPreload"><link rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Roboto+Slab:700%7CNoto+Sans:400,400i,700,700i&display=swap" id="_fontsPreload"> <script> setRel('_stylePreload'); setRel('_iconsPreload'); /**/setRel('_fontsPreload');/**/ </script> <noscript><link rel="stylesheet" href="/pages/colindembovsky/assets/css/hydejack-9.1.4.css"><link rel="stylesheet" href="/pages/colindembovsky/assets/icomoon/style.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:700%7CNoto+Sans:400,400i,700,700i&display=swap"> </noscript><style id="_pageStyle"> html{--accent-color: rgb(79, 129, 220);--accent-color-faded: rgba(79,129,220,0.5);--accent-color-highlight: rgba(79,129,220,0.1);--accent-color-darkened: #2f6ad6;--theme-color: rgb(5,19,24);--dark-mode-body-bg: #292e30;--dark-mode-border-color: #353c3e}</style><!--<![endif]--> <script async src="https://www.googletagmanager.com/gtag/js?id=G-FD31RTDXK2"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-FD31RTDXK2'); </script><body class="no-break-layout"> <script> window._sunrise = 6; window._sunset = 18; !function(e,s){var d="light-mode",o="dark-mode",a=(new Date).getHours();"matchMedia"in e&&e.matchMedia("(prefers-color-scheme)")||(o=(e=a<=e._sunrise||a>=e._sunset?o:d)==o?d:o,s.body.classList.add(e),s.body.classList.remove(o))}(window,document); </script> <hy-push-state id="_pushState" replace-selector="#_main" link-selector="a[href]:not([href^='/pages/colindembovsky/assets/']):not(.external):not(.no-push-state)" script-selector="script" duration="500" hashchange ><div id="_navbar" class="navbar fixed-top"><div class="content"> <span class="sr-only">Jump to:</span><div class="nav-btn-bar"> <a id="_menu" class="nav-btn no-hover" href="#_drawer--opened"> <span class="sr-only">Navigation</span> <span class="icon-menu"></span> </a><div class="nav-span"></div></div></div></div><hr class="sr-only" hidden /><main id="_main" class="content layout-post" role="main" ><nav id="breadcrumbs" class="screen-only"><ul><li><a href="/pages/colindembovsky/">home</a><li> <span>/</span> <span>az-devops-like-a-boss</span></ul></nav><article id="post-az-devops-like-a-boss" class="page post mb6" role="article"><header><h1 class="post-title flip-project-title"> az devops cli like a boss</h1><div class="post-date"> <span class="ellipsis mr1"> <time datetime="2020-07-20T19:59:14+00:00">20 Jul 2020</time> on <a href="/pages/colindembovsky/tag/automation/" class="flip-title">automation</a> </span></div><p class="note-sm" > One of the best features of Azure DevOps is the extensive API. However, while having a REST API is great, interacting with a service at HTTP level can be frustrating. In this post, I examine the az devops cli using 10 practical examples.</header><ol id="markdown-toc"><li><a href="#installing-az-and-az-devops" id="markdown-toc-installing-az-and-az-devops">Installing az and az devops</a><li><a href="#-h-is-your-friend" id="markdown-toc--h-is-your-friend">-h is your friend</a><li><a href="#organization" id="markdown-toc-organization">Organization</a><li><a href="#jmespath" id="markdown-toc-jmespath">JMESPath</a><li><a href="#authentication" id="markdown-toc-authentication">Authentication</a><li><a href="#examples" id="markdown-toc-examples">Examples</a><ol><li><a href="#example-1-creating-a-team-project" id="markdown-toc-example-1-creating-a-team-project">Example 1: Creating a Team Project</a><li><a href="#example-2-managing-security-groups" id="markdown-toc-example-2-managing-security-groups">Example 2: Managing Security Groups</a><li><a href="#example-3-determining-if-a-git-repo-exists" id="markdown-toc-example-3-determining-if-a-git-repo-exists">Example 3: Determining if a Git Repo Exists</a><li><a href="#example-4-creating-a-git-repo-and-importing-an-external-repo" id="markdown-toc-example-4-creating-a-git-repo-and-importing-an-external-repo">Example 4: Creating a Git Repo and Importing an External Repo</a><li><a href="#bonus-example-5-automating-git-commands-after-cloning" id="markdown-toc-bonus-example-5-automating-git-commands-after-cloning">(Bonus) Example 5: Automating Git Commands After Cloning</a><li><a href="#example-6-deleting-a-repo" id="markdown-toc-example-6-deleting-a-repo">Example 6: Deleting a Repo</a><li><a href="#example-7-creating-an-arm-service-endpoint" id="markdown-toc-example-7-creating-an-arm-service-endpoint">Example 7: Creating an ARM Service Endpoint</a><li><a href="#example-8-creating-and-deleting-yml-environments-using-invoke" id="markdown-toc-example-8-creating-and-deleting-yml-environments-using-invoke">Example 8: Creating and Deleting (YML) Environments using invoke</a><li><a href="#example-9-creating-variable-groups" id="markdown-toc-example-9-creating-variable-groups">Example 9: Creating Variable Groups</a><li><a href="#example-10-creating-a-yml-pipeline" id="markdown-toc-example-10-creating-a-yml-pipeline">Example 10: Creating a YML Pipeline</a></ol><li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></ol><p>One of the best features of Azure DevOps is the <a href="https://docs.microsoft.com/en-us/rest/api/azure/devops/?view=azure-devops-rest-6.0">extensive API</a>. However, while having a REST API is great, interacting with a service at HTTP level can be frustrating.<p>Azure itself has an <a href="https://docs.microsoft.com/en-us/rest/api/azure/">extensive API</a>, and the API has been wrapped into an easy to use cross-platform command line interface (CLI) called <code class="language-plaintext highlighter-rouge">az</code>. Fortunately, there is an extension to <code class="language-plaintext highlighter-rouge">az</code> for interacting with Azure DevOps called <code class="language-plaintext highlighter-rouge">az devops</code>.<p>In this post I’ll walk through installing the cli, some basics for using the cli effectively and then 10 practical examples of how to use it:<ol><li>Creating a Team Project<li>Managing Security Groups<li>Determining if a Git Repo Exists<li>Creating a Git Repo and Importing an External Repo<li>(Bonus) Automating Git Commands After Cloning<li>Deleting a Git Repo<li>Creating an ARM Service Endpoint<li>Creating and Deleting (YML) Environments using invoke<li>Creating Variable Groups<li>Creating YML Pipelines</ol><h2 id="installing-az-and-az-devops">Installing az and az devops</h2><p>To install <code class="language-plaintext highlighter-rouge">az</code> you can follow <a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">these instructions</a>. Once you’ve installed <code class="language-plaintext highlighter-rouge">az</code> you can install the <code class="language-plaintext highlighter-rouge">devops</code> extension by following <a href="https://github.com/Azure/azure-devops-cli-extension#quick-start">these instructions</a> (all you really have to do is type <code class="language-plaintext highlighter-rouge">az extension add --name azure-devops</code>).<h2 id="-h-is-your-friend">-h is your friend</h2><p>The <code class="language-plaintext highlighter-rouge">-h</code> switch (help) is your friend. I have often discovered new subcommands by using the switch, and of course for each command you need the help to figure out all of the args you need to pass. For example, <code class="language-plaintext highlighter-rouge">az devops project create -h</code> prints out all the args needed to create a new Azure DevOps Team Project.<h2 id="organization">Organization</h2><p>When you run <code class="language-plaintext highlighter-rouge">az devops</code> commands, you’ll need to specify the organization (and often Team Project) that you want to run commands against. Supposedly, you can set a default using <code class="language-plaintext highlighter-rouge">az devops configure defaults organization=https://dev.azure.com/myOrg</code> but I could not get that to work. Instead, I put the org URL into a variable and use the <code class="language-plaintext highlighter-rouge">--org $orgUrl</code> argument for every command.<h2 id="jmespath">JMESPath</h2><p>The other argument that you’ll need to want to know is the <code class="language-plaintext highlighter-rouge">--query</code> argument. This allows you to specify JSON queries against the results of a command to extract certain information. JMESPath is at once powerful and frustrating. You can find documentation on this query language <a href="https://jmespath.org/">here</a>.<p>You’ll also want to use the <code class="language-plaintext highlighter-rouge">-o</code> parameter to specify the output. For scripts, using <code class="language-plaintext highlighter-rouge">-o tsv</code> (table separated values) will give you plain text results that you can assign to variables for use further down in your scripts.<p>For example, if you want to determine if a Team Project already exists, you can use the <code class="language-plaintext highlighter-rouge">az devops project list</code> command: but it will return an array of objects which you’ll have to try to parse:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    /home/colin/repos/foo <span class="o">[</span>master ≡]&gt; az devops project list <span class="nt">--org</span> <span class="nv">$orgUrl</span>
    <span class="o">{</span>
      <span class="s2">"continuationToken"</span>: null,
      <span class="s2">"value"</span>: <span class="o">[</span>
        <span class="o">{</span>
          <span class="s2">"abbreviation"</span>: null,
          <span class="s2">"defaultTeamImageUrl"</span>: null,
          <span class="s2">"description"</span>: null,
          <span class="s2">"id"</span>: <span class="s2">"&lt;redacted&gt;"</span>,
          <span class="s2">"lastUpdateTime"</span>: <span class="s2">"2020-07-17T20:54:47.090000+00:00"</span>,
          <span class="s2">"name"</span>: <span class="s2">"Project1"</span>,
          <span class="s2">"revision"</span>: 622,
          <span class="s2">"state"</span>: <span class="s2">"wellFormed"</span>,
          <span class="s2">"url"</span>: <span class="s2">"https://dev.azure.com/&lt;redacted&gt;/_apis/projects/&lt;redacted&gt;"</span>,
          <span class="s2">"visibility"</span>: <span class="s2">"private"</span>
        <span class="o">}</span>,
        <span class="o">{</span>
          <span class="s2">"abbreviation"</span>: null,
          <span class="s2">"defaultTeamImageUrl"</span>: null,
          <span class="s2">"description"</span>: null,
          <span class="s2">"id"</span>: <span class="s2">"&lt;redacted&gt;"</span>,
          <span class="s2">"lastUpdateTime"</span>: <span class="s2">"2020-07-15T04:33:19.377000+00:00"</span>,
          <span class="s2">"name"</span>: <span class="s2">"Project2"</span>,
          <span class="s2">"revision"</span>: 306,
          <span class="s2">"state"</span>: <span class="s2">"wellFormed"</span>,
          <span class="s2">"url"</span>: <span class="s2">"https://dev.azure.com/&lt;redacted&gt;/_apis/projects/&lt;redacted&gt;"</span>,
          <span class="s2">"visibility"</span>: <span class="s2">"private"</span>
        <span class="o">}</span>,
        ...
        <span class="o">{</span>
          <span class="s2">"abbreviation"</span>: null,
          <span class="s2">"defaultTeamImageUrl"</span>: null,
          <span class="s2">"description"</span>: null,
          <span class="s2">"id"</span>: <span class="s2">"&lt;redacted&gt;"</span>,
          <span class="s2">"lastUpdateTime"</span>: <span class="s2">"2020-07-20T15:33:57.950000+00:00"</span>,
          <span class="s2">"name"</span>: <span class="s2">"Projectn"</span>,
          <span class="s2">"revision"</span>: 670,
          <span class="s2">"state"</span>: <span class="s2">"wellFormed"</span>,
          <span class="s2">"url"</span>: <span class="s2">"https://dev.azure.com/&lt;redacted&gt;/_apis/projects/&lt;redacted&gt;"</span>,
          <span class="s2">"visibility"</span>: <span class="s2">"private"</span>
        <span class="o">}</span>
      <span class="o">]</span>
    <span class="o">}</span>

</code></pre></div></div><p>Using the <code class="language-plaintext highlighter-rouge">--query</code> parameter, we can return a simple array of strings (each entry is a Team Project name) making parsing much simpler: <code class="language-plaintext highlighter-rouge">az devops project list --org $orgUrl --query "value[].name" -o tsv</code>:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    /home/colin/repos/foo <span class="o">[</span>master ≡]&gt; az devops project list <span class="nt">--org</span> <span class="nv">$orgUrl</span> <span class="nt">--query</span> <span class="s2">"value[].name"</span> <span class="nt">-o</span> tsv
    Project1
    Project2
    ...
    Projectn

</code></pre></div></div><h2 id="authentication">Authentication</h2><p>To authenticate, you need to run <code class="language-plaintext highlighter-rouge">az devops login</code> which will ask for a Personal Access Token (PAT) to connect to your Azure DevOps organization. Being prompted is fine when you’re working in a console, but if you want to automate <code class="language-plaintext highlighter-rouge">az devops</code> commands, you’re going to want to log in without the prompt. To do this, you can set an environment variable called <code class="language-plaintext highlighter-rouge">AZURE_DEVOPS_EXT_PAT</code> to the value of your PAT. In my <code class="language-plaintext highlighter-rouge">pwsh</code> (cross-platform PowerShell) scripts, this didn’t seem to work totally, so I ended up piping the PAT to the login command too: <code class="language-plaintext highlighter-rouge">$pat | az devops login</code>.<h2 id="examples">Examples</h2><p>Now that we’ve got some basics out the way, let’s take a look at a few examples.<h3 id="example-1-creating-a-team-project">Example 1: Creating a Team Project</h3><p>This one is pretty straightforward: <code class="language-plaintext highlighter-rouge">az devops project create --org $orgUrl --name MyNewProject</code>. However, in the script I was creating, I wanted to add an organizational group to the <code class="language-plaintext highlighter-rouge">Project Admins</code> group. That leads to…<h3 id="example-2-managing-security-groups">Example 2: Managing Security Groups</h3><p>Let’s get the descriptor (id) of the newly created Team Project’s <code class="language-plaintext highlighter-rouge">Project Administrator</code> Group:<p><code class="language-plaintext highlighter-rouge">az devops security group list -p $projectName --org $orgUrl --query "graphGroups[?contains(principalName,'Project Administrators')].descriptor" -o tsv</code><p>We’re using <code class="language-plaintext highlighter-rouge">az devops security group</code> to list out the groups of a Team Project. We’re then using the <code class="language-plaintext highlighter-rouge">contains</code> JMESPath function to query for the node that has the attribute <code class="language-plaintext highlighter-rouge">principalName</code> like <code class="language-plaintext highlighter-rouge">Project Administrators</code> and returning the <code class="language-plaintext highlighter-rouge">descriptor</code> attribute.<p>Next we query an org-level group by adding <code class="language-plaintext highlighter-rouge">--scope organization</code> to the command:<p><code class="language-plaintext highlighter-rouge">az devops security group list --org $orgUrl --scope organization --query "graphGroups[?contains(principalName,'Specialists')].descriptor" -o tsv</code><p>Here we query the org-level groups looking for a group containing the word <code class="language-plaintext highlighter-rouge">Specialists</code> and again return the descriptor.<p>Finally, we use the <code class="language-plaintext highlighter-rouge">group membership</code> command to add the <code class="language-plaintext highlighter-rouge">Specialists</code> group to the <code class="language-plaintext highlighter-rouge">Project Admins</code> group:<p><code class="language-plaintext highlighter-rouge">az devops security group membership add --org $orgUrl --group-id $projAdminGroupDescriptor --member-id $specialistGroupDescriptor</code><h3 id="example-3-determining-if-a-git-repo-exists">Example 3: Determining if a Git Repo Exists</h3><p>Getting a list of Repo names in a Team Project is easy:<p><code class="language-plaintext highlighter-rouge">$repoList = az repos list --org $orgUrl -p $ProjectName --query "[].name" -o tsv</code><p>Next I wanted to determine if a repo with a given name existed. Since I’m in <code class="language-plaintext highlighter-rouge">pwsh</code> on linux, I initially tried <code class="language-plaintext highlighter-rouge">-contains</code> but this is a case sensitive search. To make the search case insensitive, I convert the list to an <code class="language-plaintext highlighter-rouge">ObjectCollection</code> and use <code class="language-plaintext highlighter-rouge">FindIndex</code>:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="nv">$repoCollection</span> <span class="o">=</span> <span class="o">[</span>Collections.Generic.List[Object]]<span class="nv">$repoList</span>
    <span class="k">if</span> <span class="o">(</span><span class="nv">$repoCollection</span> <span class="nt">-and</span> <span class="nv">$repoCollection</span>.FindIndex<span class="o">({</span> <span class="nv">$args</span><span class="o">[</span>0] <span class="nt">-eq</span> <span class="nv">$RepoName</span> <span class="o">})</span> <span class="nt">-ge</span> 0<span class="o">)</span> <span class="o">{</span>
        Write-Host <span class="s2">"Repo already exists"</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        Write-Host <span class="s2">"Cloning repo..."</span>
    <span class="o">}</span>

</code></pre></div></div><h3 id="example-4-creating-a-git-repo-and-importing-an-external-repo">Example 4: Creating a Git Repo and Importing an External Repo</h3><p>Before importing a repo, we have to have a repo to import into. To create an empty Git repo, we can use this command:<p><code class="language-plaintext highlighter-rouge">az repos create --name $RepoName -p $ProjectName --org $orgUrl</code><p>Next we want to create an import request. In my case, the source repo was another Azure DevOps organization repo and so authentication was required. The same would be true of any private repo. If you require authentication, then generate an authentication token on the source repo and set the environment variable <code class="language-plaintext highlighter-rouge">AZURE_DEVOPS_EXT_GIT_SOURCE_PASSWORD_OR_PAT</code> to the value of the token (or password). Then the import request will include authentication:<p><code class="language-plaintext highlighter-rouge">az repos import create --git-url $sourceRepoURL -p $ProjectName --org $orgUrl --repository $RepoName --requires-authorization</code><p>This creates the request and performs the import from the external Git repo.<h3 id="bonus-example-5-automating-git-commands-after-cloning">(Bonus) Example 5: Automating Git Commands After Cloning</h3><p>In our case, we needed to manipulate some files after the import. Assuming we already have a PAT for the new target Team Project (same one we used to authenticate using <code class="language-plaintext highlighter-rouge">az devops login</code>), we can configure Git to allow <code class="language-plaintext highlighter-rouge">git</code> operations using <code class="language-plaintext highlighter-rouge">-c http.extraHeader</code>.<p>Let’s first get the URL of the new repo using:<p><code class="language-plaintext highlighter-rouge">$repoUrl = az repos show -p $ProjectName --org $orgUrl -r $RepoName --query "webUrl" -o tsv</code><p>Next, we encode the header to authenticate to the new repo:<p><code class="language-plaintext highlighter-rouge">$b64Pat = [Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes(":$PAT"))</code><p>Finally, we use the encoded PAT when performing remote <code class="language-plaintext highlighter-rouge">git</code> operations (like <code class="language-plaintext highlighter-rouge">clone</code>, <code class="language-plaintext highlighter-rouge">pull</code> and <code class="language-plaintext highlighter-rouge">push</code>):<p><code class="language-plaintext highlighter-rouge">git -c http.extraHeader="Authorization: Basic $b64Pat" clone $repoUrl</code><h3 id="example-6-deleting-a-repo">Example 6: Deleting a Repo</h3><p>When you create a new Team Project (using Git) you get a repo with the same name as the Team Project. We wanted to delete that repo. First, get the repo id and then delete it:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="nv">$repoId</span> <span class="o">=</span> az repos show <span class="nt">-r</span> <span class="nv">$ProjectName</span> <span class="nt">-p</span> <span class="nv">$ProjectName</span> <span class="nt">--org</span> <span class="nv">$orgUrl</span> <span class="nt">--query</span> <span class="s2">"id"</span> <span class="nt">-o</span> tsv
    az repos delete <span class="nt">--id</span> <span class="nv">$repoId</span> <span class="nt">--org</span> <span class="nv">$orgUrl</span> <span class="nt">-p</span> <span class="nv">$ProjectName</span> <span class="nt">-y</span>

</code></pre></div></div><h3 id="example-7-creating-an-arm-service-endpoint">Example 7: Creating an ARM Service Endpoint</h3><p>We needed to create a Service Endpoint to an Azure Subscription in our script. Once again, there is authentication involved because you need an SPN key (we’re connecting via SPN and not certificate). Once again, setting an environment variable <code class="language-plaintext highlighter-rouge">AZURE_DEVOPS_EXT_AZURE_RM_SERVICE_PRINCIPAL_KEY</code> saved the day. Assuming we have the <code class="language-plaintext highlighter-rouge">SPNClientID</code>, <code class="language-plaintext highlighter-rouge">AzureSubscriptionID</code> and <code class="language-plaintext highlighter-rouge">Name</code> and <code class="language-plaintext highlighter-rouge">TenantID</code>, we can create a service endpoint using:<p><code class="language-plaintext highlighter-rouge">az devops service-endpoint azurerm create --azure-rm-service-principal-id $SPNClientID --azure-rm-subscription-id $AzureSubscriptionID --azure-rm-subscription-name $AzureSubscriptionName --azure-rm-tenant-id $TenantID --name $ServiceEndpointName -p $ProjectName --org $orgUrl</code><p>One more thing: once we created the endpoint, we wanted it to be authorized for all pipelines. Fortunately we can do this using <code class="language-plaintext highlighter-rouge">az devops</code> too! First we retrieve the ID of the newly created endpoint, and then update it:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="nv">$epId</span> <span class="o">=</span> az devops service-endpoint list <span class="nt">--org</span> <span class="nv">$orgUrl</span> <span class="nt">-p</span> <span class="nv">$ProjectName</span> <span class="nt">--query</span> <span class="s2">"[?name=='</span><span class="nv">$ServiceEndpointName</span><span class="s2">'].id"</span> <span class="nt">-o</span> tsv
    az devops service-endpoint update <span class="nt">--id</span> <span class="nv">$epId</span> <span class="nt">--enable-for-all</span> <span class="nb">true</span> <span class="nt">--org</span> <span class="nv">$orgUrl</span> <span class="nt">-p</span> <span class="nv">$ProjectName</span>

</code></pre></div></div><h3 id="example-8-creating-and-deleting-yml-environments-using-invoke">Example 8: Creating and Deleting (YML) Environments using invoke</h3><p>Up until this point, I have been able to do everything I needed using “native” <code class="language-plaintext highlighter-rouge">az devops</code> commands. However, when it comes to manipulating YML environments, there are not yet commands for this in <code class="language-plaintext highlighter-rouge">az devops</code>. Fortunately, <code class="language-plaintext highlighter-rouge">az devops</code> provides a “catch all” command called <code class="language-plaintext highlighter-rouge">invoke</code> that lets you easily invoke any REST API method against Azure DevOps.<p>Here is the REST API call to list YML environments from this <a href="https://docs.microsoft.com/en-us/rest/api/azure/devops/distributedtask/environments/list?view=azure-devops-rest-6.0">help doc</a>:<p><code class="language-plaintext highlighter-rouge">GET https://dev.azure.com/{organization}/{project}/_apis/distributedtask/environments?api-version=6.0-preview.1</code><p>This URL has a “routing parameter” <code class="language-plaintext highlighter-rouge">{project}</code> and then the portion after the <code class="language-plaintext highlighter-rouge">_apis</code> specifies the <code class="language-plaintext highlighter-rouge">area</code> (distributedtask) and <code class="language-plaintext highlighter-rouge">resource</code> (environments). Finally, we have to note the <code class="language-plaintext highlighter-rouge">api-version</code>.<p>Armed with this, we can formulate the request for the <code class="language-plaintext highlighter-rouge">az devops invoke</code> command:<p><code class="language-plaintext highlighter-rouge">$envs = az devops invoke --area distributedtask --resource environments --route-parameters project=$ProjectName --org $orgUrl --api-version "6.0-preview" -o json | ConvertFrom-Json</code><blockquote><p>Note: the api-version value is “6-0-preview” without the .1 from the API documentation</blockquote><p>We can then query the environments. If we decide that we want to create an environment, we’ll need to do a <code class="language-plaintext highlighter-rouge">POST</code>. <code class="language-plaintext highlighter-rouge">az devops invoke</code> requires a JSON file as the body of the <code class="language-plaintext highlighter-rouge">POST</code>, so we can create the body and dump it to a json file and then pass that in as the <code class="language-plaintext highlighter-rouge">--in-file</code> argument:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="nv">$envBody</span> <span class="o">=</span> @<span class="o">{</span>
      name <span class="o">=</span> <span class="nv">$env</span>
      description <span class="o">=</span> <span class="s2">"My </span><span class="nv">$env</span><span class="s2"> environment"</span>
    <span class="o">}</span>
    <span class="nv">$infile</span> <span class="o">=</span> <span class="s2">"envbody.json"</span>
    Set-Content <span class="nt">-Path</span> <span class="nv">$infile</span> <span class="nt">-Value</span> <span class="o">(</span><span class="nv">$envBody</span> | ConvertTo-Json<span class="o">)</span>
    az devops invoke <span class="sb">`</span>
       <span class="nt">--area</span> distributedtask <span class="nt">--resource</span> environments <span class="sb">`</span>
       <span class="nt">--route-parameters</span> <span class="nv">project</span><span class="o">=</span><span class="nv">$ProjectName</span> <span class="nt">--org</span> <span class="nv">$orgUrl</span> <span class="sb">`</span>
       <span class="nt">--http-method</span> POST <span class="nt">--in-file</span> <span class="nv">$infile</span> <span class="sb">`</span>
       <span class="nt">--api-version</span> <span class="s2">"6.0-preview"</span>
    <span class="nb">rm</span> <span class="nv">$infile</span> <span class="nt">-f</span>

</code></pre></div></div><p>To delete an environment, find its ID:<p><code class="language-plaintext highlighter-rouge">$id = az devops invoke --area distributedtask --resource environments --route-parameters project=$ProjectName --org $orgUrl --api-version "6.0-preview" --query "value[?name=='myEnvToDelete'].id" -o tsv</code><p>Once you have its ID, you can use the <code class="language-plaintext highlighter-rouge">DELETE</code> <code class="language-plaintext highlighter-rouge">http-method</code> to invoke the REST API DELETE method:<p><code class="language-plaintext highlighter-rouge">az devops invoke --area distributedtask --resource environments --route-parameters project=$ProjectName environmentId=$id --org $orgUrl --http-method DELETE --api-version "6.0-preview"</code><h3 id="example-9-creating-variable-groups">Example 9: Creating Variable Groups</h3><p>We can use <code class="language-plaintext highlighter-rouge">az pipelines variable-group</code> commands to manipulate variable groups. Here’s how we list all the variable groups in a Team Project:<p><code class="language-plaintext highlighter-rouge">az pipelines variable-group list -p $ProjectName --org $orgUrl --query "[].name" -o tsv</code><p>To create a variable group, we use the <code class="language-plaintext highlighter-rouge">create</code> subcommand. We can also specify key/value pairs using the <code class="language-plaintext highlighter-rouge">--variables</code> arg:<p><code class="language-plaintext highlighter-rouge">az pipelines variable-group create --name $varGroupName -p $ProjectName --org $orgUrl --authorize --variables var1="val1" var2="val2"</code><h3 id="example-10-creating-a-yml-pipeline">Example 10: Creating a YML Pipeline</h3><p>To create a YML pipeline, you’ll need a name as well as the repository, branch and path to the YML file within the repo (the path relative to the root path of the repo):<p><code class="language-plaintext highlighter-rouge">az pipelines create -p $ProjectName --org $orgUrl --name $PipelineName --description $PipelineDescription --repository $RepoName --repository-type tfsgit --branch master --skip-first-run --yml-path $YmlPath</code><blockquote><p>Note: The –skip-first-run tells Azure DevOps not to immediately run the pipeline. If you do not specify this, the pipeline is automatically queued.</blockquote><p>If you need UI variables for the pipeline, you can add these using <code class="language-plaintext highlighter-rouge">az pipelines variables create</code> like this:<p><code class="language-plaintext highlighter-rouge">az pipelines variable create -p $ProjectName --org $orgUrl --pipeline-name $PipelineName --name myVar --value "some value" --allow-override $true</code><blockquote><p>Note: The –allow-override is the checkbox on the UI that allows users to override the variable value at queue time.</blockquote><h2 id="conclusion">Conclusion</h2><p>Azure DevOps has a rich REST API and <code class="language-plaintext highlighter-rouge">az devops</code> certainly makes interacting with the API much easier. This cli is under constant development, so even if there are APIs that are not yet wrapped (like the YML Environment APIs) you can use <code class="language-plaintext highlighter-rouge">invoke</code> to interact with those APIs. This makes <code class="language-plaintext highlighter-rouge">az devops</code> a natural choice for scripting and automating Azure DevOps tasks!<p>Happy commanding!</article><hr class="dingbat related mb6" /><aside class="comments related" role="complementary"><h2 class="hr-bottom">Comments</h2><div id="giscus"><div></div></div><script> function toggle_giscus() { const c = document.body.classList; const dark = c.contains("dark-mode") || "_sunset" in window && !c.contains("light-mode") && matchMedia("(prefers-color-scheme: dark)").matches; const theme = dark ? "dark" : "light"; const scriptEl = document.createElement("script"); scriptEl.src = "https://giscus.app/client.js"; scriptEl.setAttribute("data-repo", "colindembovsky/colindembovsky.github.io"); scriptEl.setAttribute("data-repo-id", "MDEwOlJlcG9zaXRvcnk0MDczMjI3MjU="); scriptEl.setAttribute("data-category", "Giscussions"); scriptEl.setAttribute("data-category-id", "DIC_kwDOGEdAZc4B_F18"); scriptEl.setAttribute("data-mapping", "pathname"); scriptEl.setAttribute("data-reactions-enabled", "1"); scriptEl.setAttribute("data-emit-metadata", "colindembovsky/colindembovsky.github.io"); scriptEl.setAttribute("data-theme", theme); scriptEl.setAttribute("crossorigin", "anonymous"); const container = document.getElementById("giscus"); const old = container.firstElementChild; container.removeChild(old); container.appendChild(scriptEl); } document.addEventListener("hydejack-dark-mode-toggle", function() { toggle_giscus(); }); toggle_giscus(); </script></aside><aside class="related mb4" role="complementary"><h2 class="hr-bottom">Random Posts</h2><ul class="related-posts"><li class="h4"> <a href="/pages/colindembovsky/install-and-configure-sql-server-using-powershell-dsc/" class="flip-title"><span>Install and Configure SQL Server using PowerShell DSC</span></a> <time class="faded fine" datetime="2014-07-15T21:35:13+00:00">15 Jul 2014</time><li class="h4"> <a href="/pages/colindembovsky/new-feature-lightweight-query-charts-in-web-access/" class="flip-title"><span>New Feature: Lightweight Query Charts in Web Access</span></a> <time class="faded fine" datetime="2013-09-09T22:40:00+00:00">09 Sep 2013</time><li class="h4"> <a href="/pages/colindembovsky/imaginet-notion-solutions-wins-microsoft-partner-of-the-year-in-the-application-lifecycle-management-category/" class="flip-title"><span>Imaginet (Notion Solutions) wins Microsoft Partner of the Year in the Application Lifecycle Management Category</span></a> <time class="faded fine" datetime="2011-06-24T15:09:00+00:00">24 Jun 2011</time></ul></aside><footer class="content" role="contentinfo"><hr/><p><small class="copyright">© 2021. All rights reserved. </small><hr class="sr-only"/></footer></main><hy-drawer id="_drawer" class="" side="left" threshold="10" noscroll ><header id="_sidebar" class="sidebar" role="banner"><div class="sidebar-bg sidebar-overlay" style="background-color:rgb(5,19,24);background-image:url(/pages/colindembovsky/assets/img/sidebar-bg.jpg)"></div><div class="sidebar-sticky"><div class="sidebar-about"> <a class="no-hover" href="/pages/colindembovsky/" tabindex="-1"> <img src="/pages/colindembovsky/assets/img/logo.png" class="avatar" alt="Colin's ALM Corner" width="120" height="120" loading="lazy" /> </a> <a class="sidebar-title" href="/pages/colindembovsky/"><h2 class="h1">Colin's ALM Corner</h2></a><p class=""> DevOpsology &amp; GitHub. <br /> <em>Opinions my own</em>.</div><nav class="sidebar-nav heading" role="navigation"> <span class="sr-only">Navigation:</span><ul><li> <a id="_drawer--opened" href="/pages/colindembovsky/tags/" class="sidebar-nav-item " > Tags </a><li> <a href="/pages/colindembovsky/about/" class="sidebar-nav-item " > About </a></ul></nav><div class="sidebar-social"> <span class="sr-only">Social:</span><ul><li> <a href="https://twitter.com/colindembovsky" title="Twitter" class="no-mark-external"> <span class="icon-twitter"></span> <span class="sr-only">Twitter</span> </a><li> <a href="https://github.com/colindembovsky" title="GitHub" class="no-mark-external"> <span class="icon-github"></span> <span class="sr-only">GitHub</span> </a><li> <a href="https://colinsalmcorner.com/feed.xml" title="RSS" class="no-mark-external"> <span class="icon-rss2"></span> <span class="sr-only">RSS</span> </a></ul></div></div></header></hy-drawer><hr class="sr-only" hidden /> </hy-push-state> <!--[if gt IE 10]><!----> <script nomodule>!function(){var t,n=document.createElement("script");!("noModule"in n)&&"onbeforeload"in n&&(t=!1,document.addEventListener("beforeload",function(e){if(e.target===n)t=!0;else if(!e.target.hasAttribute("nomodule")||!t)return;e.preventDefault()},!0),n.type="module",n.src=".",document.head.appendChild(n),n.remove())}(); </script> <script src="/pages/colindembovsky/assets/js/hydejack-9.1.4.js" type="module"></script> <script src="/pages/colindembovsky/assets/js/LEGACY-hydejack-9.1.4.js" nomodule defer></script> <script type="module"> if ('serviceWorker' in navigator) { /**/ navigator.serviceWorker.getRegistration() .then(r => r.unregister()) .catch(() => {}); /**/ } </script> <!--<![endif]--><div hidden><h2 class="sr-only">Templates (for web app):</h2><clap-config> <clap-text at="1">Keep going!</clap-text> <clap-text at="2">Keep going ×2!</clap-text> <clap-text at="3">Give me more!</clap-text> <clap-text at="5">Thank you, thank you</clap-text> <clap-text at="7">Far too kind!</clap-text> <clap-text at="10">Never gonna give me up?</clap-text> <clap-text at="14">Never gonna let me down?</clap-text> <clap-text at="20">Turn around and desert me!</clap-text> <clap-text at="30">You're an addict!</clap-text> <clap-text at="40">Son of a clapper!</clap-text> <clap-text at="50">No way</clap-text> <clap-text at="60">Go back to work!</clap-text> <clap-text at="70">This is getting out of <em>hand</em></clap-text> <clap-text at="80">Unbelievable</clap-text> <clap-text at="90">PREPOSTEROUS</clap-text> <clap-text at="100">I N S A N I T Y</clap-text> <clap-text at="185"><span style="font-family:monospace">FEED ME A STRAY CAT</span></clap-text> </clap-config> <template id="_animation-template"><div class="animation-main fixed-top"><nav id="breadcrumbs" class="screen-only"><ul></ul></nav><div class="content"><div class="page"></div></div></div></template> <template id="_loading-template"><div class="loading nav-btn fr"> <span class="sr-only">Loading…</span> <span class="icon-cog"></span></div></template> <template id="_error-template"><div class="page"><h1 class="page-title">Error</h1><p class="lead"> Sorry, an error occurred while loading <a class="this-link" href=""></a>.</div></template> <template id="_permalink-template"> <a href="#" class="permalink"> <span class="sr-only">Permalink</span> <span class="content-hash"></span> </a> </template> <template id="_cookies-banner-template"><div id="_cookies-banner" class="navbar fixed-bottom CookiesOK"><div class="content"><div class="nav-btn-bar"> <small class="faded"> <span>This site uses cookies. <a href="/cookies-policy/">Cookies Policy</a>. </span> <button id="_cookies-ok" class="btn btn-primary btn-sm">Okay</button> </small></div></div></div></template> <template id="_dark-mode-template"> <button id="_dark-mode" class="nav-btn no-hover" > <span class="sr-only">Dark Mode</span> <span class="icon-brightness-contrast"></span> </button> </template> <template id="_search-template"> <button id="_search" class="nav-btn no-hover"> <label class="sr-only" for="_search-input">Search</label> <span class="icon-search"></span> </button><div id="_search-box"><div class="nav-btn"> <span class="icon-search"></span></div><input id="_search-input" type="search" class="form-control form-control-lg nav-btn" placeholder="Type something…" /> <button type="reset" class="nav-btn no-hover"> <span class="sr-only">Close</span> <span class="icon-cross"></span> </button></div><div id="_hits"></div></template></div></html>
