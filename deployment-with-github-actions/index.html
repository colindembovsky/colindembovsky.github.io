<!DOCTYPE html>
<html lang="en"><head><title>Deployment with GitHub Actions: The Bad and the Ugly | Colin’s ALM Corner</title><meta name="generator" content="Jekyll v3.9.0" /><meta property="og:title" content="Deployment with GitHub Actions: The Bad and the Ugly" /><meta name="author" content="Colin Dembovsky" /><meta property="og:locale" content="en" /><meta name="description" content="GitHub Actions can be used for Continuous Deployment (CD) - but there are some rough edges. In this post I take you through a deep dive and lift the kimono on Actions." /><meta property="og:description" content="GitHub Actions can be used for Continuous Deployment (CD) - but there are some rough edges. In this post I take you through a deep dive and lift the kimono on Actions." /><link rel="canonical" href="https://github.com/pages/colindembovsky/deployment-with-github-actions/" /><meta property="og:url" content="https://github.com/pages/colindembovsky/deployment-with-github-actions/" /><meta property="og:site_name" content="Colin’s ALM Corner" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-01-11T22:42:40+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Deployment with GitHub Actions: The Bad and the Ugly" /><meta name="twitter:site" content="@colindembovsky" /><meta name="twitter:creator" content="@colindembovsky" /> <script type="application/ld+json"> {"description":"GitHub Actions can be used for Continuous Deployment (CD) - but there are some rough edges. In this post I take you through a deep dive and lift the kimono on Actions.","url":"https://github.com/pages/colindembovsky/deployment-with-github-actions/","@type":"BlogPosting","headline":"Deployment with GitHub Actions: The Bad and the Ugly","dateModified":"2021-01-11T22:42:40+00:00","datePublished":"2021-01-11T22:42:40+00:00","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://github.com/pages/colindembovsky/assets/img/logo.png"},"name":"Colin Dembovsky"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://github.com/pages/colindembovsky/deployment-with-github-actions/"},"author":{"@type":"Person","name":"Colin Dembovsky"},"@context":"https://schema.org"}</script><meta name="keywords" content="devops,github,actions,build,ci,cd"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Colin's ALM Corner"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="application-name" content="Colin's ALM Corner"><meta name="theme-color" content="rgb(5,19,24)"><meta name="generator" content="Hydejack v9.1.4" /><link rel="alternate" href="https://github.com/pages/colindembovsky/deployment-with-github-actions/" hreflang="en"><link type="application/atom+xml" rel="alternate" href="https://github.com/pages/colindembovsky/feed.xml" title="Colin's ALM Corner" /><link rel="shortcut icon" href="/pages/colindembovsky/assets/icons/favicon.ico"><link rel="apple-touch-icon" href="/pages/colindembovsky/assets/icons/icon-192x192.png"><link rel="manifest" href="/pages/colindembovsky/assets/site.webmanifest"><link rel="dns-prefetch" href="https://fonts.googleapis.com"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preload" href="/pages/colindembovsky/assets/img/swipe.svg" as="image" id="_hrefSwipeSVG"><link rel="dns-prefetch" href="/pages/colindembovsky/assets/js/search-worker-9.1.4.js" as="worker" id="_hrefSearch"> <script>!function(r,c){"use strict";function a(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}r.loadJS=function(e,t){var n=c.createElement("script");n.src=e,t&&a(n,"load",t,{once:!0});t=c.scripts[0];return t.parentNode.insertBefore(n,t),n},r._loaded=!1,r.loadJSDeferred=function(e,t){var n=c.createElement("script");function o(){r._loaded=!0,t&&a(n,"load",t,{once:!0});var e=c.scripts[0];e.parentNode.insertBefore(n,e)}return n.src=e,r._loaded?o():a(r,"load",o,{once:!0}),n},r.setRel=r.setRelStylesheet=function(e){a(c.getElementById(e),"load",function(){this.rel="stylesheet"},{once:!0})}}(window,document); !function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this); !function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this); !function(w) { w._baseURL = '/pages/colindembovsky/'; w._publicPath = '/pages/colindembovsky/assets/js/'; w._noPushState = false; w._noDrawer = false; w._noNavbar = false; w._noToc = false; w._noSearch = false; w._advertise = false; w._search = { DATA_URL: '/pages/colindembovsky/assets/sitedata.json?no-cache', STORAGE_KEY: 'mini-search/pages/colindembovsky/', INDEX_KEY: 'index--2021-11-18T20:23:33+00:00', }; w._clapButton = false; }(window);</script> <script async src="/pages/colindembovsky/assets/bower_components/MathJax/es5/tex-mml-chtml.js" id="_MathJax"></script> <!--[if gt IE 8]><!----><style id="_styleInline"> .clearfix,.sidebar-social::after{content:"";display:table;clear:both}.color-transition,body,p,hr,.hr,.hr-after::after,.hr-bottom,.message,.note-sm,.note,#markdown-toc,.navbar,.nav-btn-bar,.nav-btn,.content .avatar{transition:none}#_dark-mode{font-size:1.25rem}@media screen{body.light-mode{--body-color: #333;--body-bg: #fff;--border-color: #ebebeb;--gray: #777;--gray-bg: rgba(0,0,0,0.025);--gray-text: #666;--menu-text: #bbb;--inv-body-color: #ccc;--inv-body-bg: var(--dark-mode-body-bg)}body.light-mode .content{-webkit-font-smoothing:initial;-moz-osx-font-smoothing:initial}body.dark-mode{--body-color: #ccc;--body-bg: var(--dark-mode-body-bg);--border-color: var(--dark-mode-border-color);--gray: rgba(255,255,255,.5);--gray-bg: rgba(255,255,255,.033);--gray-text: rgba(255,255,255,.625);--menu-text: rgba(255,255,255,.25);--inv-body-color: #333;--inv-body-bg: #fff}body.dark-mode .content{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media screen and (prefers-color-scheme: dark){body{--body-color: #ccc;--body-bg: var(--dark-mode-body-bg);--border-color: var(--dark-mode-border-color);--gray: rgba(255,255,255,.5);--gray-bg: rgba(255,255,255,.033);--gray-text: rgba(255,255,255,.625);--menu-text: rgba(255,255,255,.25);--inv-body-color: #333;--inv-body-bg: #fff}body .content{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.tippy-content{-webkit-font-smoothing:initial;-moz-osx-font-smoothing:initial}}html{--font-family: Noto Sans,Helvetica,Arial,sans-serif;--font-family-heading: Roboto Slab,Helvetica,Arial,sans-serif;--code-font-family: Fira Code,Menlo,Monaco,Consolas,monospace;--body-color: #333;--body-bg: #fff;--border-color: #ebebeb;--gray: #777;--gray-bg: rgba(0,0,0,0.025);--gray-text: #666;--menu-text: #bbb;--inv-body-color: #ccc;--inv-body-bg: var(--dark-mode-body-bg);--root-font-size: 15px;--root-font-size-medium: 16px;--root-font-size-large: 17px;--root-font-size-print: 8pt;--root-line-height: 1.75;--font-weight: 400;--font-weight-bold: 700;--font-weight-heading: 700;--content-width-5: 54rem;--content-margin-5: 4rem;--sidebar-width: 21rem;--half-content: 31rem;--break-point-3: 64em;--break-point-5: 86em;--break-point-dynamic: 1664px}html .content{-webkit-font-smoothing:initial;-moz-osx-font-smoothing:initial}*{box-sizing:border-box}html,body{margin:0;padding:0}html{font-family:var(--font-family);font-size:var(--root-font-size);line-height:var(--root-line-height)}body{color:var(--body-color);background-color:var(--body-bg);font-weight:var(--font-weight);overflow-y:scroll}.content img,.img,.content video,.video{max-width:100%;height:auto}.lead{margin-left:-1rem;margin-right:-1rem;margin-bottom:1.5rem}img.lead,video.lead{display:block;max-width:calc(100% + 2rem);width:calc(100% + 2rem);height:auto}.heading,.f1,h1,.h1,.f2,h2,.h2,.f3,h3,.h3,.f4,h4,.h4,.post-date,.sidebar-nav-item,.f5,h5,.h5,.f6,h6,.h6{font-family:var(--font-family-heading);font-weight:var(--font-weight-heading)}.f1,h1,.h1{font-size:2rem;line-height:1.3}.f2,h2,.h2{font-size:1.5rem;line-height:1.4}.f3,h3,.h3{font-size:1.2em;line-height:1.5}.f4,h4,.h4,.post-date,.sidebar-nav-item{font-size:1.08rem;line-height:1.6}.f5,h5,.h5{font-size:1.04rem;line-height:1.7}.f6,h6,.h6{font-size:1rem}.content h1>a,.content .h1>a{text-decoration:none;border-bottom:none}@media screen and (max-width: 42em){.content h1,.content .h1{font-size:1.7rem;line-height:1.35}}@media screen and (min-width: 86em){.content h1,.content .h1{font-size:2.4rem;line-height:1.25}}@media screen and (min-width: 1664px){body:not(.no-large-headings) .content h1,body:not(.no-large-headings) .content .h1{width:calc(100% + 50vw - 32rem);font-size:3rem;line-height:1.2}}@media screen and (min-width: 124em){body:not(.no-large-headings) .content h1,body:not(.no-large-headings) .content .h1{font-size:4rem;line-height:1.1}}h1,h2,h3,.h1,.h2,.h3{margin:4rem 0 1rem}h4,h5,h6,.h4,.post-date,.h5,.h6{margin:3rem 0 .5rem}p{margin-top:0;margin-bottom:1rem}p.lead{font-size:1.2em;margin-top:1.5rem;margin-bottom:1.5rem;padding:0 1rem}ul,ol,dl{margin-top:0;margin-bottom:1rem}ul,ol{padding-left:1.25rem}hr,.hr{border:0;margin:1rem 0;border-top:1px solid var(--border-color)}.hr-after::after{content:"";display:block;margin:1rem 0;border-top:1px solid var(--border-color)}.hr-bottom{border-bottom:1px solid var(--border-color);padding-bottom:.75rem;margin-bottom:1rem}.page{margin-bottom:3em}.page li+li{margin-top:.25rem}.page>header{position:relative;margin-bottom:1.5rem}@media screen and (min-width: 1664px){body:not(.no-third-column) .page>header>.lead+.note-sm,body:not(.no-third-column) .page>header>.lead+.note,body:not(.no-third-column) .page>header>.lead+#markdown-toc,body:not(.no-third-column) .page>header>a.no-hover+.note-sm,body:not(.no-third-column) .page>header>a.no-hover+.note,body:not(.no-third-column) .page>header>a.no-hover+#markdown-toc{position:absolute;right:-25rem;width:21rem;bottom:0;margin-bottom:0}}.page-title,.post-title{margin-top:0}.post-date{display:flex;justify-content:space-between;margin-top:-.6rem;height:2rem;margin-bottom:.85rem;color:var(--gray)}.post-date>.ellipsis,#breadcrumbs.post-date>ul{cursor:pointer}.post-date [class^="icon-"]{display:inline-block;font-size:smaller;margin-right:.25rem}.related-posts{padding-left:0;list-style:none;margin-bottom:2rem}.related-posts>li,.related-posts>li+li{margin-top:1rem}.message,.note-sm,.note,#markdown-toc{margin-bottom:1rem;padding:1rem;color:var(--gray-text);background-color:var(--gray-bg);margin-left:-1rem;margin-right:-1rem}.note-sm,.note,#markdown-toc{background:transparent;color:var(--body-color);font-size:smaller;border-left:1px solid var(--border-color);padding:1.2rem 1rem 0 1rem;margin:1rem -1rem;position:relative}.note-sm:before,.note:before,#markdown-toc:before{font-size:0.667rem;font-weight:bold;font-style:normal;letter-spacing:.025rem;text-transform:uppercase;color:var(--menu-text);position:absolute;top:0}.note-sm[title]:before,[title].note:before,[title]#markdown-toc:before{content:attr(title) !important}.note{font-size:1rem}@media screen{body::before{content:'';width:.5rem;background:var(--gray-bg);position:fixed;left:0;top:0;bottom:0}}@media (min-width: 64em){body::before{width:21rem}}@media (min-width: 1664px){body::before{width:calc(50% - 31rem)}}@media screen and (min-width: 42em){html{font-size:var(--root-font-size-medium)}}@media screen and (min-width: 124em){html{font-size:var(--root-font-size-large)}}#breadcrumbs>ul{height:1rem;margin:-1.5rem 0 .5rem;padding:0;font-size:.667rem;color:var(--menu-text);text-transform:uppercase;width:100%;list-style:none}#breadcrumbs>ul>li{display:inline}#breadcrumbs>ul>li a{color:var(--gray);text-decoration:none;border-bottom:none}.fl{float:left}.fr{float:right}.mb4{margin-bottom:4rem}.mb6{margin-bottom:6rem}.mt0{margin-top:0}.mt1{margin-top:1rem}.mt2{margin-top:2rem}.mt3{margin-top:3rem}.mt4{margin-top:4rem}.pb0{padding-bottom:0}.ml1{margin-left:1rem}.mr1{margin-right:1rem}.sixteen-nine{position:relative}.sixteen-nine::before{display:block;content:"";width:100%;padding-top:56.25%}.sixteen-nine>*{position:absolute;top:0;left:0;right:0;bottom:0}.sixteen-ten{position:relative}.sixteen-ten::before{display:block;content:"";width:100%;padding-top:62.5%}.sixteen-ten>*{position:absolute;top:0;left:0;right:0;bottom:0}.four-three{position:relative}.four-three::before{display:block;content:"";width:100%;padding-top:75%}.four-three>*{position:absolute;top:0;left:0;right:0;bottom:0}.sr-only{display:none}.larger{font-size:larger}.smaller{font-size:smaller}.clearfix,.sidebar-social::after{content:"";display:table;clear:both}.ellipsis,#breadcrumbs>ul{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.border{border:1px solid var(--border-color)}@media (min-width: 42em){.border-radius,.lead,.page .aspect-ratio.sixteen-nine.lead{border-radius:.5rem}}.fallback-img{background-position:center;background-repeat:no-repeat;background-image:url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB3aWR0aD0iMTYwIiBoZWlnaHQ9IjkwIiB2aWV3Qm94PSIwIDAgMTYwIDkwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxnIHRyYW5zZm9ybT0ibWF0cml4KDAuMDQ4ODI4LCAwLCAwLCAwLjA0Nzk5MSwgNTQuOTk5OTczLCAyMC40MjgxNDgpIj4KICAgIDxwYXRoIHN0eWxlPSJmaWxsOnJnYmEoMTI4LDEyOCwxMjgsLjMzKSIgZD0iTTk1OS44ODQgMTI4YzAuMDQwIDAuMDM0IDAuMDgyIDAuMDc2IDAuMTE2IDAuMTE2djc2Ny43N2MtMC4wMzQgMC4wNDAtMC4wNzYgMC4wODItMC4xMTYgMC4xMTZoLTg5NS43N2MtMC4wNDAtMC4wMzQtMC4wODItMC4wNzYtMC4xMTQtMC4xMTZ2LTc2Ny43NzJjMC4wMzQtMC4wNDAgMC4wNzYtMC4wODIgMC4xMTQtMC4xMTRoODk1Ljc3ek05NjAgNjRoLTg5NmMtMzUuMiAwLTY0IDI4LjgtNjQgNjR2NzY4YzAgMzUuMiAyOC44IDY0IDY0IDY0aDg5NmMzNS4yIDAgNjQtMjguOCA2NC02NHYtNzY4YzAtMzUuMi0yOC44LTY0LTY0LTY0djB6Ii8+CiAgICA8cGF0aCBzdHlsZT0iZmlsbDpyZ2JhKDEyOCwxMjgsMTI4LC4zMykiIGQ9Ik04MzIgMjg4YzAgNTMuMDIwLTQyLjk4IDk2LTk2IDk2cy05Ni00Mi45OC05Ni05NiA0Mi45OC05NiA5Ni05NiA5NiA0Mi45OCA5NiA5NnoiLz4KICAgIDxwYXRoIHN0eWxlPSJmaWxsOnJnYmEoMTI4LDEyOCwxMjgsLjMzKSIgZD0iTTg5NiA4MzJoLTc2OHYtMTI4bDIyNC0zODQgMjU2IDMyMGg2NGwyMjQtMTkyeiIvPgogIDwvZz4KPC9zdmc+")}hy-push-state a{color:var(--body-color)}@supports not ((text-decoration-thickness: initial) and (text-underline-offset: initial)){hy-push-state a{text-decoration:none;border-bottom:2px solid}}@supports (text-decoration-thickness: initial) and (text-underline-offset: initial){hy-push-state a{text-decoration-style:solid;text-underline-offset:.35rem;text-decoration-thickness:2px}}hy-push-state a.no-hover{border-bottom:none;text-decoration-thickness:unset;text-underline-offset:unset}.content a:not(.btn):not(.no-hover){border-color:var(--accent-color-faded)}@supports (text-decoration-thickness: initial) and (text-underline-offset: initial){.content a:not(.btn):not(.no-hover){text-decoration-color:var(--accent-color-faded)}}.content .aspect-ratio{overflow:hidden}.content .aspect-ratio img{margin:0;width:100%;height:100%;background-color:var(--gray-bg)}hy-drawer{width:100%;position:relative;overflow:hidden;display:block;z-index:4}@media screen and (min-width: 64em){hy-drawer{position:fixed;width:21rem;top:0;left:0;bottom:0;margin-left:0}hy-drawer.cover{position:relative;width:100%}}@media screen and (min-width: 1664px){hy-drawer{width:calc(50% - 31rem)}}.sidebar{position:relative;display:flex;justify-content:center;align-items:center;color:rgba(255,255,255,0.75);text-align:center;min-height:100vh}.sidebar.invert{color:rgba(32,32,32,0.75)}.sidebar a{color:#fff;border-bottom-color:rgba(255,255,255,0.2);text-decoration-color:rgba(255,255,255,0.2)}.sidebar.invert a{color:#222;border-bottom-color:rgba(32,32,32,0.2);text-decoration-color:rgba(32,32,32,0.2)}.sidebar-bg{position:absolute;top:0;left:calc(50% - 50vw);width:100vw;height:100%;background:#202020 center / cover}.sidebar-bg::after{content:"";position:absolute;top:0;left:0;bottom:0;right:0;background:rgba(0,0,0,0.05)}.sidebar-bg.sidebar-overlay::after{background:linear-gradient(to bottom, rgba(32,32,32,0) 0%, rgba(32,32,32,0.5) 50%, rgba(32,32,32,0) 100%)}.sidebar-sticky{position:relative;z-index:3;max-width:21rem;padding:1.5rem;contain:content}.sidebar-about .avatar{margin-bottom:1.5rem}.sidebar-about>a.sidebar-title{text-decoration:none}.sidebar-about>a.sidebar-title>h2{margin:0;padding-bottom:.5rem}.sidebar-about>a.sidebar-title::after{content:'';display:block;border-bottom:2px solid;margin:0 auto .5rem;width:4rem;border-color:rgba(255,255,255,0.2);transition:border-color 250ms}.sidebar-about>a.sidebar-title:hover::after{border-color:#fff;transition:border-color 50ms}.sidebar.invert .sidebar-about>a.sidebar-title::after{border-color:rgba(32,32,32,0.2)}.sidebar.invert .sidebar-about>a.sidebar-title:hover::after{border-color:#222}.sidebar-nav>ul{list-style:none;padding-left:0}.sidebar-nav-item{display:inline-block;margin-bottom:.5rem}@media (min-width: 64em){#_main.no-drawer #_menu{display:none}#_main.no-drawer .nav-btn-bar>:nth-child(2){border:none}}.sidebar-social>ul{display:inline-block;list-style:none;padding-left:0;margin-bottom:0}.sidebar-social>ul>li{float:left}.sidebar-social>ul>li>a{display:inline-block;text-align:center;font-size:1.4rem;width:3rem;height:4rem;padding:.5rem 0;line-height:3rem;text-decoration:none;border-bottom-width:2px;border-bottom-style:solid}.sidebar-social>ul li+li{margin-top:0}.fixed-common,.fixed-top,.fixed-bottom{position:fixed;left:0;width:100%;z-index:2}.fixed-top{top:0}.fixed-bottom{bottom:0}.navbar>.content{position:relative;padding-top:0;padding-bottom:0;min-height:0;max-height:5rem}.nav-btn-bar{margin:0 -1rem;background-color:white;background-color:var(--body-bg);height:5rem;display:flex;align-items:center;position:relative}.nav-btn-bar>:first-child,.nav-btn-bar>:last-child{border:none}.nav-btn{background:none;border:none;text-decoration:none;display:flex;align-items:center;justify-content:center;width:3.25rem;height:5rem;color:var(--menu-text);border-right:1px solid var(--border-color);border-left:1px solid var(--border-color);margin-left:-1px}#markdown-toc{margin:2rem -1rem 2rem calc(-1rem + 1px);padding-left:2.5rem;padding-bottom:.5rem}#markdown-toc:before{left:1rem}@media screen and (min-width: 1664px){body:not(.no-toc) #markdown-toc{position:absolute;z-index:4;width:20.5rem;right:0;margin:auto;overflow:auto}}@media screen and (min-width: 1664px){body.no-break-layout:not(.no-toc) #markdown-toc{width:calc(50% - 31rem)}}.content{margin-left:auto;margin-right:auto;padding:8rem 1rem 12rem}@media screen{.content{padding-left:1.5rem;min-height:100vh}}@media screen and (min-width: 42em){.content{max-width:42rem}}@media screen and (min-width: 54em){.content{max-width:48rem}}@media screen and (min-width: 64em){.content{padding-left:1rem;margin-left:24rem;margin-right:3rem}}@media screen and (min-width: 86em){.content{padding-top:9rem;margin-left:25rem;margin-right:4rem;max-width:54rem}}@media screen and (min-width: 1664px){.content{margin:auto}}.large-only{display:none}@media screen and (min-width: 1664px){.large-only{display:block}}.avatar{width:7rem;height:7rem;border-radius:100%;overflow:hidden;display:inline-block}.avatar img{width:100%}.content .avatar{float:right;box-sizing:content-box;border:1rem solid var(--body-bg);transition:border-color 1s ease;margin-top:-1.5rem;margin-right:-1rem}hr.dingbat{display:none}.center-image{margin:auto;display:block}.note:before{content:"Note"}.page>header>.note-sm:before,.page>header>.note:before,.page>header>#markdown-toc:before{content:"Description"}#markdown-toc:before{content:"Table of Contents"}.layout-resume .note-sm:before,.layout-resume .note:before,.layout-resume #markdown-toc:before{content:"Summary"} .clearfix,main:not(.layout-resume) .columns::after{content:"";display:table;clear:both}.color-transition,main:not(.layout-resume) .project-card{transition:none}main:not(.layout-resume) .columns{margin-left:-1rem;display:flex;flex-wrap:wrap;contain:content;padding-top:1rem;margin-top:1rem;padding-right:1rem;margin-right:-1rem}main:not(.layout-resume) .column{float:left;padding-left:1rem;margin-bottom:2rem;width:100%;display:flex}@media screen and (min-width: 42em){main:not(.layout-resume) .columns{margin-left:-2rem;margin-right:-2rem}main:not(.layout-resume) .column-1-2{width:50%}}@media screen and (min-width: 1664px){main:not(.layout-resume) .columns-break{width:calc(50vw + 25rem)}main:not(.layout-resume) .columns-break>.column-1-2,main:not(.layout-resume) .columns-break>.column-1{width:27.5rem}}@media print{main:not(.layout-resume) .columns{display:block}main:not(.layout-resume) .column{display:block;width:50%}}main:not(.layout-resume) .project-card{width:100%;color:var(--gray-text);background-color:var(--gray-bg);padding-bottom:1rem;position:relative;overflow:hidden;box-shadow:0.125rem 0.125rem 1rem rgba(0,0,0,0.2);contain:content;border-radius:.5rem;page-break-inside:avoid;transition:transform 500ms ease;will-change:transform}main:not(.layout-resume) .project-card:hover{transform:translateY(-0.25rem);transition:transform 250ms ease}main:not(.layout-resume) .project-card>a.flip-project{display:block}main:not(.layout-resume) .project-card>a.flip-project .project-card-img{margin-bottom:0}main:not(.layout-resume) .project-card>a.flip-project .project-card-img img{display:block;border-top-left-radius:.5rem;border-top-right-radius:.5rem}main:not(.layout-resume) .project-card a{position:relative;z-index:1}main:not(.layout-resume) .project-card a.fill-card{position:absolute;top:0;left:0;right:0;bottom:0;z-index:0}main:not(.layout-resume) .project-card>.project-card-title,main:not(.layout-resume) .project-card>.project-card-text{text-align:center;padding:0 1rem}main:not(.layout-resume) .project-card>.project-card-title{display:block;font-size:1.08rem;margin-top:.75rem;margin-bottom:.25rem;color:inherit}main:not(.layout-resume) .project-card>.project-card-text{margin:.25rem 0}main:not(.layout-resume) .column-1>.project-card>.project-card-title{font-size:1.2rem}main:not(.layout-resume) .column-1>.project-card>.project-card-text{font-size:1rem}</style><link rel="preload" as="style" href="/pages/colindembovsky/assets/css/hydejack-9.1.4.css" id="_stylePreload"><link rel="preload" as="style" href="/pages/colindembovsky/assets/icomoon/style.css" id="_iconsPreload"><link rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Roboto+Slab:700%7CNoto+Sans:400,400i,700,700i&display=swap" id="_fontsPreload"> <script> setRel('_stylePreload'); setRel('_iconsPreload'); /**/setRel('_fontsPreload');/**/ </script> <noscript><link rel="stylesheet" href="/pages/colindembovsky/assets/css/hydejack-9.1.4.css"><link rel="stylesheet" href="/pages/colindembovsky/assets/icomoon/style.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:700%7CNoto+Sans:400,400i,700,700i&display=swap"> </noscript><style id="_pageStyle"> html{--accent-color: rgb(79, 129, 220);--accent-color-faded: rgba(79,129,220,0.5);--accent-color-highlight: rgba(79,129,220,0.1);--accent-color-darkened: #2f6ad6;--theme-color: rgb(5,19,24);--dark-mode-body-bg: #292e30;--dark-mode-border-color: #353c3e}</style><!--<![endif]--> <script async src="https://www.googletagmanager.com/gtag/js?id=G-FD31RTDXK2"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-FD31RTDXK2'); </script><body class="no-break-layout"> <script> window._sunrise = 6; window._sunset = 18; !function(e,s){var d="light-mode",o="dark-mode",a=(new Date).getHours();"matchMedia"in e&&e.matchMedia("(prefers-color-scheme)")||(o=(e=a<=e._sunrise||a>=e._sunset?o:d)==o?d:o,s.body.classList.add(e),s.body.classList.remove(o))}(window,document); </script> <hy-push-state id="_pushState" replace-selector="#_main" link-selector="a[href]:not([href^='/pages/colindembovsky/assets/']):not(.external):not(.no-push-state)" script-selector="script" duration="500" hashchange ><div id="_navbar" class="navbar fixed-top"><div class="content"> <span class="sr-only">Jump to:</span><div class="nav-btn-bar"> <a id="_menu" class="nav-btn no-hover" href="#_drawer--opened"> <span class="sr-only">Navigation</span> <span class="icon-menu"></span> </a><div class="nav-span"></div></div></div></div><hr class="sr-only" hidden /><main id="_main" class="content layout-post" role="main" ><nav id="breadcrumbs" class="screen-only"><ul><li><a href="/pages/colindembovsky/">home</a><li> <span>/</span> <span>deployment-with-github-actions</span></ul></nav><article id="post-deployment-with-github-actions" class="page post mb6" role="article"><header><h1 class="post-title flip-project-title"> Deployment with GitHub Actions: The Bad and the Ugly</h1><div class="post-date"> <span class="ellipsis mr1"> <time datetime="2021-01-11T22:42:40+00:00">11 Jan 2021</time> on <a href="/pages/colindembovsky/tag/actions/" class="flip-title">actions</a> </span></div><p class="note-sm" > GitHub Actions can be used for Continuous Deployment (CD) - but there are some rough edges. In this post I take you through a deep dive and lift the kimono on Actions.</header><ol id="markdown-toc"><li><a href="#environments-stages-jobs-and-templates" id="markdown-toc-environments-stages-jobs-and-templates">Environments, Stages, Jobs and Templates</a><li><a href="#infrastructure-and-code" id="markdown-toc-infrastructure-and-code">Infrastructure and Code</a><li><a href="#tailwind-web-app" id="markdown-toc-tailwind-web-app">TailWind Web App</a><li><a href="#interlude-terraform-wrapper" id="markdown-toc-interlude-terraform-wrapper">Interlude: Terraform Wrapper</a><li><a href="#the-workaround" id="markdown-toc-the-workaround">The Workaround</a><li><a href="#secrets-and-approvals-on-environments" id="markdown-toc-secrets-and-approvals-on-environments">Secrets and Approvals on Environments</a><li><a href="#manual-triggers" id="markdown-toc-manual-triggers">Manual Triggers</a><li><a href="#disappearing-history---sort-of" id="markdown-toc-disappearing-history---sort-of">Disappearing History - Sort of</a><li><a href="#pesky-environment-url" id="markdown-toc-pesky-environment-url">Pesky Environment URL</a><li><a href="#fireside-chat-with-chris-patterson" id="markdown-toc-fireside-chat-with-chris-patterson">Fireside Chat with Chris Patterson</a><li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></ol><p>Let me start this post with three disclaimers:<ol><li><a href="https://docs.github.com/en/free-pro-team@latest/actions/reference/environments">GitHub Actions Environments</a> is in beta<li>I’m a huge fan of <a href="https://azure.microsoft.com/en-us/services/devops/pipelines/">Azure Pipelines</a>, which is a fairly mature product<li>The GitHub engineers (and PM <a href="https://github.com/chrispat">Chris Patterson</a>) have been amazing with answering my questions and helping me deep dive into Actions for CD</ol><p>Why start with disclaimers? Because (SPOILER ALERT) deployment with GitHub Actions is rough. Unfortunately, not even enough “good” to add “The Good” to the title of this post.<blockquote><p>Note: for ease of typing and reading, I’ll refer to GitHub Actions as simply Actions, and Azure Pipelines as simply Pipelines for the remainder of this post.</blockquote><p>Ever since Actions was born, the vision has been “code to cloud”. This vision is exactly correct and certainly demos nicely if you have a simple web app and a single environment. But how do you handle a more complex real-world scenario? How do you deploy and configure infrastructure? How do you model multiple environments? Where do you store secrets and environment settings? How do you handle approvals?<p>At GitHub Universe in December 2020, GitHub released Environments to Beta. This was the first baby step in moving towards a more “enterprise” deployment capability.<h2 id="environments-stages-jobs-and-templates">Environments, Stages, Jobs and Templates</h2><p>I’ve made a few Actions workflows and have always approached it as a slightly differently formatted Azure Pipeline that can only have jobs (no stages or environments). So when Actions Environments got released, I thought I’d approach Actions with the same paradigm I use when I create Pipelines.<p>I was wrong.<p>Firstly, I was annoyed that there is no such thing as a “<a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/process/stages?view=azure-devops&amp;tabs=yaml">stage</a>” in Actions. When writing Pipelines, I usually equate the <em>environment</em> with a <em>stage</em> and then run multiple jobs in each stage. This lets me create job <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/process/templates?view=azure-devops">templates</a> that I can reuse. Deployments should be as similar as possible between environments which I can easily model with parameterized templates.<p>But Actions doesn’t have templates - though it’s on the <a href="https://github.com/github/roadmap/issues/98">roadmap</a>. For now, I’ll just have to live with some copy-and-paste.<p>While there are no stages, I could conceptually map jobs to stages in an Action workflow, and use the <code class="language-plaintext highlighter-rouge">environment</code> attribute to tell GitHub that a job is targeting an environment. If I need multiple jobs for a stage, I can use a naming convention to loosely group them, even if the UI won’t.<p>Except that Actions behaves strangely when you have multiple jobs targeting a single environment (more about this later).<h2 id="infrastructure-and-code">Infrastructure and Code</h2><p>I bounce back and forth between having infrastructure and app code in the same pipeline or having separate pipelines for these concerns. Using Pipelines, I typically have an infrastructure job to get the environment resources spun up and/or configured, and then have a deployment job to deploy app code, and then have one or more test jobs for running tests. I always use a single build job to produce a single binary that is promoted between environments.<p>However, this can complicate approvals. Typically, ops folks will approve infrastructure changes, while dev folks will approve code deployments. As much as we should be working on cross-functional teams, it’s all too common to still see silos in the enterprise. And even on cross-functional teams, we’re usually all T-shaped - that is, we’re usually more “ops-ey” or more “dev-ey” and so approvals tend to fall along that divide. This scenario works fine with Pipelines since each job in the stage is targeting an environment and the approvals are defined on the environment. There’s no way of specifying who exactly should do the review, so the team will have to work out who’s approval is currently pending (is it for infra or for code). GitHub Environments have the same limitation.<p>After chatting through some of the challenges with Chris Patterson (PM for Actions) he suggested splitting infra and code into separate pipelines. I can at least trigger the infra pipeline only if infra code changes, and trigger the app pipeline for everything else this way.<h2 id="tailwind-web-app">TailWind Web App</h2><p>Let’s make this a bit more concrete. For ease of use, I’ll be using a DotNetCore app called TailWind originally from Microsoft, just so that I have some code I can deploy to Azure. I forked the <a href="https://github.com/microsoft/TailwindTraders-Website">Microsoft repo</a> and added in Terraform templates for the infra into <a href="https://github.com/10thmagnitude/TailwindTraders-Website">my version</a>. Now I have infra-as-code as well as the app code.<p>Using Azure Pipelines, I would have a workflow that looks something like this:<figure class="kg-card kg-image-card kg-card-hascaption"><img src="/assets/images/2021/1/111917_image.png" class="kg-image" alt="" loading="lazy" /><figcaption>Azure Pipeline for deploying TailWind Web App</figcaption></figure><p>There are multiple stages/jobs here: <!--kg-card-begin: markdown--><ol><li>Stage 1: Build and test sources<ul><li>this builds and packages the code and runs unit tests</ul><li>Stage 2: Deploy to DEV<ul><li>Run terraform to create/configure infrastructure in the DEV environment<li>Deploy the web app using the package from Stage 1<li>Run Selenium (coded UI) tests</ul><li>Stage 3: Canary deployment to PROD<ul><li>Run terraform to create/configure infrastructure in the PROD environment<li>Deploy the web app using the package from Stage 1<li>Route traffic to the staging slot<li>Run JMeter (load) tests</ul><li>Stage 4: Promote or Rollback<ul><li>Depending on the outcome of the tests against the Canary slot, we can either promote to PROD (slot swap) or simply route all traffic back to the production slot (this is effectively a rollback) <!--kg-card-end: markdown--></ul></ol><p>All the jobs in the Pipeline are templatized - you’ll note that I use the same <code class="language-plaintext highlighter-rouge">Run terraform</code> and <code class="language-plaintext highlighter-rouge">Deploy the web app</code> jobs in stage 2 and 3, just passing in environment specific values.<p>Since I don’t have stages in Actions, my initial Action workflow looked like this:<figure class="kg-card kg-image-card kg-card-hascaption"><img src="/assets/images/2021/1/111933_image.png" class="kg-image" alt="" loading="lazy" /><figcaption>End to end Action</figcaption></figure><p>Here I have the following jobs:<ol><li>build - builds and packages code (and would run unit tests here if I had any)<li>dev_infra_plan - runs <code class="language-plaintext highlighter-rouge">terraform plan</code> against the DEV environment<li>dev_infra_apply - downloads the output plan from the previous job and runs <code class="language-plaintext highlighter-rouge">terraform apply</code><li>dev_deploy - deploys web app package from job 1 to the DEV environment<li>prod_infra_plan - runs <code class="language-plaintext highlighter-rouge">terraform plan</code> against the PROD environment<li>prod_infra_apply - downloads the output plan from the previous job and runs <code class="language-plaintext highlighter-rouge">terraform apply</code><li>prod_deploy - deploys web app package from job 1 to the PROD environment</ol><p>Yes, I had to use copy and paste for jobs 2 and 5, 3 and 6 and 4 and 7. But I know templates are coming, so I could live with that for a while. However, the job got stuck in this state and I could never get to job 5 (the start of the PROD jobs). That’s when Chris Patterson helped me understand that because I have multiple jobs targeting the same environment(s) strange things are happening…<p>So it seems you shouldn’t have <em>multiple jobs targeting the same environment</em>. And you can’t have templates. Now I was faced with giant blocks of Actions that were reduced into BUILD-&gt;DEV-&gt;PROD with a single job for each. And a single approval for each.<p>Horrible. Just horrible.<h2 id="interlude-terraform-wrapper">Interlude: Terraform Wrapper</h2><p>Before I get to some workarounds for some of the challenges, I want to mention how I lost several hours of my life. Take a look at this snippet:<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install TF</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">hashicorp/setup-terraform@v1</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">terraform_version</span><span class="pi">:</span> <span class="s">${{ env.tf_version }}</span>
    
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Init TF</span>
      <span class="na">run</span><span class="pi">:</span> <span class="s">terraform init --backend-config="key=${{ env.env_name }}.terraform.tfstate"</span>
    
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">TF Output web app URL</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">url=$(terraform output -raw webAppURL)</span>
        <span class="s">echo "The URL is $url"</span>

</code></pre></div></div><p>This workflow snippet is really modelling the following commands:<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="s">terraform init --backend-config="key=DEV.terraform.tfstate"</span>
    <span class="s">url=$(terraform output -raw webAppURL)</span>
    <span class="s">echo "The URL is $url"</span>

</code></pre></div></div><p>When running these locally, I get <code class="language-plaintext highlighter-rouge">The URL is http://&lt;url&gt;</code> which is what I expect.<p>When running the workflow, I could not get this to work. I wasted a lot of time trying to figure out what I was doing wrong. The message looked something like this:<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The url is [command]/home/runner/work/_temp/056bc345-efd0-4b6d-ae6c-94094f124a7f/terraform-bin output -raw
</code></pre></div></div><p>Turns out that all I had done wrong was make an assumption about how the <code class="language-plaintext highlighter-rouge">hashicorp/setup-terraform@v1</code> task works. I assumed it just installed <code class="language-plaintext highlighter-rouge">terraform</code>. However, in this configuration, it installs <code class="language-plaintext highlighter-rouge">terraform</code> and creates a wrapper around the executable, so you cannot treat terraform commands as you would locally - you have to access the output parameters.<p>To be fair, the Hashi folks make this clear on their <a href="https://github.com/hashicorp/setup-terraform">documentation</a>, but I didn’t think I’d need to read the docs for running an install! I logged <a href="https://github.com/hashicorp/setup-terraform/issues/85">this issue</a> for them to update the logging so that others who make the same assumption don’t waste hours before realizing that the Action installs a wrapper by default.<p>So at this point, while I was trying hard to love Actions, it just wasn’t looking good.<h2 id="the-workaround">The Workaround</h2><blockquote><p>Note: Workflow code is <a href="https://github.com/10thmagnitude/TailwindTraders-Website/blob/main/.github/workflows/infra-end-to-end.yaml">here</a> for my infra end to end and <a href="https://github.com/10thmagnitude/TailwindTraders-Website/blob/main/.github/workflows/app-end-to-end.yaml">here</a> for my app end to end.</blockquote><p>The first thing to do was to split the infrastructure Actions from the code deployment Actions. This made the workflows more aligned to a single responsibility. Since approvals are still on the environments, I still don’t have a good way to separate infra approvals from code deployment approvals. I could create two environment objects in Actions that are conceptually the same environment, but that can get hard to manage if I have secrets (which are defined on the environment). Having two environments with the same settings means I have to duplicate all the settings.<h2 id="secrets-and-approvals-on-environments">Secrets and Approvals on Environments</h2><p>I need to reference DEV for both the <code class="language-plaintext highlighter-rouge">plan</code> and <code class="language-plaintext highlighter-rouge">approve</code> jobs so that I can authenticate to the Azure subscription. Ideally, <code class="language-plaintext highlighter-rouge">plan</code> would run without requiring an approval and then I can review the output of the plan before I run <code class="language-plaintext highlighter-rouge">apply</code>. However, since I need to reference the environment in both jobs, I have to approve both jobs. Azure Pipelines suffers a similar limitation.<p>I ended up with three environments: <code class="language-plaintext highlighter-rouge">DEV</code>, <code class="language-plaintext highlighter-rouge">PROD-PLAN</code> and <code class="language-plaintext highlighter-rouge">PROD</code>. I have defined the <code class="language-plaintext highlighter-rouge">AZURE_CREDENTIALS</code> secret for <code class="language-plaintext highlighter-rouge">PROD</code> at the repository level. That way, when any job refers to <code class="language-plaintext highlighter-rouge">$</code> by default it will get the credentials for <code class="language-plaintext highlighter-rouge">PROD</code>. For jobs running in <code class="language-plaintext highlighter-rouge">DEV</code>, I explicitly reference the <code class="language-plaintext highlighter-rouge">DEV</code> environment using the <code class="language-plaintext highlighter-rouge">environment</code> attribute. That way I can get the credentials for <code class="language-plaintext highlighter-rouge">DEV</code>.<p>Why did I default to <code class="language-plaintext highlighter-rouge">PROD</code> and not to <code class="language-plaintext highlighter-rouge">DEV</code>? The only reason was to avoid having to approve the <code class="language-plaintext highlighter-rouge">plan</code> job for <code class="language-plaintext highlighter-rouge">PROD</code>. What happens now is that I have an approval on the environment <code class="language-plaintext highlighter-rouge">prod</code> but I don’t reference that for the <code class="language-plaintext highlighter-rouge">prod-plan</code> job. Instead I reference <code class="language-plaintext highlighter-rouge">PROD-PLAN</code> just so that I know this is a deployment job - but there is no approval on this environment. The value for <code class="language-plaintext highlighter-rouge">$</code> is the PROD value, so the <code class="language-plaintext highlighter-rouge">terraform plan</code> goes ahead and performs a plan against <code class="language-plaintext highlighter-rouge">PROD</code>. The next job, <code class="language-plaintext highlighter-rouge">prod-apply</code> explicitly references <code class="language-plaintext highlighter-rouge">PROD</code> and so waits for the approval.<p>For <code class="language-plaintext highlighter-rouge">DEV</code> I don’t have approvals, so <code class="language-plaintext highlighter-rouge">plan</code> and <code class="language-plaintext highlighter-rouge">apply</code>, though both referencing <code class="language-plaintext highlighter-rouge">DEV</code> so that they get the <code class="language-plaintext highlighter-rouge">DEV</code> credentials, do not wait for approvals.<p>Of course, if I had a <code class="language-plaintext highlighter-rouge">UAT</code> environment, I’d have to choose to split it or just live with having to approve <code class="language-plaintext highlighter-rouge">plan</code> and <code class="language-plaintext highlighter-rouge">apply</code> jobs.<p>In fact, I don’t really need the <code class="language-plaintext highlighter-rouge">PROD-PLAN</code> environment at all in this case - there are no secrets for this faux environment and no approvals. But if infra folks did require an approval before running a <code class="language-plaintext highlighter-rouge">plan</code> I can just update the environment.<h2 id="manual-triggers">Manual Triggers</h2><p>You can create a manual trigger for a workflow - but there are some gotchas. Firstly, you have to specify a <code class="language-plaintext highlighter-rouge">workflow_dispatch</code> <code class="language-plaintext highlighter-rouge">on</code> event - even if it’s empty like so:<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="na">on</span><span class="pi">:</span>
      <span class="na">workflow_dispatch</span><span class="pi">:</span> <span class="c1"># manual trigger</span>
      <span class="na">push</span><span class="pi">:</span>
        <span class="na">branches</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">main</span>
        <span class="pi">-</span> <span class="s">actions</span>  

</code></pre></div></div><p>The empty <code class="language-plaintext highlighter-rouge">workflow_dispatch:</code> looks a bit odd, but that is the correct syntax.<p>And the “Run Workflow” button <strong>won’t appear for that workflow</strong> , even if it has the <code class="language-plaintext highlighter-rouge">workflow_dispatch</code> trigger, unless that workflow is in the default (<code class="language-plaintext highlighter-rouge">main</code> or <code class="language-plaintext highlighter-rouge">master</code> or whatever you’ve set your default branch to) branch.<h2 id="disappearing-history---sort-of">Disappearing History - Sort of</h2><p>Another issue with the UI is the tree of workflows to the left of the run history UI:<figure class="kg-card kg-image-card kg-card-hascaption"><img src="/assets/images/2021/1/112238_image.png" class="kg-image" alt="" loading="lazy" /><figcaption>Tree listing all workflows in the main branch of the repo</figcaption></figure><p>I initially had a workflow called <code class="language-plaintext highlighter-rouge">End to End</code>. When I split it into two files for <code class="language-plaintext highlighter-rouge">App Deploy End to End</code> and <code class="language-plaintext highlighter-rouge">Infra Deploy End to End</code>, the node in the tree for <code class="language-plaintext highlighter-rouge">End to End</code> disappeared. The runs are still in the list (the 210 results you can see in the screenshot) but I can’t filter by that workflow. I’m guessing that the tree on the left is built from <em>current</em> workflows in the .github folder in the main branch - so if you delete or rename a workflow, you’ll lose the node on the left.<h2 id="pesky-environment-url">Pesky Environment URL</h2><p>Let’s have a look at the <code class="language-plaintext highlighter-rouge">url</code> attribute of the <code class="language-plaintext highlighter-rouge">environment</code> in an app deployment workflow job:<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="na">prod_deploy</span><span class="pi">:</span>
      <span class="na">needs</span><span class="pi">:</span> <span class="s">prod_deploy_canary</span>
      <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
      <span class="na">environment</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">PROD</span>
        <span class="na">url</span><span class="pi">:</span> <span class="s">${{ steps.slot_swap.outputs.url }}</span>

</code></pre></div></div><p>This will set the URL of the job in the UI accordingly so that users can easily link to the environment - as long as it’s a <em>valid</em> URL. The URL has to start with <code class="language-plaintext highlighter-rouge">http://</code> or <code class="language-plaintext highlighter-rouge">https://</code> otherwise it won’t show anything. This foxed me for a while - since some <code class="language-plaintext highlighter-rouge">az cli</code> commands just output the URL without the protocol, like <code class="language-plaintext highlighter-rouge">somesite.azurewebsites.net</code>. Remember to prepend <code class="language-plaintext highlighter-rouge">http://</code> or they won’t show.<p>Another quirk is that the URL updates for all jobs referencing the environment. In my scenario, I have two jobs for the <code class="language-plaintext highlighter-rouge">PROD</code> environment: a canary deployment that deploys to a staging slot and a “full” deployment that performs a slot swap. For the canary job, the URL is <code class="language-plaintext highlighter-rouge">http://my-site-staging.azurewebsites.net</code> while for the “full” deployment the URL is <code class="language-plaintext highlighter-rouge">http://my-site.azurewebsites.net</code>. But both are targeting the <code class="language-plaintext highlighter-rouge">PROD</code> environment. Here is what the workflow looks like after the canary job:<figure class="kg-card kg-image-card kg-card-hascaption"><img src="/assets/images/2021/1/11214_image.png" class="kg-image" alt="" loading="lazy" /><figcaption>Workflow after the Canary job</figcaption></figure><p>However, after the <code class="language-plaintext highlighter-rouge">prod_deploy</code> job, the URL is updated for <code class="language-plaintext highlighter-rouge">PROD</code> which both jobs reference, and the UI ends up dropping the canary URL:<figure class="kg-card kg-image-card kg-card-hascaption"><img src="/assets/images/2021/1/11218_image.png" class="kg-image" alt="" loading="lazy" /><figcaption>Canary URL is gone</figcaption></figure><p>I’m not sure why Actions does this - perhaps both environments should show the final value? It’s strange that the value is wiped.<h2 id="fireside-chat-with-chris-patterson">Fireside Chat with Chris Patterson</h2><p>Chris Patterson (PM at Actions) kindly connected with me to walk through some of the challenges I was experiencing and questions I had. We also got to chat about some of the upcoming improvements that he and the team are planning. Rest assured that the GitHub team know that Actions Environments are in beta and have a lot of ideas for future features and improvements. Since Chris was PM of Azure Pipelines, he has a lot of experience with CI/CD tools and has a lot of experience of what worked well and what made life complicated. I don’t envy his job: make Actions simple to approach, but powerful. Make it deterministic, but dynamic - it’s a very fine balancing act.<h2 id="conclusion">Conclusion</h2><p>Actions is still relatively young and already it is the most popular CI tool on GitHub. It has some maturing to do to compete in the CD space. For now, I’d still recommend using GitHub for source control and security scanning, and use Azure DevOps for CI/CD Pipelines and Boards.<p>GitHub Actions still have a ways to go to become a mature CD tool. For now, you’re probably better off trying to craft your CD workflows as a single job per environment, splitting infrastructure and code deployments to reduce complexity in the overall workflow. Hopefully we’ll get templates too, as well as some way to better manage jobs that need environment values but are not actually deployment jobs (like <code class="language-plaintext highlighter-rouge">terraform plan</code> which needs values, but does not change the environment). And hopefully being able to have multiple jobs (like canary and full deploy) targeting the same environments will receive a better experience too. Lots of work for the engineering team to do still!<p>Finally, I’ll remind the reader that Actions are in beta - so some rough edges are to be expected. But there is a seed of promise there that we can fully expect to blossom soon!<p>Happy deploying!</article><hr class="dingbat related mb6" /><aside class="comments related" role="complementary"><h2 class="hr-bottom">Comments</h2><div id="giscus"><div></div></div><script> function toggle_giscus() { const c = document.body.classList; const dark = c.contains("dark-mode") || "_sunset" in window && !c.contains("light-mode") && matchMedia("(prefers-color-scheme: dark)").matches; const theme = dark ? "dark" : "light"; const scriptEl = document.createElement("script"); scriptEl.src = "https://giscus.app/client.js"; scriptEl.setAttribute("data-repo", "colindembovsky/colindembovsky.github.io"); scriptEl.setAttribute("data-repo-id", "MDEwOlJlcG9zaXRvcnk0MDczMjI3MjU="); scriptEl.setAttribute("data-category", "Giscussions"); scriptEl.setAttribute("data-category-id", "DIC_kwDOGEdAZc4B_F18"); scriptEl.setAttribute("data-mapping", "pathname"); scriptEl.setAttribute("data-reactions-enabled", "1"); scriptEl.setAttribute("data-emit-metadata", "colindembovsky/colindembovsky.github.io"); scriptEl.setAttribute("data-theme", theme); scriptEl.setAttribute("crossorigin", "anonymous"); const container = document.getElementById("giscus"); const old = container.firstElementChild; container.removeChild(old); container.appendChild(scriptEl); } document.addEventListener("hydejack-dark-mode-toggle", function() { toggle_giscus(); }); toggle_giscus(); </script></aside><aside class="other-projects related mb0" role="complementary"><h2>Related Posts</h2><div class="columns"><div class="column column-1-2"><article class="project-card"> <a href="/pages/colindembovsky/on-demand-ephemeral-self-hosted-runners/" class="no-hover no-print-link flip-project" tabindex="-1"><div class="project-card-img aspect-ratio sixteen-nine flip-project-img"> <img src="/pages/colindembovsky/assets/images/2021/10/self-hosted-runners/boom.jpeg" alt="On Demand Ephemeral Self-Hosted Runners" width="864" height="486" loading="lazy"/></div></a><h3 class="project-card-title flip-project-title"> <a href="/pages/colindembovsky/on-demand-ephemeral-self-hosted-runners/" class="flip-title">On Demand Ephemeral Self-Hosted Runners</a></h3><p class="project-card-text fine" property="disambiguatingDescription"> Do you need to deploy to private VNets using GitHub Actions, but don’t want to have to keep self-hosted runners running all the time? In this post I show you how you can use Ephemeral Runners to create on-demand self-hosted runners. <a class="fill-card no-hover" href="/pages/colindembovsky/on-demand-ephemeral-self-hosted-runners/" tabindex="-1"><span class="sr-only">Continue reading On Demand Ephemeral Self-Hosted Runners</span></a></article></div><div class="column column-1-2"><article class="project-card"> <a href="/pages/colindembovsky/musings-on-reusable-workflows/" class="no-hover no-print-link flip-project" tabindex="-1"><div class="project-card-img aspect-ratio sixteen-nine flip-project-img"> <img src="/pages/colindembovsky/assets/images/2021/10/reuse.jpeg" alt="Musings on GitHub Actions Reusable Workflows" width="864" height="486" loading="lazy"/></div></a><h3 class="project-card-title flip-project-title"> <a href="/pages/colindembovsky/musings-on-reusable-workflows/" class="flip-title">Musings on GitHub Actions Reusable Workflows</a></h3><p class="project-card-text fine" property="disambiguatingDescription"> Newly released Reusable Workflows allows you to reuse workflows in your GitHub workflows. While this still has some limitations, it’s still better than copy/paste! <a class="fill-card no-hover" href="/pages/colindembovsky/musings-on-reusable-workflows/" tabindex="-1"><span class="sr-only">Continue reading Musings on GitHub Actions Reusable Workflows</span></a></article></div></div></aside><aside class="related mb4" role="complementary"><h2 class="hr-bottom">Random Posts</h2><ul class="related-posts"><li class="h4"> <a href="/pages/colindembovsky/project-plans-agile-pizza-and-startups/" class="flip-title"><span>Project Plans, Agile, Pizza and Startups</span></a> <time class="faded fine" datetime="2014-04-14T17:49:00+00:00">14 Apr 2014</time><li class="h4"> <a href="/pages/colindembovsky/fix-inrelease-demo-hangs-on-kellers-2013-preview-vm/" class="flip-title"><span>Fix: InRelease Demo “Hangs” on Keller’s 2013 Preview VM</span></a> <time class="faded fine" datetime="2013-08-26T19:02:00+00:00">26 Aug 2013</time><li class="h4"> <a href="/pages/colindembovsky/vs-2012-rc-fakes-bugs-fixed/" class="flip-title"><span>VS 2012 RC – Fakes Bugs Fixed</span></a> <time class="faded fine" datetime="2012-06-20T19:27:00+00:00">20 Jun 2012</time></ul></aside><footer class="content" role="contentinfo"><hr/><p><small class="copyright">© 2021. All rights reserved. </small><hr class="sr-only"/></footer></main><hy-drawer id="_drawer" class="" side="left" threshold="10" noscroll ><header id="_sidebar" class="sidebar" role="banner"><div class="sidebar-bg sidebar-overlay" style="background-color:rgb(5,19,24);background-image:url(/pages/colindembovsky/assets/img/sidebar-bg.jpg)"></div><div class="sidebar-sticky"><div class="sidebar-about"> <a class="no-hover" href="/pages/colindembovsky/" tabindex="-1"> <img src="/pages/colindembovsky/assets/img/logo.png" class="avatar" alt="Colin's ALM Corner" width="120" height="120" loading="lazy" /> </a> <a class="sidebar-title" href="/pages/colindembovsky/"><h2 class="h1">Colin's ALM Corner</h2></a><p class=""> DevOpsology &amp; GitHub. <br /> <em>Opinions my own</em>.</div><nav class="sidebar-nav heading" role="navigation"> <span class="sr-only">Navigation:</span><ul><li> <a id="_drawer--opened" href="/pages/colindembovsky/tags/" class="sidebar-nav-item " > Tags </a><li> <a href="/pages/colindembovsky/about/" class="sidebar-nav-item " > About </a></ul></nav><div class="sidebar-social"> <span class="sr-only">Social:</span><ul><li> <a href="https://twitter.com/colindembovsky" title="Twitter" class="no-mark-external"> <span class="icon-twitter"></span> <span class="sr-only">Twitter</span> </a><li> <a href="https://github.com/colindembovsky" title="GitHub" class="no-mark-external"> <span class="icon-github"></span> <span class="sr-only">GitHub</span> </a><li> <a href="https://colinsalmcorner.com/feed.xml" title="RSS" class="no-mark-external"> <span class="icon-rss2"></span> <span class="sr-only">RSS</span> </a></ul></div></div></header></hy-drawer><hr class="sr-only" hidden /> </hy-push-state> <!--[if gt IE 10]><!----> <script nomodule>!function(){var t,n=document.createElement("script");!("noModule"in n)&&"onbeforeload"in n&&(t=!1,document.addEventListener("beforeload",function(e){if(e.target===n)t=!0;else if(!e.target.hasAttribute("nomodule")||!t)return;e.preventDefault()},!0),n.type="module",n.src=".",document.head.appendChild(n),n.remove())}(); </script> <script src="/pages/colindembovsky/assets/js/hydejack-9.1.4.js" type="module"></script> <script src="/pages/colindembovsky/assets/js/LEGACY-hydejack-9.1.4.js" nomodule defer></script> <script type="module"> if ('serviceWorker' in navigator) { /**/ navigator.serviceWorker.getRegistration() .then(r => r.unregister()) .catch(() => {}); /**/ } </script> <!--<![endif]--><div hidden><h2 class="sr-only">Templates (for web app):</h2><clap-config> <clap-text at="1">Keep going!</clap-text> <clap-text at="2">Keep going ×2!</clap-text> <clap-text at="3">Give me more!</clap-text> <clap-text at="5">Thank you, thank you</clap-text> <clap-text at="7">Far too kind!</clap-text> <clap-text at="10">Never gonna give me up?</clap-text> <clap-text at="14">Never gonna let me down?</clap-text> <clap-text at="20">Turn around and desert me!</clap-text> <clap-text at="30">You're an addict!</clap-text> <clap-text at="40">Son of a clapper!</clap-text> <clap-text at="50">No way</clap-text> <clap-text at="60">Go back to work!</clap-text> <clap-text at="70">This is getting out of <em>hand</em></clap-text> <clap-text at="80">Unbelievable</clap-text> <clap-text at="90">PREPOSTEROUS</clap-text> <clap-text at="100">I N S A N I T Y</clap-text> <clap-text at="185"><span style="font-family:monospace">FEED ME A STRAY CAT</span></clap-text> </clap-config> <template id="_animation-template"><div class="animation-main fixed-top"><nav id="breadcrumbs" class="screen-only"><ul></ul></nav><div class="content"><div class="page"></div></div></div></template> <template id="_loading-template"><div class="loading nav-btn fr"> <span class="sr-only">Loading…</span> <span class="icon-cog"></span></div></template> <template id="_error-template"><div class="page"><h1 class="page-title">Error</h1><p class="lead"> Sorry, an error occurred while loading <a class="this-link" href=""></a>.</div></template> <template id="_permalink-template"> <a href="#" class="permalink"> <span class="sr-only">Permalink</span> <span class="content-hash"></span> </a> </template> <template id="_cookies-banner-template"><div id="_cookies-banner" class="navbar fixed-bottom CookiesOK"><div class="content"><div class="nav-btn-bar"> <small class="faded"> <span>This site uses cookies. <a href="/cookies-policy/">Cookies Policy</a>. </span> <button id="_cookies-ok" class="btn btn-primary btn-sm">Okay</button> </small></div></div></div></template> <template id="_dark-mode-template"> <button id="_dark-mode" class="nav-btn no-hover" > <span class="sr-only">Dark Mode</span> <span class="icon-brightness-contrast"></span> </button> </template> <template id="_search-template"> <button id="_search" class="nav-btn no-hover"> <label class="sr-only" for="_search-input">Search</label> <span class="icon-search"></span> </button><div id="_search-box"><div class="nav-btn"> <span class="icon-search"></span></div><input id="_search-input" type="search" class="form-control form-control-lg nav-btn" placeholder="Type something…" /> <button type="reset" class="nav-btn no-hover"> <span class="sr-only">Close</span> <span class="icon-cross"></span> </button></div><div id="_hits"></div></template></div></html>
