<!DOCTYPE html>
<html lang="en"><head><title>GitHub Composite Actions | Colin’s ALM Corner</title><meta name="generator" content="Jekyll v3.9.0" /><meta property="og:title" content="GitHub Composite Actions" /><meta name="author" content="Colin Dembovsky" /><meta property="og:locale" content="en" /><meta name="description" content="Composite Actions now allow you to run other Actions, not just script steps. This is great for composability and maintainability, but there are some limitations that you should be aware of." /><meta property="og:description" content="Composite Actions now allow you to run other Actions, not just script steps. This is great for composability and maintainability, but there are some limitations that you should be aware of." /><link rel="canonical" href="https://github.com/pages/colindembovsky/github-composite-actions/" /><meta property="og:url" content="https://github.com/pages/colindembovsky/github-composite-actions/" /><meta property="og:site_name" content="Colin’s ALM Corner" /><meta property="og:image" content="https://github.com/pages/colindembovsky/assets/images/posts/actions.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-09-01T17:22:01+00:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://github.com/pages/colindembovsky/assets/images/posts/actions.png" /><meta property="twitter:title" content="GitHub Composite Actions" /><meta name="twitter:site" content="@colindembovsky" /><meta name="twitter:creator" content="@colindembovsky" /> <script type="application/ld+json"> {"description":"Composite Actions now allow you to run other Actions, not just script steps. This is great for composability and maintainability, but there are some limitations that you should be aware of.","url":"https://github.com/pages/colindembovsky/github-composite-actions/","@type":"BlogPosting","headline":"GitHub Composite Actions","dateModified":"2021-09-01T17:22:01+00:00","datePublished":"2021-09-01T17:22:01+00:00","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://github.com/pages/colindembovsky/assets/img/logo.png"},"name":"Colin Dembovsky"},"image":"https://github.com/pages/colindembovsky/assets/images/posts/actions.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://github.com/pages/colindembovsky/github-composite-actions/"},"author":{"@type":"Person","name":"Colin Dembovsky"},"@context":"https://schema.org"}</script><meta name="keywords" content="devops,github,actions,build,ci,cd"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Colin's ALM Corner"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="application-name" content="Colin's ALM Corner"><meta name="theme-color" content="rgb(5,19,24)"><meta name="generator" content="Hydejack v9.1.4" /><link rel="alternate" href="https://github.com/pages/colindembovsky/github-composite-actions/" hreflang="en"><link type="application/atom+xml" rel="alternate" href="https://github.com/pages/colindembovsky/feed.xml" title="Colin's ALM Corner" /><link rel="shortcut icon" href="/pages/colindembovsky/assets/icons/favicon.ico"><link rel="apple-touch-icon" href="/pages/colindembovsky/assets/icons/icon-192x192.png"><link rel="manifest" href="/pages/colindembovsky/assets/site.webmanifest"><link rel="dns-prefetch" href="https://fonts.googleapis.com"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preload" href="/pages/colindembovsky/assets/img/swipe.svg" as="image" id="_hrefSwipeSVG"><link rel="dns-prefetch" href="/pages/colindembovsky/assets/js/search-worker-9.1.4.js" as="worker" id="_hrefSearch"> <script>!function(r,c){"use strict";function a(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}r.loadJS=function(e,t){var n=c.createElement("script");n.src=e,t&&a(n,"load",t,{once:!0});t=c.scripts[0];return t.parentNode.insertBefore(n,t),n},r._loaded=!1,r.loadJSDeferred=function(e,t){var n=c.createElement("script");function o(){r._loaded=!0,t&&a(n,"load",t,{once:!0});var e=c.scripts[0];e.parentNode.insertBefore(n,e)}return n.src=e,r._loaded?o():a(r,"load",o,{once:!0}),n},r.setRel=r.setRelStylesheet=function(e){a(c.getElementById(e),"load",function(){this.rel="stylesheet"},{once:!0})}}(window,document); !function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this); !function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this); !function(w) { w._baseURL = '/pages/colindembovsky/'; w._publicPath = '/pages/colindembovsky/assets/js/'; w._noPushState = false; w._noDrawer = false; w._noNavbar = false; w._noToc = false; w._noSearch = false; w._advertise = false; w._search = { DATA_URL: '/pages/colindembovsky/assets/sitedata.json?no-cache', STORAGE_KEY: 'mini-search/pages/colindembovsky/', INDEX_KEY: 'index--2021-11-18T20:23:33+00:00', }; w._clapButton = false; }(window);</script> <script async src="/pages/colindembovsky/assets/bower_components/MathJax/es5/tex-mml-chtml.js" id="_MathJax"></script> <!--[if gt IE 8]><!----><style id="_styleInline"> .clearfix,.sidebar-social::after{content:"";display:table;clear:both}.color-transition,body,p,hr,.hr,.hr-after::after,.hr-bottom,.message,.note-sm,.note,#markdown-toc,.navbar,.nav-btn-bar,.nav-btn,.content .avatar{transition:none}#_dark-mode{font-size:1.25rem}@media screen{body.light-mode{--body-color: #333;--body-bg: #fff;--border-color: #ebebeb;--gray: #777;--gray-bg: rgba(0,0,0,0.025);--gray-text: #666;--menu-text: #bbb;--inv-body-color: #ccc;--inv-body-bg: var(--dark-mode-body-bg)}body.light-mode .content{-webkit-font-smoothing:initial;-moz-osx-font-smoothing:initial}body.dark-mode{--body-color: #ccc;--body-bg: var(--dark-mode-body-bg);--border-color: var(--dark-mode-border-color);--gray: rgba(255,255,255,.5);--gray-bg: rgba(255,255,255,.033);--gray-text: rgba(255,255,255,.625);--menu-text: rgba(255,255,255,.25);--inv-body-color: #333;--inv-body-bg: #fff}body.dark-mode .content{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media screen and (prefers-color-scheme: dark){body{--body-color: #ccc;--body-bg: var(--dark-mode-body-bg);--border-color: var(--dark-mode-border-color);--gray: rgba(255,255,255,.5);--gray-bg: rgba(255,255,255,.033);--gray-text: rgba(255,255,255,.625);--menu-text: rgba(255,255,255,.25);--inv-body-color: #333;--inv-body-bg: #fff}body .content{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.tippy-content{-webkit-font-smoothing:initial;-moz-osx-font-smoothing:initial}}html{--font-family: Noto Sans,Helvetica,Arial,sans-serif;--font-family-heading: Roboto Slab,Helvetica,Arial,sans-serif;--code-font-family: Fira Code,Menlo,Monaco,Consolas,monospace;--body-color: #333;--body-bg: #fff;--border-color: #ebebeb;--gray: #777;--gray-bg: rgba(0,0,0,0.025);--gray-text: #666;--menu-text: #bbb;--inv-body-color: #ccc;--inv-body-bg: var(--dark-mode-body-bg);--root-font-size: 15px;--root-font-size-medium: 16px;--root-font-size-large: 17px;--root-font-size-print: 8pt;--root-line-height: 1.75;--font-weight: 400;--font-weight-bold: 700;--font-weight-heading: 700;--content-width-5: 54rem;--content-margin-5: 4rem;--sidebar-width: 21rem;--half-content: 31rem;--break-point-3: 64em;--break-point-5: 86em;--break-point-dynamic: 1664px}html .content{-webkit-font-smoothing:initial;-moz-osx-font-smoothing:initial}*{box-sizing:border-box}html,body{margin:0;padding:0}html{font-family:var(--font-family);font-size:var(--root-font-size);line-height:var(--root-line-height)}body{color:var(--body-color);background-color:var(--body-bg);font-weight:var(--font-weight);overflow-y:scroll}.content img,.img,.content video,.video{max-width:100%;height:auto}.lead{margin-left:-1rem;margin-right:-1rem;margin-bottom:1.5rem}img.lead,video.lead{display:block;max-width:calc(100% + 2rem);width:calc(100% + 2rem);height:auto}.heading,.f1,h1,.h1,.f2,h2,.h2,.f3,h3,.h3,.f4,h4,.h4,.post-date,.sidebar-nav-item,.f5,h5,.h5,.f6,h6,.h6{font-family:var(--font-family-heading);font-weight:var(--font-weight-heading)}.f1,h1,.h1{font-size:2rem;line-height:1.3}.f2,h2,.h2{font-size:1.5rem;line-height:1.4}.f3,h3,.h3{font-size:1.2em;line-height:1.5}.f4,h4,.h4,.post-date,.sidebar-nav-item{font-size:1.08rem;line-height:1.6}.f5,h5,.h5{font-size:1.04rem;line-height:1.7}.f6,h6,.h6{font-size:1rem}.content h1>a,.content .h1>a{text-decoration:none;border-bottom:none}@media screen and (max-width: 42em){.content h1,.content .h1{font-size:1.7rem;line-height:1.35}}@media screen and (min-width: 86em){.content h1,.content .h1{font-size:2.4rem;line-height:1.25}}@media screen and (min-width: 1664px){body:not(.no-large-headings) .content h1,body:not(.no-large-headings) .content .h1{width:calc(100% + 50vw - 32rem);font-size:3rem;line-height:1.2}}@media screen and (min-width: 124em){body:not(.no-large-headings) .content h1,body:not(.no-large-headings) .content .h1{font-size:4rem;line-height:1.1}}h1,h2,h3,.h1,.h2,.h3{margin:4rem 0 1rem}h4,h5,h6,.h4,.post-date,.h5,.h6{margin:3rem 0 .5rem}p{margin-top:0;margin-bottom:1rem}p.lead{font-size:1.2em;margin-top:1.5rem;margin-bottom:1.5rem;padding:0 1rem}ul,ol,dl{margin-top:0;margin-bottom:1rem}ul,ol{padding-left:1.25rem}hr,.hr{border:0;margin:1rem 0;border-top:1px solid var(--border-color)}.hr-after::after{content:"";display:block;margin:1rem 0;border-top:1px solid var(--border-color)}.hr-bottom{border-bottom:1px solid var(--border-color);padding-bottom:.75rem;margin-bottom:1rem}.page{margin-bottom:3em}.page li+li{margin-top:.25rem}.page>header{position:relative;margin-bottom:1.5rem}@media screen and (min-width: 1664px){body:not(.no-third-column) .page>header>.lead+.note-sm,body:not(.no-third-column) .page>header>.lead+.note,body:not(.no-third-column) .page>header>.lead+#markdown-toc,body:not(.no-third-column) .page>header>a.no-hover+.note-sm,body:not(.no-third-column) .page>header>a.no-hover+.note,body:not(.no-third-column) .page>header>a.no-hover+#markdown-toc{position:absolute;right:-25rem;width:21rem;bottom:0;margin-bottom:0}}.page-title,.post-title{margin-top:0}.post-date{display:flex;justify-content:space-between;margin-top:-.6rem;height:2rem;margin-bottom:.85rem;color:var(--gray)}.post-date>.ellipsis,#breadcrumbs.post-date>ul{cursor:pointer}.post-date [class^="icon-"]{display:inline-block;font-size:smaller;margin-right:.25rem}.related-posts{padding-left:0;list-style:none;margin-bottom:2rem}.related-posts>li,.related-posts>li+li{margin-top:1rem}.message,.note-sm,.note,#markdown-toc{margin-bottom:1rem;padding:1rem;color:var(--gray-text);background-color:var(--gray-bg);margin-left:-1rem;margin-right:-1rem}.note-sm,.note,#markdown-toc{background:transparent;color:var(--body-color);font-size:smaller;border-left:1px solid var(--border-color);padding:1.2rem 1rem 0 1rem;margin:1rem -1rem;position:relative}.note-sm:before,.note:before,#markdown-toc:before{font-size:0.667rem;font-weight:bold;font-style:normal;letter-spacing:.025rem;text-transform:uppercase;color:var(--menu-text);position:absolute;top:0}.note-sm[title]:before,[title].note:before,[title]#markdown-toc:before{content:attr(title) !important}.note{font-size:1rem}@media screen{body::before{content:'';width:.5rem;background:var(--gray-bg);position:fixed;left:0;top:0;bottom:0}}@media (min-width: 64em){body::before{width:21rem}}@media (min-width: 1664px){body::before{width:calc(50% - 31rem)}}@media screen and (min-width: 42em){html{font-size:var(--root-font-size-medium)}}@media screen and (min-width: 124em){html{font-size:var(--root-font-size-large)}}#breadcrumbs>ul{height:1rem;margin:-1.5rem 0 .5rem;padding:0;font-size:.667rem;color:var(--menu-text);text-transform:uppercase;width:100%;list-style:none}#breadcrumbs>ul>li{display:inline}#breadcrumbs>ul>li a{color:var(--gray);text-decoration:none;border-bottom:none}.fl{float:left}.fr{float:right}.mb4{margin-bottom:4rem}.mb6{margin-bottom:6rem}.mt0{margin-top:0}.mt1{margin-top:1rem}.mt2{margin-top:2rem}.mt3{margin-top:3rem}.mt4{margin-top:4rem}.pb0{padding-bottom:0}.ml1{margin-left:1rem}.mr1{margin-right:1rem}.sixteen-nine{position:relative}.sixteen-nine::before{display:block;content:"";width:100%;padding-top:56.25%}.sixteen-nine>*{position:absolute;top:0;left:0;right:0;bottom:0}.sixteen-ten{position:relative}.sixteen-ten::before{display:block;content:"";width:100%;padding-top:62.5%}.sixteen-ten>*{position:absolute;top:0;left:0;right:0;bottom:0}.four-three{position:relative}.four-three::before{display:block;content:"";width:100%;padding-top:75%}.four-three>*{position:absolute;top:0;left:0;right:0;bottom:0}.sr-only{display:none}.larger{font-size:larger}.smaller{font-size:smaller}.clearfix,.sidebar-social::after{content:"";display:table;clear:both}.ellipsis,#breadcrumbs>ul{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.border{border:1px solid var(--border-color)}@media (min-width: 42em){.border-radius,.lead,.page .aspect-ratio.sixteen-nine.lead{border-radius:.5rem}}.fallback-img{background-position:center;background-repeat:no-repeat;background-image:url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB3aWR0aD0iMTYwIiBoZWlnaHQ9IjkwIiB2aWV3Qm94PSIwIDAgMTYwIDkwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxnIHRyYW5zZm9ybT0ibWF0cml4KDAuMDQ4ODI4LCAwLCAwLCAwLjA0Nzk5MSwgNTQuOTk5OTczLCAyMC40MjgxNDgpIj4KICAgIDxwYXRoIHN0eWxlPSJmaWxsOnJnYmEoMTI4LDEyOCwxMjgsLjMzKSIgZD0iTTk1OS44ODQgMTI4YzAuMDQwIDAuMDM0IDAuMDgyIDAuMDc2IDAuMTE2IDAuMTE2djc2Ny43N2MtMC4wMzQgMC4wNDAtMC4wNzYgMC4wODItMC4xMTYgMC4xMTZoLTg5NS43N2MtMC4wNDAtMC4wMzQtMC4wODItMC4wNzYtMC4xMTQtMC4xMTZ2LTc2Ny43NzJjMC4wMzQtMC4wNDAgMC4wNzYtMC4wODIgMC4xMTQtMC4xMTRoODk1Ljc3ek05NjAgNjRoLTg5NmMtMzUuMiAwLTY0IDI4LjgtNjQgNjR2NzY4YzAgMzUuMiAyOC44IDY0IDY0IDY0aDg5NmMzNS4yIDAgNjQtMjguOCA2NC02NHYtNzY4YzAtMzUuMi0yOC44LTY0LTY0LTY0djB6Ii8+CiAgICA8cGF0aCBzdHlsZT0iZmlsbDpyZ2JhKDEyOCwxMjgsMTI4LC4zMykiIGQ9Ik04MzIgMjg4YzAgNTMuMDIwLTQyLjk4IDk2LTk2IDk2cy05Ni00Mi45OC05Ni05NiA0Mi45OC05NiA5Ni05NiA5NiA0Mi45OCA5NiA5NnoiLz4KICAgIDxwYXRoIHN0eWxlPSJmaWxsOnJnYmEoMTI4LDEyOCwxMjgsLjMzKSIgZD0iTTg5NiA4MzJoLTc2OHYtMTI4bDIyNC0zODQgMjU2IDMyMGg2NGwyMjQtMTkyeiIvPgogIDwvZz4KPC9zdmc+")}hy-push-state a{color:var(--body-color)}@supports not ((text-decoration-thickness: initial) and (text-underline-offset: initial)){hy-push-state a{text-decoration:none;border-bottom:2px solid}}@supports (text-decoration-thickness: initial) and (text-underline-offset: initial){hy-push-state a{text-decoration-style:solid;text-underline-offset:.35rem;text-decoration-thickness:2px}}hy-push-state a.no-hover{border-bottom:none;text-decoration-thickness:unset;text-underline-offset:unset}.content a:not(.btn):not(.no-hover){border-color:var(--accent-color-faded)}@supports (text-decoration-thickness: initial) and (text-underline-offset: initial){.content a:not(.btn):not(.no-hover){text-decoration-color:var(--accent-color-faded)}}.content .aspect-ratio{overflow:hidden}.content .aspect-ratio img{margin:0;width:100%;height:100%;background-color:var(--gray-bg)}hy-drawer{width:100%;position:relative;overflow:hidden;display:block;z-index:4}@media screen and (min-width: 64em){hy-drawer{position:fixed;width:21rem;top:0;left:0;bottom:0;margin-left:0}hy-drawer.cover{position:relative;width:100%}}@media screen and (min-width: 1664px){hy-drawer{width:calc(50% - 31rem)}}.sidebar{position:relative;display:flex;justify-content:center;align-items:center;color:rgba(255,255,255,0.75);text-align:center;min-height:100vh}.sidebar.invert{color:rgba(32,32,32,0.75)}.sidebar a{color:#fff;border-bottom-color:rgba(255,255,255,0.2);text-decoration-color:rgba(255,255,255,0.2)}.sidebar.invert a{color:#222;border-bottom-color:rgba(32,32,32,0.2);text-decoration-color:rgba(32,32,32,0.2)}.sidebar-bg{position:absolute;top:0;left:calc(50% - 50vw);width:100vw;height:100%;background:#202020 center / cover}.sidebar-bg::after{content:"";position:absolute;top:0;left:0;bottom:0;right:0;background:rgba(0,0,0,0.05)}.sidebar-bg.sidebar-overlay::after{background:linear-gradient(to bottom, rgba(32,32,32,0) 0%, rgba(32,32,32,0.5) 50%, rgba(32,32,32,0) 100%)}.sidebar-sticky{position:relative;z-index:3;max-width:21rem;padding:1.5rem;contain:content}.sidebar-about .avatar{margin-bottom:1.5rem}.sidebar-about>a.sidebar-title{text-decoration:none}.sidebar-about>a.sidebar-title>h2{margin:0;padding-bottom:.5rem}.sidebar-about>a.sidebar-title::after{content:'';display:block;border-bottom:2px solid;margin:0 auto .5rem;width:4rem;border-color:rgba(255,255,255,0.2);transition:border-color 250ms}.sidebar-about>a.sidebar-title:hover::after{border-color:#fff;transition:border-color 50ms}.sidebar.invert .sidebar-about>a.sidebar-title::after{border-color:rgba(32,32,32,0.2)}.sidebar.invert .sidebar-about>a.sidebar-title:hover::after{border-color:#222}.sidebar-nav>ul{list-style:none;padding-left:0}.sidebar-nav-item{display:inline-block;margin-bottom:.5rem}@media (min-width: 64em){#_main.no-drawer #_menu{display:none}#_main.no-drawer .nav-btn-bar>:nth-child(2){border:none}}.sidebar-social>ul{display:inline-block;list-style:none;padding-left:0;margin-bottom:0}.sidebar-social>ul>li{float:left}.sidebar-social>ul>li>a{display:inline-block;text-align:center;font-size:1.4rem;width:3rem;height:4rem;padding:.5rem 0;line-height:3rem;text-decoration:none;border-bottom-width:2px;border-bottom-style:solid}.sidebar-social>ul li+li{margin-top:0}.fixed-common,.fixed-top,.fixed-bottom{position:fixed;left:0;width:100%;z-index:2}.fixed-top{top:0}.fixed-bottom{bottom:0}.navbar>.content{position:relative;padding-top:0;padding-bottom:0;min-height:0;max-height:5rem}.nav-btn-bar{margin:0 -1rem;background-color:white;background-color:var(--body-bg);height:5rem;display:flex;align-items:center;position:relative}.nav-btn-bar>:first-child,.nav-btn-bar>:last-child{border:none}.nav-btn{background:none;border:none;text-decoration:none;display:flex;align-items:center;justify-content:center;width:3.25rem;height:5rem;color:var(--menu-text);border-right:1px solid var(--border-color);border-left:1px solid var(--border-color);margin-left:-1px}#markdown-toc{margin:2rem -1rem 2rem calc(-1rem + 1px);padding-left:2.5rem;padding-bottom:.5rem}#markdown-toc:before{left:1rem}@media screen and (min-width: 1664px){body:not(.no-toc) #markdown-toc{position:absolute;z-index:4;width:20.5rem;right:0;margin:auto;overflow:auto}}@media screen and (min-width: 1664px){body.no-break-layout:not(.no-toc) #markdown-toc{width:calc(50% - 31rem)}}.content{margin-left:auto;margin-right:auto;padding:8rem 1rem 12rem}@media screen{.content{padding-left:1.5rem;min-height:100vh}}@media screen and (min-width: 42em){.content{max-width:42rem}}@media screen and (min-width: 54em){.content{max-width:48rem}}@media screen and (min-width: 64em){.content{padding-left:1rem;margin-left:24rem;margin-right:3rem}}@media screen and (min-width: 86em){.content{padding-top:9rem;margin-left:25rem;margin-right:4rem;max-width:54rem}}@media screen and (min-width: 1664px){.content{margin:auto}}.large-only{display:none}@media screen and (min-width: 1664px){.large-only{display:block}}.avatar{width:7rem;height:7rem;border-radius:100%;overflow:hidden;display:inline-block}.avatar img{width:100%}.content .avatar{float:right;box-sizing:content-box;border:1rem solid var(--body-bg);transition:border-color 1s ease;margin-top:-1.5rem;margin-right:-1rem}hr.dingbat{display:none}.center-image{margin:auto;display:block}.note:before{content:"Note"}.page>header>.note-sm:before,.page>header>.note:before,.page>header>#markdown-toc:before{content:"Description"}#markdown-toc:before{content:"Table of Contents"}.layout-resume .note-sm:before,.layout-resume .note:before,.layout-resume #markdown-toc:before{content:"Summary"} .clearfix,main:not(.layout-resume) .columns::after{content:"";display:table;clear:both}.color-transition,main:not(.layout-resume) .project-card{transition:none}main:not(.layout-resume) .columns{margin-left:-1rem;display:flex;flex-wrap:wrap;contain:content;padding-top:1rem;margin-top:1rem;padding-right:1rem;margin-right:-1rem}main:not(.layout-resume) .column{float:left;padding-left:1rem;margin-bottom:2rem;width:100%;display:flex}@media screen and (min-width: 42em){main:not(.layout-resume) .columns{margin-left:-2rem;margin-right:-2rem}main:not(.layout-resume) .column-1-2{width:50%}}@media screen and (min-width: 1664px){main:not(.layout-resume) .columns-break{width:calc(50vw + 25rem)}main:not(.layout-resume) .columns-break>.column-1-2,main:not(.layout-resume) .columns-break>.column-1{width:27.5rem}}@media print{main:not(.layout-resume) .columns{display:block}main:not(.layout-resume) .column{display:block;width:50%}}main:not(.layout-resume) .project-card{width:100%;color:var(--gray-text);background-color:var(--gray-bg);padding-bottom:1rem;position:relative;overflow:hidden;box-shadow:0.125rem 0.125rem 1rem rgba(0,0,0,0.2);contain:content;border-radius:.5rem;page-break-inside:avoid;transition:transform 500ms ease;will-change:transform}main:not(.layout-resume) .project-card:hover{transform:translateY(-0.25rem);transition:transform 250ms ease}main:not(.layout-resume) .project-card>a.flip-project{display:block}main:not(.layout-resume) .project-card>a.flip-project .project-card-img{margin-bottom:0}main:not(.layout-resume) .project-card>a.flip-project .project-card-img img{display:block;border-top-left-radius:.5rem;border-top-right-radius:.5rem}main:not(.layout-resume) .project-card a{position:relative;z-index:1}main:not(.layout-resume) .project-card a.fill-card{position:absolute;top:0;left:0;right:0;bottom:0;z-index:0}main:not(.layout-resume) .project-card>.project-card-title,main:not(.layout-resume) .project-card>.project-card-text{text-align:center;padding:0 1rem}main:not(.layout-resume) .project-card>.project-card-title{display:block;font-size:1.08rem;margin-top:.75rem;margin-bottom:.25rem;color:inherit}main:not(.layout-resume) .project-card>.project-card-text{margin:.25rem 0}main:not(.layout-resume) .column-1>.project-card>.project-card-title{font-size:1.2rem}main:not(.layout-resume) .column-1>.project-card>.project-card-text{font-size:1rem}</style><link rel="preload" as="style" href="/pages/colindembovsky/assets/css/hydejack-9.1.4.css" id="_stylePreload"><link rel="preload" as="style" href="/pages/colindembovsky/assets/icomoon/style.css" id="_iconsPreload"><link rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Roboto+Slab:700%7CNoto+Sans:400,400i,700,700i&display=swap" id="_fontsPreload"> <script> setRel('_stylePreload'); setRel('_iconsPreload'); /**/setRel('_fontsPreload');/**/ </script> <noscript><link rel="stylesheet" href="/pages/colindembovsky/assets/css/hydejack-9.1.4.css"><link rel="stylesheet" href="/pages/colindembovsky/assets/icomoon/style.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:700%7CNoto+Sans:400,400i,700,700i&display=swap"> </noscript><style id="_pageStyle"> html{--accent-color: rgb(79, 129, 220);--accent-color-faded: rgba(79,129,220,0.5);--accent-color-highlight: rgba(79,129,220,0.1);--accent-color-darkened: #2f6ad6;--theme-color: rgb(5,19,24);--dark-mode-body-bg: #292e30;--dark-mode-border-color: #353c3e}</style><!--<![endif]--> <script async src="https://www.googletagmanager.com/gtag/js?id=G-FD31RTDXK2"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-FD31RTDXK2'); </script><body class="no-break-layout"> <script> window._sunrise = 6; window._sunset = 18; !function(e,s){var d="light-mode",o="dark-mode",a=(new Date).getHours();"matchMedia"in e&&e.matchMedia("(prefers-color-scheme)")||(o=(e=a<=e._sunrise||a>=e._sunset?o:d)==o?d:o,s.body.classList.add(e),s.body.classList.remove(o))}(window,document); </script> <hy-push-state id="_pushState" replace-selector="#_main" link-selector="a[href]:not([href^='/pages/colindembovsky/assets/']):not(.external):not(.no-push-state)" script-selector="script" duration="500" hashchange ><div id="_navbar" class="navbar fixed-top"><div class="content"> <span class="sr-only">Jump to:</span><div class="nav-btn-bar"> <a id="_menu" class="nav-btn no-hover" href="#_drawer--opened"> <span class="sr-only">Navigation</span> <span class="icon-menu"></span> </a><div class="nav-span"></div></div></div></div><hr class="sr-only" hidden /><main id="_main" class="content layout-post" role="main" ><nav id="breadcrumbs" class="screen-only"><ul><li><a href="/pages/colindembovsky/">home</a><li> <span>/</span> <span>github-composite-actions</span></ul></nav><article id="post-github-composite-actions" class="page post mb6" role="article"><header><h1 class="post-title flip-project-title"> GitHub Composite Actions</h1><div class="post-date"> <span class="ellipsis mr1"> <time datetime="2021-09-01T17:22:01+00:00">01 Sep 2021</time> on <a href="/pages/colindembovsky/tag/actions/" class="flip-title">actions</a>, <a href="/pages/colindembovsky/tag/build/" class="flip-title">build</a> </span></div><div class="img-wrapper lead aspect-ratio sixteen-nine flip-project-img"> <img src="/pages/colindembovsky/assets/images/posts/actions.png" alt="GitHub Composite Actions" width="864" height="486" loading="lazy" /></div><p class="note-sm" > Composite Actions now allow you to run other Actions, not just script steps. This is great for composability and maintainability, but there are some limitations that you should be aware of.</header><ol id="markdown-toc"><li><a href="#sidetrail-azure-pipeline-templates" id="markdown-toc-sidetrail-azure-pipeline-templates">Sidetrail: Azure Pipeline Templates</a><li><a href="#composite-actions" id="markdown-toc-composite-actions">Composite Actions</a><li><a href="#case-study-eshoponcontainers" id="markdown-toc-case-study-eshoponcontainers">Case Study: eShopOnContainers</a><li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></ol><blockquote><p>Resistance is futile.<br /> <em>The Borg. And GitHub.</em></blockquote><!--kg-card-end: markdown--><blockquote><p>Edit: Thanks to <a href="https://twitter.com/tspascoal">Tiago</a> for pointing out that you can have more than one Action in a repo.</blockquote><p>GitHub Actions has rapidly become one of the most widely used CI/CD system on the planet. However, despite massive adoption, it is still fairly immature as a product, certainly when compared to <a href="https://azure.microsoft.com/en-us/services/devops/pipelines/">Azure Pipelines</a>. That will inevitably change as the Product Team iterates - but at the moment, there are some limitations that make Actions hard to use in many enterprise scenarios.<p>The biggest drawback to date has been the fact that there is very limited support for <em>composability</em> in Actions. That is, there are not templates that can be reused.<blockquote><p>To those who are paying attention, Actions does have “templates” but these are more like <em>starter pipelines</em> - they are not composable or callable - they simply give a suggested starting point based on the language found within a repo.</blockquote><p><a href="https://docs.github.com/en/actions/creating-actions/creating-a-composite-action">Composite Actions</a> have been around for a while - however, they were limited to running scripts. While this may allow some reusability, not being able to run other Actions was a severe limitation. Fortunately, you can now <a href="https://github.blog/changelog/2020-08-07-github-actions-composite-run-steps/">run other Actions</a> from within a Composite Action.<p>While this is certainly a step in the right direction, there are still some limitations and gotchas that I want to explore in this post.<h3 id="sidetrail-azure-pipeline-templates">Sidetrail: Azure Pipeline Templates</h3><p>Before we continue analyzing Composite Actions, I think it’s worthwhile considering templating in Azure Pipelines. Pipelines has a very strong templating system. There are several types of templates:<ul><li>Variable templates - for templatizing common variables<li>Step templates - for templatizing common steps<li>Job and Stage templates - for templatizing entire jobs and stages</ul><p>These templates are fully featured - that is, steps in a template have exactly the same operation and limitations as steps inline in a Pipeline. As we will see, this is not true for Composite Actions, which is why I mention it here.<h3 id="composite-actions">Composite Actions</h3><p>If I compare Azure Pipeline templates and Composite Actions, I would liken Composite Actions to Step templates in Azure Pipelines: that is, they really serve to group and parameterize sets of steps.<p>Below we’ll look at an example. Before we do, let’s consider the limitations that Composite Actions have:<ul><li>You cannot pass in complex objects (like arrays of steps)<li><del>You cannot use <code class="language-plaintext highlighter-rouge">if</code> conditions for steps</del> <strong>Update 10/11/2021</strong> <code class="language-plaintext highlighter-rouge">if</code> is <a href="https://github.blog/changelog/2021-11-09-github-actions-conditional-execution-of-steps-in-actions/">now supported</a> in Composite Actions<li>Composite Actions cannot read <code class="language-plaintext highlighter-rouge">secrets</code> - you have to pass secrets in as parameters<li>The Actions log does not show a separate log per step as you would see in a “normal” Action - all the steps of the Composite are executed as if they were a single step, making debugging Composite Action logs harder to analyze:</ul><figure class="kg-card kg-image-card"><img src="/assets/images/2021/9/1175_image.png" class="kg-image" alt="" loading="lazy" /></figure><blockquote><p>Note how the entire Composite Action only shows as a single step in the log, even though there are multiple steps in the Composite itself.</blockquote><p>Even though there are some limitations, they are certainly a vast improvement to Actions. Hopefully we’ll see more features evolve in this space to allow better composition and sharing of Actions.<h2 id="case-study-eshoponcontainers">Case Study: eShopOnContainers</h2><p>A few months ago I got to do some work on the documentation for <a href="https://docs.microsoft.com/en-us/dotnet/architecture/devops-for-aspnet-developers/">DevOps for ASP.NET Core Developers</a>. The repo with example is on <a href="https://github.com/dotnet-architecture/eShopOnContainers">GitHub</a>. The sample application runs as a set of microservices on Kubernetes. Let’s take a look at the Action to build the <code class="language-plaintext highlighter-rouge">basketAPI</code>:<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="na">name</span><span class="pi">:</span> <span class="s">basket-api</span>
    
    <span class="na">on</span><span class="pi">:</span>
      <span class="na">workflow_dispatch</span><span class="pi">:</span>
      <span class="na">push</span><span class="pi">:</span>
        <span class="na">branches</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">dev</span>
    
        <span class="na">paths</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">src/BuildingBlocks/**</span>
        <span class="pi">-</span> <span class="s">src/Services/Basket/**</span>
        <span class="pi">-</span> <span class="s">.github/workflows/basket-api.yml</span>
      
      <span class="na">pull_request</span><span class="pi">:</span>
        <span class="na">branches</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">dev</span>
    
        <span class="na">paths</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">src/BuildingBlocks/**</span>
        <span class="pi">-</span> <span class="s">src/Services/Basket/**</span>
        <span class="pi">-</span> <span class="s">.github/workflows/basket-api.yml</span>
    <span class="na">env</span><span class="pi">:</span>
      <span class="na">SERVICE</span><span class="pi">:</span> <span class="s">basket-api</span>
      <span class="na">IMAGE</span><span class="pi">:</span> <span class="s">basket.api</span>
      <span class="na">DOTNET_VERSION</span><span class="pi">:</span> <span class="s">5.0.x</span>
    
    <span class="na">jobs</span><span class="pi">:</span>
    
      <span class="na">BuildContainersForPR_Linux</span><span class="pi">:</span>
        <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
        <span class="na">if</span><span class="pi">:</span> <span class="s">${{ github.event_name == 'pull_request' }}</span>
        <span class="na">steps</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Checkout</span><span class="nv"> </span><span class="s">Github</span><span class="nv"> </span><span class="s">Action'</span>
          <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@master</span>
        
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Setup dotnet</span>
          <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-dotnet@v1</span>
          <span class="na">with</span><span class="pi">:</span>
            <span class="na">dotnet-version</span><span class="pi">:</span> <span class="s">${{ env.DOTNET_VERSION }}</span>
    
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build and run unit tests</span>
          <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">cd src</span>
            <span class="s">dotnet restore "eShopOnContainers-ServicesAndWebApps.sln"</span>
            <span class="s">cd Services/Basket/Basket.API</span>
            <span class="s">dotnet build --no-restore</span>
            <span class="s">cd -</span>
            <span class="s">cd Services/Basket/Basket.UnitTests</span>
            <span class="s">dotnet build --no-restore</span>
            <span class="s">dotnet test --no-build -v=normal</span>
    
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Compose build ${{ env.SERVICE }}</span>
          <span class="na">run</span><span class="pi">:</span> <span class="s">sudo -E docker-compose build ${{ env.SERVICE }}</span>
          <span class="na">working-directory</span><span class="pi">:</span> <span class="s">./src</span>
          <span class="na">shell</span><span class="pi">:</span> <span class="s">bash</span>
          <span class="na">env</span><span class="pi">:</span>
            <span class="na">TAG</span><span class="pi">:</span> <span class="s">${{ env.BRANCH }}</span>
            <span class="na">REGISTRY</span><span class="pi">:</span> <span class="s">${{ secrets.REGISTRY_ENDPOINT }}</span>
    
      <span class="na">BuildLinux</span><span class="pi">:</span>
        <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
        <span class="na">if</span><span class="pi">:</span> <span class="s">${{ github.event_name != 'pull_request' }}</span>
        <span class="na">steps</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Checkout</span><span class="nv"> </span><span class="s">Github</span><span class="nv"> </span><span class="s">Action'</span>
          <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@master</span>
    
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Setup dotnet</span>
          <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-dotnet@v1</span>
          <span class="na">with</span><span class="pi">:</span>
            <span class="na">dotnet-version</span><span class="pi">:</span> <span class="s">${{ env.DOTNET_VERSION }}</span>
    
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build and run unit tests</span>
          <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">cd src</span>
            <span class="s">dotnet restore "eShopOnContainers-ServicesAndWebApps.sln"</span>
            <span class="s">cd Services/Basket/Basket.API</span>
            <span class="s">dotnet build --no-restore</span>
            <span class="s">cd -</span>
            <span class="s">cd Services/Basket/Basket.UnitTests</span>
            <span class="s">dotnet build --no-restore</span>
            <span class="s">dotnet test --no-build -v=normal</span>
    
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Enable experimental features for the Docker daemon and CLI</span>
          <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
              <span class="s">echo $'{\n "experimental": true\n}' | sudo tee /etc/docker/daemon.json</span>
              <span class="s">mkdir -p ~/.docker</span>
              <span class="s">echo $'{\n "experimental": "enabled"\n}' | sudo tee ~/.docker/config.json</span>
              <span class="s">sudo service docker restart</span>
              <span class="s">docker version -f '{{.Client.Experimental}}'</span>
              <span class="s">docker version -f '{{.Server.Experimental}}'</span>
    
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Login to Container Registry</span>
          <span class="na">uses</span><span class="pi">:</span> <span class="s">docker/login-action@v1</span>
          <span class="na">with</span><span class="pi">:</span>
            <span class="na">registry</span><span class="pi">:</span> <span class="s">${{ secrets.REGISTRY_HOST }}</span>
            <span class="na">username</span><span class="pi">:</span> <span class="s">${{ secrets.USERNAME }}</span>
            <span class="na">password</span><span class="pi">:</span> <span class="s">${{ secrets.PASSWORD }}</span>
    
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set branch name as env variable</span>
          <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">currentbranch=$(echo ${GITHUB_REF##*/})</span>
            <span class="s">echo "running on $currentbranch"</span>
            <span class="s">echo "BRANCH=$currentbranch" &gt;&gt; $GITHUB_ENV</span>
          <span class="na">shell</span><span class="pi">:</span> <span class="s">bash</span>
    
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Compose build ${{ env.SERVICE }}</span>
          <span class="na">run</span><span class="pi">:</span> <span class="s">sudo -E docker-compose build ${{ env.SERVICE }}</span>
          <span class="na">working-directory</span><span class="pi">:</span> <span class="s">./src</span>
          <span class="na">shell</span><span class="pi">:</span> <span class="s">bash</span>
          <span class="na">env</span><span class="pi">:</span>
            <span class="na">TAG</span><span class="pi">:</span> <span class="s">${{ env.BRANCH }}</span>
            <span class="na">REGISTRY</span><span class="pi">:</span> <span class="s">${{ secrets.REGISTRY_ENDPOINT }}</span>
    
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Compose push ${{ env.SERVICE }}</span>
          <span class="na">run</span><span class="pi">:</span> <span class="s">sudo -E docker-compose push ${{ env.SERVICE }}</span>
          <span class="na">working-directory</span><span class="pi">:</span> <span class="s">./src</span>
          <span class="na">shell</span><span class="pi">:</span> <span class="s">bash</span>
          <span class="na">env</span><span class="pi">:</span>
            <span class="na">TAG</span><span class="pi">:</span> <span class="s">${{ env.BRANCH }}</span>
            <span class="na">REGISTRY</span><span class="pi">:</span> <span class="s">${{ secrets.REGISTRY_ENDPOINT }}</span>
    
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Create multiarch manifest</span>
          <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">docker --config ~/.docker manifest create ${{ secrets.REGISTRY_ENDPOINT }}/${{ env.IMAGE }}:${{ env.BRANCH }} ${{ secrets.REGISTRY_ENDPOINT }}/${{ env.IMAGE }}:linux-${{ env.BRANCH }}</span>
            <span class="s">docker --config ~/.docker manifest push ${{ secrets.REGISTRY_ENDPOINT }}/${{ env.IMAGE }}:${{ env.BRANCH }}</span>
          <span class="na">shell</span><span class="pi">:</span> <span class="s">bash</span>

</code></pre></div></div><p>This file is 126 lines long - which is not too bad for a single service. But there are 14 services! Before Composite Actions, you had no option but to copy/paste the code for each microservice. And that’s bad - since copy/paste inevitably leads to errors. And even if you don’t fat-finger it, what if you need to change something in the build process? Now you have to update 14 files. There are also deployment Actions for all the services - so now we have 28 files to maintain!<p>When we analyze the common steps, there are 4 logical actions:<ol><li>Build an image<li>Run tests, then build an image<li>Build and push an image<li>Deploy a helm chart</ol><p>The steps for these logical actions are the same if we can parameterize them appropriately.<p>Have a look at the <code class="language-plaintext highlighter-rouge">BuildLinux</code> job above - this is the job that executes steps to “Build and push an image”. Here is what this job looks like if we refactor the steps into a Composite Action (which we’ll see next):<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
      <span class="na">BuildLinux</span><span class="pi">:</span>
        <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
        <span class="na">if</span><span class="pi">:</span> <span class="s">${{ github.event_name != 'pull_request' }}</span>
        <span class="na">steps</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Checkout code</span>
          <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>
        <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">./.github/workflows/composite/build-push</span>
          <span class="na">with</span><span class="pi">:</span>
            <span class="na">service</span><span class="pi">:</span> <span class="s">${{ env.SERVICE }}</span>
            <span class="na">registry_host</span><span class="pi">:</span> <span class="s">${{ secrets.REGISTRY_HOST }}</span>
            <span class="na">registry_endpoint</span><span class="pi">:</span> <span class="s">${{ secrets.REGISTRY_ENDPOINT }}</span>
            <span class="na">image_name</span><span class="pi">:</span> <span class="s">${{ env.IMAGE }}</span>
            <span class="na">registry_username</span><span class="pi">:</span> <span class="s">${{ secrets.USERNAME }}</span>
            <span class="na">registry_password</span><span class="pi">:</span> <span class="s">${{ secrets.PASSWORD }}</span>

</code></pre></div></div><p>That’s much better! We’re checking out the repo using <code class="language-plaintext highlighter-rouge">actions/checkout@v2</code> (we need to do this to get access to the code for the Composite Actions as well as the application code) and then we’re executing a Composite Action that is going to run all the steps we had inline previously.<blockquote><p>Note how we reference an Action in the local repo, using the full path to the folder (not the yaml file).</blockquote><p>If Composite Actions could read <code class="language-plaintext highlighter-rouge">secrets</code>, we’d save another 4 lines. However, since <code class="language-plaintext highlighter-rouge">secrets</code> are not readable within Composite Actions, we have to pass them in as parameters.<p>Let’s have a look at the <code class="language-plaintext highlighter-rouge">action.yml</code> for this Composite Action:<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Build</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">push</span><span class="nv"> </span><span class="s">image"</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Builds</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">pushes</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">image</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">registry"</span>
    
    <span class="na">inputs</span><span class="pi">:</span>
      <span class="na">service</span><span class="pi">:</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Service</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">build"</span>
        <span class="na">required</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">registry_host</span><span class="pi">:</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Image</span><span class="nv"> </span><span class="s">registry</span><span class="nv"> </span><span class="s">host</span><span class="nv"> </span><span class="s">e.g.</span><span class="nv"> </span><span class="s">myacr.azureacr.io"</span>
        <span class="na">required</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">registry_endpoint</span><span class="pi">:</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Image</span><span class="nv"> </span><span class="s">registry</span><span class="nv"> </span><span class="s">repo</span><span class="nv"> </span><span class="s">e.g.</span><span class="nv"> </span><span class="s">myacr.azureacr.io/eshop"</span>
        <span class="na">required</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">image_name</span><span class="pi">:</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Name</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">image"</span>
        <span class="na">required</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">registry_username</span><span class="pi">:</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Registry</span><span class="nv"> </span><span class="s">username"</span>
        <span class="na">required</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">registry_password</span><span class="pi">:</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Registry</span><span class="nv"> </span><span class="s">password"</span>
        <span class="na">required</span><span class="pi">:</span> <span class="no">true</span>
      
    <span class="na">runs</span><span class="pi">:</span>
      <span class="na">using</span><span class="pi">:</span> <span class="s2">"</span><span class="s">composite"</span>
      <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Enable experimental features for the Docker daemon and CLI</span>
        <span class="na">shell</span><span class="pi">:</span> <span class="s">bash</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">echo $'{\n "experimental": true\n}' | sudo tee /etc/docker/daemon.json</span>
            <span class="s">mkdir -p ~/.docker</span>
            <span class="s">echo $'{\n "experimental": "enabled"\n}' | sudo tee ~/.docker/config.json</span>
            <span class="s">sudo service docker restart</span>
            <span class="s">docker version -f '{{.Client.Experimental}}'</span>
            <span class="s">docker version -f '{{.Server.Experimental}}'</span>
    
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Login to Container Registry</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">docker/login-action@v1</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">registry</span><span class="pi">:</span> <span class="s">${{ inputs.registry_host }}</span>
          <span class="na">username</span><span class="pi">:</span> <span class="s">${{ inputs.registry_username }}</span>
          <span class="na">password</span><span class="pi">:</span> <span class="s">${{ inputs.registry_password }}</span>
    
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set branch name as env variable</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">currentbranch=$(echo ${GITHUB_REF##*/})</span>
          <span class="s">echo "running on $currentbranch"</span>
          <span class="s">echo "BRANCH=$currentbranch" &gt;&gt; $GITHUB_ENV</span>
        <span class="na">shell</span><span class="pi">:</span> <span class="s">bash</span>
    
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Compose build ${{ inputs.service }}</span>
        <span class="na">shell</span><span class="pi">:</span> <span class="s">bash</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">sudo -E docker-compose build ${{ inputs.service }}</span>
        <span class="na">working-directory</span><span class="pi">:</span> <span class="s">./src</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="na">TAG</span><span class="pi">:</span> <span class="s">${{ env.BRANCH }}</span>
          <span class="na">REGISTRY</span><span class="pi">:</span> <span class="s">${{ inputs.registry_endpoint }}</span>
    
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Compose push ${{ inputs.service }}</span>
        <span class="na">shell</span><span class="pi">:</span> <span class="s">bash</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">sudo -E docker-compose push ${{ inputs.service }}</span>
        <span class="na">working-directory</span><span class="pi">:</span> <span class="s">./src</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="na">TAG</span><span class="pi">:</span> <span class="s">${{ env.BRANCH }}</span>
          <span class="na">REGISTRY</span><span class="pi">:</span> <span class="s">${{ inputs.registry_endpoint }}</span>
    
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Create multiarch manifest</span>
        <span class="na">shell</span><span class="pi">:</span> <span class="s">bash</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">docker --config ~/.docker manifest create ${{ inputs.registry_endpoint }}/${{ inputs.image_name }}:${{ env.BRANCH }} ${{ inputs.registry_endpoint }}/${{ inputs.image_name }}:linux-${{ env.BRANCH }}</span>
          <span class="s">docker --config ~/.docker manifest push ${{ inputs.registry_endpoint }}/${{ inputs.image_name }}:${{ env.BRANCH }}</span>

</code></pre></div></div><p>Nothing too complex here - we have <code class="language-plaintext highlighter-rouge">name</code> and <code class="language-plaintext highlighter-rouge">description</code> attributes, followed by a map of input parameters. Each parameter has a <code class="language-plaintext highlighter-rouge">description</code> and <code class="language-plaintext highlighter-rouge">required</code> attribute, and can optionally have a <code class="language-plaintext highlighter-rouge">default</code> attribute too. Then we have a <code class="language-plaintext highlighter-rouge">runs</code> keyword with the <code class="language-plaintext highlighter-rouge">using</code> set to <code class="language-plaintext highlighter-rouge">composite</code>. Thereafter, we have steps as we would in any other Action - including the ability to use other Actions (not only <code class="language-plaintext highlighter-rouge">run</code> scripts)!<blockquote><p>Note that in Composite Actions, each <code class="language-plaintext highlighter-rouge">run</code> step requires that you explicitly define the <code class="language-plaintext highlighter-rouge">shell</code>.</blockquote><h2 id="conclusion">Conclusion</h2><p>Composite Actions are a welcome addition to the Actions ecosystem, despite their limitations. I highly recommend that you start using them to reduce copy/paste and keep you and your Actions DRY!<p>Happy building!</article><hr class="dingbat related mb6" /><aside class="comments related" role="complementary"><h2 class="hr-bottom">Comments</h2><div id="giscus"><div></div></div><script> function toggle_giscus() { const c = document.body.classList; const dark = c.contains("dark-mode") || "_sunset" in window && !c.contains("light-mode") && matchMedia("(prefers-color-scheme: dark)").matches; const theme = dark ? "dark" : "light"; const scriptEl = document.createElement("script"); scriptEl.src = "https://giscus.app/client.js"; scriptEl.setAttribute("data-repo", "colindembovsky/colindembovsky.github.io"); scriptEl.setAttribute("data-repo-id", "MDEwOlJlcG9zaXRvcnk0MDczMjI3MjU="); scriptEl.setAttribute("data-category", "Giscussions"); scriptEl.setAttribute("data-category-id", "DIC_kwDOGEdAZc4B_F18"); scriptEl.setAttribute("data-mapping", "pathname"); scriptEl.setAttribute("data-reactions-enabled", "1"); scriptEl.setAttribute("data-emit-metadata", "colindembovsky/colindembovsky.github.io"); scriptEl.setAttribute("data-theme", theme); scriptEl.setAttribute("crossorigin", "anonymous"); const container = document.getElementById("giscus"); const old = container.firstElementChild; container.removeChild(old); container.appendChild(scriptEl); } document.addEventListener("hydejack-dark-mode-toggle", function() { toggle_giscus(); }); toggle_giscus(); </script></aside><aside class="other-projects related mb0" role="complementary"><h2>Related Posts</h2><div class="columns"><div class="column column-1-2"><article class="project-card"> <a href="/pages/colindembovsky/on-demand-ephemeral-self-hosted-runners/" class="no-hover no-print-link flip-project" tabindex="-1"><div class="project-card-img aspect-ratio sixteen-nine flip-project-img"> <img src="/pages/colindembovsky/assets/images/2021/10/self-hosted-runners/boom.jpeg" alt="On Demand Ephemeral Self-Hosted Runners" width="864" height="486" loading="lazy"/></div></a><h3 class="project-card-title flip-project-title"> <a href="/pages/colindembovsky/on-demand-ephemeral-self-hosted-runners/" class="flip-title">On Demand Ephemeral Self-Hosted Runners</a></h3><p class="project-card-text fine" property="disambiguatingDescription"> Do you need to deploy to private VNets using GitHub Actions, but don’t want to have to keep self-hosted runners running all the time? In this post I show you how you can use Ephemeral Runners to create on-demand self-hosted runners. <a class="fill-card no-hover" href="/pages/colindembovsky/on-demand-ephemeral-self-hosted-runners/" tabindex="-1"><span class="sr-only">Continue reading On Demand Ephemeral Self-Hosted Runners</span></a></article></div><div class="column column-1-2"><article class="project-card"> <a href="/pages/colindembovsky/musings-on-reusable-workflows/" class="no-hover no-print-link flip-project" tabindex="-1"><div class="project-card-img aspect-ratio sixteen-nine flip-project-img"> <img src="/pages/colindembovsky/assets/images/2021/10/reuse.jpeg" alt="Musings on GitHub Actions Reusable Workflows" width="864" height="486" loading="lazy"/></div></a><h3 class="project-card-title flip-project-title"> <a href="/pages/colindembovsky/musings-on-reusable-workflows/" class="flip-title">Musings on GitHub Actions Reusable Workflows</a></h3><p class="project-card-text fine" property="disambiguatingDescription"> Newly released Reusable Workflows allows you to reuse workflows in your GitHub workflows. While this still has some limitations, it’s still better than copy/paste! <a class="fill-card no-hover" href="/pages/colindembovsky/musings-on-reusable-workflows/" tabindex="-1"><span class="sr-only">Continue reading Musings on GitHub Actions Reusable Workflows</span></a></article></div></div></aside><aside class="related mb4" role="complementary"><h2 class="hr-bottom">Random Posts</h2><ul class="related-posts"><li class="h4"> <a href="/pages/colindembovsky/microsoft-fakes-customizing-the-system-whitelist-or-enabling-fakes-for-classes-youve-always-wanted-to-fake-like-webclient/" class="flip-title"><span>Microsoft Fakes – Customizing the System Whitelist (or, enabling Fakes for classes you’ve always wanted to fake, like WebClient)</span></a> <time class="faded fine" datetime="2012-06-25T20:35:00+00:00">25 Jun 2012</time><li class="h4"> <a href="/pages/colindembovsky/enabling-javascript-code-coverage-link-in-builds/" class="flip-title"><span>Enabling JavaScript Code Coverage Link in Builds</span></a> <time class="faded fine" datetime="2014-05-14T20:43:03+00:00">14 May 2014</time><li class="h4"> <a href="/pages/colindembovsky/using-powershell-to-replace-config-settings-in-lab-management/" class="flip-title"><span>Using Powershell to Replace Config Settings in Lab Management</span></a> <time class="faded fine" datetime="2011-06-16T20:49:00+00:00">16 Jun 2011</time></ul></aside><footer class="content" role="contentinfo"><hr/><p><small class="copyright">© 2021. All rights reserved. </small><hr class="sr-only"/></footer></main><hy-drawer id="_drawer" class="" side="left" threshold="10" noscroll ><header id="_sidebar" class="sidebar" role="banner"><div class="sidebar-bg sidebar-overlay" style="background-color:rgb(5,19,24);background-image:url(/pages/colindembovsky/assets/img/sidebar-bg.jpg)"></div><div class="sidebar-sticky"><div class="sidebar-about"> <a class="no-hover" href="/pages/colindembovsky/" tabindex="-1"> <img src="/pages/colindembovsky/assets/img/logo.png" class="avatar" alt="Colin's ALM Corner" width="120" height="120" loading="lazy" /> </a> <a class="sidebar-title" href="/pages/colindembovsky/"><h2 class="h1">Colin's ALM Corner</h2></a><p class=""> DevOpsology &amp; GitHub. <br /> <em>Opinions my own</em>.</div><nav class="sidebar-nav heading" role="navigation"> <span class="sr-only">Navigation:</span><ul><li> <a id="_drawer--opened" href="/pages/colindembovsky/tags/" class="sidebar-nav-item " > Tags </a><li> <a href="/pages/colindembovsky/about/" class="sidebar-nav-item " > About </a></ul></nav><div class="sidebar-social"> <span class="sr-only">Social:</span><ul><li> <a href="https://twitter.com/colindembovsky" title="Twitter" class="no-mark-external"> <span class="icon-twitter"></span> <span class="sr-only">Twitter</span> </a><li> <a href="https://github.com/colindembovsky" title="GitHub" class="no-mark-external"> <span class="icon-github"></span> <span class="sr-only">GitHub</span> </a><li> <a href="https://colinsalmcorner.com/feed.xml" title="RSS" class="no-mark-external"> <span class="icon-rss2"></span> <span class="sr-only">RSS</span> </a></ul></div></div></header></hy-drawer><hr class="sr-only" hidden /> </hy-push-state> <!--[if gt IE 10]><!----> <script nomodule>!function(){var t,n=document.createElement("script");!("noModule"in n)&&"onbeforeload"in n&&(t=!1,document.addEventListener("beforeload",function(e){if(e.target===n)t=!0;else if(!e.target.hasAttribute("nomodule")||!t)return;e.preventDefault()},!0),n.type="module",n.src=".",document.head.appendChild(n),n.remove())}(); </script> <script src="/pages/colindembovsky/assets/js/hydejack-9.1.4.js" type="module"></script> <script src="/pages/colindembovsky/assets/js/LEGACY-hydejack-9.1.4.js" nomodule defer></script> <script type="module"> if ('serviceWorker' in navigator) { /**/ navigator.serviceWorker.getRegistration() .then(r => r.unregister()) .catch(() => {}); /**/ } </script> <!--<![endif]--><div hidden><h2 class="sr-only">Templates (for web app):</h2><clap-config> <clap-text at="1">Keep going!</clap-text> <clap-text at="2">Keep going ×2!</clap-text> <clap-text at="3">Give me more!</clap-text> <clap-text at="5">Thank you, thank you</clap-text> <clap-text at="7">Far too kind!</clap-text> <clap-text at="10">Never gonna give me up?</clap-text> <clap-text at="14">Never gonna let me down?</clap-text> <clap-text at="20">Turn around and desert me!</clap-text> <clap-text at="30">You're an addict!</clap-text> <clap-text at="40">Son of a clapper!</clap-text> <clap-text at="50">No way</clap-text> <clap-text at="60">Go back to work!</clap-text> <clap-text at="70">This is getting out of <em>hand</em></clap-text> <clap-text at="80">Unbelievable</clap-text> <clap-text at="90">PREPOSTEROUS</clap-text> <clap-text at="100">I N S A N I T Y</clap-text> <clap-text at="185"><span style="font-family:monospace">FEED ME A STRAY CAT</span></clap-text> </clap-config> <template id="_animation-template"><div class="animation-main fixed-top"><nav id="breadcrumbs" class="screen-only"><ul></ul></nav><div class="content"><div class="page"></div></div></div></template> <template id="_loading-template"><div class="loading nav-btn fr"> <span class="sr-only">Loading…</span> <span class="icon-cog"></span></div></template> <template id="_error-template"><div class="page"><h1 class="page-title">Error</h1><p class="lead"> Sorry, an error occurred while loading <a class="this-link" href=""></a>.</div></template> <template id="_permalink-template"> <a href="#" class="permalink"> <span class="sr-only">Permalink</span> <span class="content-hash"></span> </a> </template> <template id="_cookies-banner-template"><div id="_cookies-banner" class="navbar fixed-bottom CookiesOK"><div class="content"><div class="nav-btn-bar"> <small class="faded"> <span>This site uses cookies. <a href="/cookies-policy/">Cookies Policy</a>. </span> <button id="_cookies-ok" class="btn btn-primary btn-sm">Okay</button> </small></div></div></div></template> <template id="_dark-mode-template"> <button id="_dark-mode" class="nav-btn no-hover" > <span class="sr-only">Dark Mode</span> <span class="icon-brightness-contrast"></span> </button> </template> <template id="_search-template"> <button id="_search" class="nav-btn no-hover"> <label class="sr-only" for="_search-input">Search</label> <span class="icon-search"></span> </button><div id="_search-box"><div class="nav-btn"> <span class="icon-search"></span></div><input id="_search-input" type="search" class="form-control form-control-lg nav-btn" placeholder="Type something…" /> <button type="reset" class="nav-btn no-hover"> <span class="sr-only">Close</span> <span class="icon-cross"></span> </button></div><div id="_hits"></div></template></div></html>
