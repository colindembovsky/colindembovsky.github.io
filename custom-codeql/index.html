<!DOCTYPE html>
<html lang="en"><head><title>Custom CodeQL | Colin’s ALM Corner</title><meta name="generator" content="Jekyll v3.9.0" /><meta property="og:title" content="Custom CodeQL" /><meta name="author" content="Colin Dembovsky" /><meta property="og:locale" content="en" /><meta name="description" content="CodeQL is a powerful code scanning tool that can be integrated into your pipelines. In this post I show you some basics, as well as how to develop and integrate custom queries into your pipelines." /><meta property="og:description" content="CodeQL is a powerful code scanning tool that can be integrated into your pipelines. In this post I show you some basics, as well as how to develop and integrate custom queries into your pipelines." /><link rel="canonical" href="https://github.com/pages/colindembovsky/custom-codeql/" /><meta property="og:url" content="https://github.com/pages/colindembovsky/custom-codeql/" /><meta property="og:site_name" content="Colin’s ALM Corner" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-02-09T17:17:58+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Custom CodeQL" /><meta name="twitter:site" content="@colindembovsky" /><meta name="twitter:creator" content="@colindembovsky" /> <script type="application/ld+json"> {"description":"CodeQL is a powerful code scanning tool that can be integrated into your pipelines. In this post I show you some basics, as well as how to develop and integrate custom queries into your pipelines.","url":"https://github.com/pages/colindembovsky/custom-codeql/","@type":"BlogPosting","headline":"Custom CodeQL","dateModified":"2021-02-09T17:17:58+00:00","datePublished":"2021-02-09T17:17:58+00:00","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://github.com/pages/colindembovsky/assets/img/logo.png"},"name":"Colin Dembovsky"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://github.com/pages/colindembovsky/custom-codeql/"},"author":{"@type":"Person","name":"Colin Dembovsky"},"@context":"https://schema.org"}</script><meta name="keywords" content="devops,github,actions,build,ci,cd"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Colin's ALM Corner"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="application-name" content="Colin's ALM Corner"><meta name="theme-color" content="rgb(5,19,24)"><meta name="generator" content="Hydejack v9.1.4" /><link rel="alternate" href="https://github.com/pages/colindembovsky/custom-codeql/" hreflang="en"><link type="application/atom+xml" rel="alternate" href="https://github.com/pages/colindembovsky/feed.xml" title="Colin's ALM Corner" /><link rel="shortcut icon" href="/pages/colindembovsky/assets/icons/favicon.ico"><link rel="apple-touch-icon" href="/pages/colindembovsky/assets/icons/icon-192x192.png"><link rel="manifest" href="/pages/colindembovsky/assets/site.webmanifest"><link rel="dns-prefetch" href="https://fonts.googleapis.com"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preload" href="/pages/colindembovsky/assets/img/swipe.svg" as="image" id="_hrefSwipeSVG"><link rel="dns-prefetch" href="/pages/colindembovsky/assets/js/search-worker-9.1.4.js" as="worker" id="_hrefSearch"> <script>!function(r,c){"use strict";function a(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}r.loadJS=function(e,t){var n=c.createElement("script");n.src=e,t&&a(n,"load",t,{once:!0});t=c.scripts[0];return t.parentNode.insertBefore(n,t),n},r._loaded=!1,r.loadJSDeferred=function(e,t){var n=c.createElement("script");function o(){r._loaded=!0,t&&a(n,"load",t,{once:!0});var e=c.scripts[0];e.parentNode.insertBefore(n,e)}return n.src=e,r._loaded?o():a(r,"load",o,{once:!0}),n},r.setRel=r.setRelStylesheet=function(e){a(c.getElementById(e),"load",function(){this.rel="stylesheet"},{once:!0})}}(window,document); !function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this); !function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this); !function(w) { w._baseURL = '/pages/colindembovsky/'; w._publicPath = '/pages/colindembovsky/assets/js/'; w._noPushState = false; w._noDrawer = false; w._noNavbar = false; w._noToc = false; w._noSearch = false; w._advertise = false; w._search = { DATA_URL: '/pages/colindembovsky/assets/sitedata.json?no-cache', STORAGE_KEY: 'mini-search/pages/colindembovsky/', INDEX_KEY: 'index--2021-11-18T20:23:33+00:00', }; w._clapButton = false; }(window);</script> <script async src="/pages/colindembovsky/assets/bower_components/MathJax/es5/tex-mml-chtml.js" id="_MathJax"></script> <!--[if gt IE 8]><!----><style id="_styleInline"> .clearfix,.sidebar-social::after{content:"";display:table;clear:both}.color-transition,body,p,hr,.hr,.hr-after::after,.hr-bottom,.message,.note-sm,.note,#markdown-toc,.navbar,.nav-btn-bar,.nav-btn,.content .avatar{transition:none}#_dark-mode{font-size:1.25rem}@media screen{body.light-mode{--body-color: #333;--body-bg: #fff;--border-color: #ebebeb;--gray: #777;--gray-bg: rgba(0,0,0,0.025);--gray-text: #666;--menu-text: #bbb;--inv-body-color: #ccc;--inv-body-bg: var(--dark-mode-body-bg)}body.light-mode .content{-webkit-font-smoothing:initial;-moz-osx-font-smoothing:initial}body.dark-mode{--body-color: #ccc;--body-bg: var(--dark-mode-body-bg);--border-color: var(--dark-mode-border-color);--gray: rgba(255,255,255,.5);--gray-bg: rgba(255,255,255,.033);--gray-text: rgba(255,255,255,.625);--menu-text: rgba(255,255,255,.25);--inv-body-color: #333;--inv-body-bg: #fff}body.dark-mode .content{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media screen and (prefers-color-scheme: dark){body{--body-color: #ccc;--body-bg: var(--dark-mode-body-bg);--border-color: var(--dark-mode-border-color);--gray: rgba(255,255,255,.5);--gray-bg: rgba(255,255,255,.033);--gray-text: rgba(255,255,255,.625);--menu-text: rgba(255,255,255,.25);--inv-body-color: #333;--inv-body-bg: #fff}body .content{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.tippy-content{-webkit-font-smoothing:initial;-moz-osx-font-smoothing:initial}}html{--font-family: Noto Sans,Helvetica,Arial,sans-serif;--font-family-heading: Roboto Slab,Helvetica,Arial,sans-serif;--code-font-family: Fira Code,Menlo,Monaco,Consolas,monospace;--body-color: #333;--body-bg: #fff;--border-color: #ebebeb;--gray: #777;--gray-bg: rgba(0,0,0,0.025);--gray-text: #666;--menu-text: #bbb;--inv-body-color: #ccc;--inv-body-bg: var(--dark-mode-body-bg);--root-font-size: 15px;--root-font-size-medium: 16px;--root-font-size-large: 17px;--root-font-size-print: 8pt;--root-line-height: 1.75;--font-weight: 400;--font-weight-bold: 700;--font-weight-heading: 700;--content-width-5: 54rem;--content-margin-5: 4rem;--sidebar-width: 21rem;--half-content: 31rem;--break-point-3: 64em;--break-point-5: 86em;--break-point-dynamic: 1664px}html .content{-webkit-font-smoothing:initial;-moz-osx-font-smoothing:initial}*{box-sizing:border-box}html,body{margin:0;padding:0}html{font-family:var(--font-family);font-size:var(--root-font-size);line-height:var(--root-line-height)}body{color:var(--body-color);background-color:var(--body-bg);font-weight:var(--font-weight);overflow-y:scroll}.content img,.img,.content video,.video{max-width:100%;height:auto}.lead{margin-left:-1rem;margin-right:-1rem;margin-bottom:1.5rem}img.lead,video.lead{display:block;max-width:calc(100% + 2rem);width:calc(100% + 2rem);height:auto}.heading,.f1,h1,.h1,.f2,h2,.h2,.f3,h3,.h3,.f4,h4,.h4,.post-date,.sidebar-nav-item,.f5,h5,.h5,.f6,h6,.h6{font-family:var(--font-family-heading);font-weight:var(--font-weight-heading)}.f1,h1,.h1{font-size:2rem;line-height:1.3}.f2,h2,.h2{font-size:1.5rem;line-height:1.4}.f3,h3,.h3{font-size:1.2em;line-height:1.5}.f4,h4,.h4,.post-date,.sidebar-nav-item{font-size:1.08rem;line-height:1.6}.f5,h5,.h5{font-size:1.04rem;line-height:1.7}.f6,h6,.h6{font-size:1rem}.content h1>a,.content .h1>a{text-decoration:none;border-bottom:none}@media screen and (max-width: 42em){.content h1,.content .h1{font-size:1.7rem;line-height:1.35}}@media screen and (min-width: 86em){.content h1,.content .h1{font-size:2.4rem;line-height:1.25}}@media screen and (min-width: 1664px){body:not(.no-large-headings) .content h1,body:not(.no-large-headings) .content .h1{width:calc(100% + 50vw - 32rem);font-size:3rem;line-height:1.2}}@media screen and (min-width: 124em){body:not(.no-large-headings) .content h1,body:not(.no-large-headings) .content .h1{font-size:4rem;line-height:1.1}}h1,h2,h3,.h1,.h2,.h3{margin:4rem 0 1rem}h4,h5,h6,.h4,.post-date,.h5,.h6{margin:3rem 0 .5rem}p{margin-top:0;margin-bottom:1rem}p.lead{font-size:1.2em;margin-top:1.5rem;margin-bottom:1.5rem;padding:0 1rem}ul,ol,dl{margin-top:0;margin-bottom:1rem}ul,ol{padding-left:1.25rem}hr,.hr{border:0;margin:1rem 0;border-top:1px solid var(--border-color)}.hr-after::after{content:"";display:block;margin:1rem 0;border-top:1px solid var(--border-color)}.hr-bottom{border-bottom:1px solid var(--border-color);padding-bottom:.75rem;margin-bottom:1rem}.page{margin-bottom:3em}.page li+li{margin-top:.25rem}.page>header{position:relative;margin-bottom:1.5rem}@media screen and (min-width: 1664px){body:not(.no-third-column) .page>header>.lead+.note-sm,body:not(.no-third-column) .page>header>.lead+.note,body:not(.no-third-column) .page>header>.lead+#markdown-toc,body:not(.no-third-column) .page>header>a.no-hover+.note-sm,body:not(.no-third-column) .page>header>a.no-hover+.note,body:not(.no-third-column) .page>header>a.no-hover+#markdown-toc{position:absolute;right:-25rem;width:21rem;bottom:0;margin-bottom:0}}.page-title,.post-title{margin-top:0}.post-date{display:flex;justify-content:space-between;margin-top:-.6rem;height:2rem;margin-bottom:.85rem;color:var(--gray)}.post-date>.ellipsis,#breadcrumbs.post-date>ul{cursor:pointer}.post-date [class^="icon-"]{display:inline-block;font-size:smaller;margin-right:.25rem}.related-posts{padding-left:0;list-style:none;margin-bottom:2rem}.related-posts>li,.related-posts>li+li{margin-top:1rem}.message,.note-sm,.note,#markdown-toc{margin-bottom:1rem;padding:1rem;color:var(--gray-text);background-color:var(--gray-bg);margin-left:-1rem;margin-right:-1rem}.note-sm,.note,#markdown-toc{background:transparent;color:var(--body-color);font-size:smaller;border-left:1px solid var(--border-color);padding:1.2rem 1rem 0 1rem;margin:1rem -1rem;position:relative}.note-sm:before,.note:before,#markdown-toc:before{font-size:0.667rem;font-weight:bold;font-style:normal;letter-spacing:.025rem;text-transform:uppercase;color:var(--menu-text);position:absolute;top:0}.note-sm[title]:before,[title].note:before,[title]#markdown-toc:before{content:attr(title) !important}.note{font-size:1rem}@media screen{body::before{content:'';width:.5rem;background:var(--gray-bg);position:fixed;left:0;top:0;bottom:0}}@media (min-width: 64em){body::before{width:21rem}}@media (min-width: 1664px){body::before{width:calc(50% - 31rem)}}@media screen and (min-width: 42em){html{font-size:var(--root-font-size-medium)}}@media screen and (min-width: 124em){html{font-size:var(--root-font-size-large)}}#breadcrumbs>ul{height:1rem;margin:-1.5rem 0 .5rem;padding:0;font-size:.667rem;color:var(--menu-text);text-transform:uppercase;width:100%;list-style:none}#breadcrumbs>ul>li{display:inline}#breadcrumbs>ul>li a{color:var(--gray);text-decoration:none;border-bottom:none}.fl{float:left}.fr{float:right}.mb4{margin-bottom:4rem}.mb6{margin-bottom:6rem}.mt0{margin-top:0}.mt1{margin-top:1rem}.mt2{margin-top:2rem}.mt3{margin-top:3rem}.mt4{margin-top:4rem}.pb0{padding-bottom:0}.ml1{margin-left:1rem}.mr1{margin-right:1rem}.sixteen-nine{position:relative}.sixteen-nine::before{display:block;content:"";width:100%;padding-top:56.25%}.sixteen-nine>*{position:absolute;top:0;left:0;right:0;bottom:0}.sixteen-ten{position:relative}.sixteen-ten::before{display:block;content:"";width:100%;padding-top:62.5%}.sixteen-ten>*{position:absolute;top:0;left:0;right:0;bottom:0}.four-three{position:relative}.four-three::before{display:block;content:"";width:100%;padding-top:75%}.four-three>*{position:absolute;top:0;left:0;right:0;bottom:0}.sr-only{display:none}.larger{font-size:larger}.smaller{font-size:smaller}.clearfix,.sidebar-social::after{content:"";display:table;clear:both}.ellipsis,#breadcrumbs>ul{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.border{border:1px solid var(--border-color)}@media (min-width: 42em){.border-radius,.lead,.page .aspect-ratio.sixteen-nine.lead{border-radius:.5rem}}.fallback-img{background-position:center;background-repeat:no-repeat;background-image:url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB3aWR0aD0iMTYwIiBoZWlnaHQ9IjkwIiB2aWV3Qm94PSIwIDAgMTYwIDkwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxnIHRyYW5zZm9ybT0ibWF0cml4KDAuMDQ4ODI4LCAwLCAwLCAwLjA0Nzk5MSwgNTQuOTk5OTczLCAyMC40MjgxNDgpIj4KICAgIDxwYXRoIHN0eWxlPSJmaWxsOnJnYmEoMTI4LDEyOCwxMjgsLjMzKSIgZD0iTTk1OS44ODQgMTI4YzAuMDQwIDAuMDM0IDAuMDgyIDAuMDc2IDAuMTE2IDAuMTE2djc2Ny43N2MtMC4wMzQgMC4wNDAtMC4wNzYgMC4wODItMC4xMTYgMC4xMTZoLTg5NS43N2MtMC4wNDAtMC4wMzQtMC4wODItMC4wNzYtMC4xMTQtMC4xMTZ2LTc2Ny43NzJjMC4wMzQtMC4wNDAgMC4wNzYtMC4wODIgMC4xMTQtMC4xMTRoODk1Ljc3ek05NjAgNjRoLTg5NmMtMzUuMiAwLTY0IDI4LjgtNjQgNjR2NzY4YzAgMzUuMiAyOC44IDY0IDY0IDY0aDg5NmMzNS4yIDAgNjQtMjguOCA2NC02NHYtNzY4YzAtMzUuMi0yOC44LTY0LTY0LTY0djB6Ii8+CiAgICA8cGF0aCBzdHlsZT0iZmlsbDpyZ2JhKDEyOCwxMjgsMTI4LC4zMykiIGQ9Ik04MzIgMjg4YzAgNTMuMDIwLTQyLjk4IDk2LTk2IDk2cy05Ni00Mi45OC05Ni05NiA0Mi45OC05NiA5Ni05NiA5NiA0Mi45OCA5NiA5NnoiLz4KICAgIDxwYXRoIHN0eWxlPSJmaWxsOnJnYmEoMTI4LDEyOCwxMjgsLjMzKSIgZD0iTTg5NiA4MzJoLTc2OHYtMTI4bDIyNC0zODQgMjU2IDMyMGg2NGwyMjQtMTkyeiIvPgogIDwvZz4KPC9zdmc+")}hy-push-state a{color:var(--body-color)}@supports not ((text-decoration-thickness: initial) and (text-underline-offset: initial)){hy-push-state a{text-decoration:none;border-bottom:2px solid}}@supports (text-decoration-thickness: initial) and (text-underline-offset: initial){hy-push-state a{text-decoration-style:solid;text-underline-offset:.35rem;text-decoration-thickness:2px}}hy-push-state a.no-hover{border-bottom:none;text-decoration-thickness:unset;text-underline-offset:unset}.content a:not(.btn):not(.no-hover){border-color:var(--accent-color-faded)}@supports (text-decoration-thickness: initial) and (text-underline-offset: initial){.content a:not(.btn):not(.no-hover){text-decoration-color:var(--accent-color-faded)}}.content .aspect-ratio{overflow:hidden}.content .aspect-ratio img{margin:0;width:100%;height:100%;background-color:var(--gray-bg)}hy-drawer{width:100%;position:relative;overflow:hidden;display:block;z-index:4}@media screen and (min-width: 64em){hy-drawer{position:fixed;width:21rem;top:0;left:0;bottom:0;margin-left:0}hy-drawer.cover{position:relative;width:100%}}@media screen and (min-width: 1664px){hy-drawer{width:calc(50% - 31rem)}}.sidebar{position:relative;display:flex;justify-content:center;align-items:center;color:rgba(255,255,255,0.75);text-align:center;min-height:100vh}.sidebar.invert{color:rgba(32,32,32,0.75)}.sidebar a{color:#fff;border-bottom-color:rgba(255,255,255,0.2);text-decoration-color:rgba(255,255,255,0.2)}.sidebar.invert a{color:#222;border-bottom-color:rgba(32,32,32,0.2);text-decoration-color:rgba(32,32,32,0.2)}.sidebar-bg{position:absolute;top:0;left:calc(50% - 50vw);width:100vw;height:100%;background:#202020 center / cover}.sidebar-bg::after{content:"";position:absolute;top:0;left:0;bottom:0;right:0;background:rgba(0,0,0,0.05)}.sidebar-bg.sidebar-overlay::after{background:linear-gradient(to bottom, rgba(32,32,32,0) 0%, rgba(32,32,32,0.5) 50%, rgba(32,32,32,0) 100%)}.sidebar-sticky{position:relative;z-index:3;max-width:21rem;padding:1.5rem;contain:content}.sidebar-about .avatar{margin-bottom:1.5rem}.sidebar-about>a.sidebar-title{text-decoration:none}.sidebar-about>a.sidebar-title>h2{margin:0;padding-bottom:.5rem}.sidebar-about>a.sidebar-title::after{content:'';display:block;border-bottom:2px solid;margin:0 auto .5rem;width:4rem;border-color:rgba(255,255,255,0.2);transition:border-color 250ms}.sidebar-about>a.sidebar-title:hover::after{border-color:#fff;transition:border-color 50ms}.sidebar.invert .sidebar-about>a.sidebar-title::after{border-color:rgba(32,32,32,0.2)}.sidebar.invert .sidebar-about>a.sidebar-title:hover::after{border-color:#222}.sidebar-nav>ul{list-style:none;padding-left:0}.sidebar-nav-item{display:inline-block;margin-bottom:.5rem}@media (min-width: 64em){#_main.no-drawer #_menu{display:none}#_main.no-drawer .nav-btn-bar>:nth-child(2){border:none}}.sidebar-social>ul{display:inline-block;list-style:none;padding-left:0;margin-bottom:0}.sidebar-social>ul>li{float:left}.sidebar-social>ul>li>a{display:inline-block;text-align:center;font-size:1.4rem;width:3rem;height:4rem;padding:.5rem 0;line-height:3rem;text-decoration:none;border-bottom-width:2px;border-bottom-style:solid}.sidebar-social>ul li+li{margin-top:0}.fixed-common,.fixed-top,.fixed-bottom{position:fixed;left:0;width:100%;z-index:2}.fixed-top{top:0}.fixed-bottom{bottom:0}.navbar>.content{position:relative;padding-top:0;padding-bottom:0;min-height:0;max-height:5rem}.nav-btn-bar{margin:0 -1rem;background-color:white;background-color:var(--body-bg);height:5rem;display:flex;align-items:center;position:relative}.nav-btn-bar>:first-child,.nav-btn-bar>:last-child{border:none}.nav-btn{background:none;border:none;text-decoration:none;display:flex;align-items:center;justify-content:center;width:3.25rem;height:5rem;color:var(--menu-text);border-right:1px solid var(--border-color);border-left:1px solid var(--border-color);margin-left:-1px}#markdown-toc{margin:2rem -1rem 2rem calc(-1rem + 1px);padding-left:2.5rem;padding-bottom:.5rem}#markdown-toc:before{left:1rem}@media screen and (min-width: 1664px){body:not(.no-toc) #markdown-toc{position:absolute;z-index:4;width:20.5rem;right:0;margin:auto;overflow:auto}}@media screen and (min-width: 1664px){body.no-break-layout:not(.no-toc) #markdown-toc{width:calc(50% - 31rem)}}.content{margin-left:auto;margin-right:auto;padding:8rem 1rem 12rem}@media screen{.content{padding-left:1.5rem;min-height:100vh}}@media screen and (min-width: 42em){.content{max-width:42rem}}@media screen and (min-width: 54em){.content{max-width:48rem}}@media screen and (min-width: 64em){.content{padding-left:1rem;margin-left:24rem;margin-right:3rem}}@media screen and (min-width: 86em){.content{padding-top:9rem;margin-left:25rem;margin-right:4rem;max-width:54rem}}@media screen and (min-width: 1664px){.content{margin:auto}}.large-only{display:none}@media screen and (min-width: 1664px){.large-only{display:block}}.avatar{width:7rem;height:7rem;border-radius:100%;overflow:hidden;display:inline-block}.avatar img{width:100%}.content .avatar{float:right;box-sizing:content-box;border:1rem solid var(--body-bg);transition:border-color 1s ease;margin-top:-1.5rem;margin-right:-1rem}hr.dingbat{display:none}.center-image{margin:auto;display:block}.note:before{content:"Note"}.page>header>.note-sm:before,.page>header>.note:before,.page>header>#markdown-toc:before{content:"Description"}#markdown-toc:before{content:"Table of Contents"}.layout-resume .note-sm:before,.layout-resume .note:before,.layout-resume #markdown-toc:before{content:"Summary"} .clearfix,main:not(.layout-resume) .columns::after{content:"";display:table;clear:both}.color-transition,main:not(.layout-resume) .project-card{transition:none}main:not(.layout-resume) .columns{margin-left:-1rem;display:flex;flex-wrap:wrap;contain:content;padding-top:1rem;margin-top:1rem;padding-right:1rem;margin-right:-1rem}main:not(.layout-resume) .column{float:left;padding-left:1rem;margin-bottom:2rem;width:100%;display:flex}@media screen and (min-width: 42em){main:not(.layout-resume) .columns{margin-left:-2rem;margin-right:-2rem}main:not(.layout-resume) .column-1-2{width:50%}}@media screen and (min-width: 1664px){main:not(.layout-resume) .columns-break{width:calc(50vw + 25rem)}main:not(.layout-resume) .columns-break>.column-1-2,main:not(.layout-resume) .columns-break>.column-1{width:27.5rem}}@media print{main:not(.layout-resume) .columns{display:block}main:not(.layout-resume) .column{display:block;width:50%}}main:not(.layout-resume) .project-card{width:100%;color:var(--gray-text);background-color:var(--gray-bg);padding-bottom:1rem;position:relative;overflow:hidden;box-shadow:0.125rem 0.125rem 1rem rgba(0,0,0,0.2);contain:content;border-radius:.5rem;page-break-inside:avoid;transition:transform 500ms ease;will-change:transform}main:not(.layout-resume) .project-card:hover{transform:translateY(-0.25rem);transition:transform 250ms ease}main:not(.layout-resume) .project-card>a.flip-project{display:block}main:not(.layout-resume) .project-card>a.flip-project .project-card-img{margin-bottom:0}main:not(.layout-resume) .project-card>a.flip-project .project-card-img img{display:block;border-top-left-radius:.5rem;border-top-right-radius:.5rem}main:not(.layout-resume) .project-card a{position:relative;z-index:1}main:not(.layout-resume) .project-card a.fill-card{position:absolute;top:0;left:0;right:0;bottom:0;z-index:0}main:not(.layout-resume) .project-card>.project-card-title,main:not(.layout-resume) .project-card>.project-card-text{text-align:center;padding:0 1rem}main:not(.layout-resume) .project-card>.project-card-title{display:block;font-size:1.08rem;margin-top:.75rem;margin-bottom:.25rem;color:inherit}main:not(.layout-resume) .project-card>.project-card-text{margin:.25rem 0}main:not(.layout-resume) .column-1>.project-card>.project-card-title{font-size:1.2rem}main:not(.layout-resume) .column-1>.project-card>.project-card-text{font-size:1rem}</style><link rel="preload" as="style" href="/pages/colindembovsky/assets/css/hydejack-9.1.4.css" id="_stylePreload"><link rel="preload" as="style" href="/pages/colindembovsky/assets/icomoon/style.css" id="_iconsPreload"><link rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Roboto+Slab:700%7CNoto+Sans:400,400i,700,700i&display=swap" id="_fontsPreload"> <script> setRel('_stylePreload'); setRel('_iconsPreload'); /**/setRel('_fontsPreload');/**/ </script> <noscript><link rel="stylesheet" href="/pages/colindembovsky/assets/css/hydejack-9.1.4.css"><link rel="stylesheet" href="/pages/colindembovsky/assets/icomoon/style.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:700%7CNoto+Sans:400,400i,700,700i&display=swap"> </noscript><style id="_pageStyle"> html{--accent-color: rgb(79, 129, 220);--accent-color-faded: rgba(79,129,220,0.5);--accent-color-highlight: rgba(79,129,220,0.1);--accent-color-darkened: #2f6ad6;--theme-color: rgb(5,19,24);--dark-mode-body-bg: #292e30;--dark-mode-border-color: #353c3e}</style><!--<![endif]--> <script async src="https://www.googletagmanager.com/gtag/js?id=G-FD31RTDXK2"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-FD31RTDXK2'); </script><body class="no-break-layout"> <script> window._sunrise = 6; window._sunset = 18; !function(e,s){var d="light-mode",o="dark-mode",a=(new Date).getHours();"matchMedia"in e&&e.matchMedia("(prefers-color-scheme)")||(o=(e=a<=e._sunrise||a>=e._sunset?o:d)==o?d:o,s.body.classList.add(e),s.body.classList.remove(o))}(window,document); </script> <hy-push-state id="_pushState" replace-selector="#_main" link-selector="a[href]:not([href^='/pages/colindembovsky/assets/']):not(.external):not(.no-push-state)" script-selector="script" duration="500" hashchange ><div id="_navbar" class="navbar fixed-top"><div class="content"> <span class="sr-only">Jump to:</span><div class="nav-btn-bar"> <a id="_menu" class="nav-btn no-hover" href="#_drawer--opened"> <span class="sr-only">Navigation</span> <span class="icon-menu"></span> </a><div class="nav-span"></div></div></div></div><hr class="sr-only" hidden /><main id="_main" class="content layout-post" role="main" ><nav id="breadcrumbs" class="screen-only"><ul><li><a href="/pages/colindembovsky/">home</a><li> <span>/</span> <span>custom-codeql</span></ul></nav><article id="post-custom-codeql" class="page post mb6" role="article"><header><h1 class="post-title flip-project-title"> Custom CodeQL</h1><div class="post-date"> <span class="ellipsis mr1"> <time datetime="2021-02-09T17:17:58+00:00">09 Feb 2021</time> on <a href="/pages/colindembovsky/tag/security/" class="flip-title">security</a>, <a href="/pages/colindembovsky/tag/github/" class="flip-title">github</a> </span></div><p class="note-sm" > CodeQL is a powerful code scanning tool that can be integrated into your pipelines. In this post I show you some basics, as well as how to develop and integrate custom queries into your pipelines.</header><ol id="markdown-toc"><li><a href="#codeql-to-the-rescue" id="markdown-toc-codeql-to-the-rescue">CodeQL to the Rescue</a><li><a href="#codeql-scanning-example" id="markdown-toc-codeql-scanning-example">CodeQL Scanning Example</a><li><a href="#customizing-scans" id="markdown-toc-customizing-scans">Customizing Scans</a><li><a href="#custom-queries" id="markdown-toc-custom-queries">Custom Queries</a><ol><li><a href="#local-development" id="markdown-toc-local-development">Local Development</a><li><a href="#writing-codeql-for-code-scanning" id="markdown-toc-writing-codeql-for-code-scanning">Writing CodeQL for Code Scanning</a><li><a href="#example-codeql-query" id="markdown-toc-example-codeql-query">Example CodeQL Query</a></ol><li><a href="#custom-queries-in-your-action" id="markdown-toc-custom-queries-in-your-action">Custom Queries in Your Action</a><ol><li><a href="#repo" id="markdown-toc-repo">Repo</a></ol><li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></ol><p>Security is a big deal. So big that the marketing folks have created the moniker “DevSecOps” to highlight a focus on security. I’ve never liked that term, since DevOps is supposed to include security by definition. However, integrating security into your culture and into your pipelines can be a challenge.<p>Typically, security is left to the end of the delivery life cycle. Perhaps you’re fortunate enough to work in a team where you are at least somewhat security conscious - but you probably don’t have InfoSec involved in your daily routine. This challenge has given rise to the term “shift left” where teams work to intentionally embed security earlier in the life cycle.<p>But how do you do that? Security professionals often work with arcane tools that don’t integrate into pipelines and are difficult to automate. If the tooling doesn’t support the culture shift, then it can be doomed from the start.<h2 id="codeql-to-the-rescue">CodeQL to the Rescue</h2><p>Enter CodeQL. CodeQL (or Code Query Language) is a code scanning tool. It was called <a href="https://semmle.com/">Semmle</a> (pronounced “sem-il”) before being acquired by GitHub. GitHub now offers CodeQL as part of the GitHub Advanced Security Suite.<p>CodeQL can be used for a <a href="https://codeql.github.com/docs/codeql-overview/supported-languages-and-frameworks/">variety of popular languages</a>: C/C++, C#, JavaScript/TypeScript, Java, Python and Go. To integrate CodeQL into your workflow, you create an <a href="https://github.com/features/actions">Action</a>. The Action initializes the CodeQL scanner which intercepts compilation calls in order to build a database of your code. After compilation, you can run queries against the code database using CodeQL syntax.<p>The CodeQL syntax is very powerful - but, just like many other security tools, it too is arcane. However, the beauty of CodeQL is that you can tap into the community. There are some very smart security professionals in the community who have already written suites of queries that check for common security vulnerabilities and have open-sourced them! You don’t need to know how to write CodeQL to integrate it into your pipelines.<h2 id="codeql-scanning-example">CodeQL Scanning Example</h2><p>Let’s look at an example GitHub Action that performs a CodeQL scan on a Python repo:<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="na">jobs</span><span class="pi">:</span>
      <span class="na">analyze</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">Analyze</span>
        <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    
        <span class="na">strategy</span><span class="pi">:</span>
          <span class="na">fail-fast</span><span class="pi">:</span> <span class="no">false</span>
          <span class="na">matrix</span><span class="pi">:</span>
            <span class="na">language</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">python'</span><span class="pi">]</span>
    
        <span class="na">steps</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Checkout repository</span>
          <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>
    
        <span class="c1"># Initializes the CodeQL tools for scanning.</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Initialize CodeQL</span>
          <span class="na">uses</span><span class="pi">:</span> <span class="s">github/codeql-action/init@v1</span>
          <span class="na">with</span><span class="pi">:</span>
            <span class="na">languages</span><span class="pi">:</span> <span class="s">${{ matrix.language }}</span>
    
        <span class="c1"># - name: Autobuild</span>
        <span class="c1"># uses: github/codeql-action/autobuild@v1</span>
    
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Perform CodeQL Analysis</span>
          <span class="na">uses</span><span class="pi">:</span> <span class="s">github/codeql-action/analyze@v1</span>

</code></pre></div></div><p>Notes:<ul><li>Lines 6 - 9: We define an array (matrix) of languages - in this case, just <code class="language-plaintext highlighter-rouge">python</code>. <code class="language-plaintext highlighter-rouge">fail-fast</code> is set to <code class="language-plaintext highlighter-rouge">false</code> for multiple languages: if one fails, we want the others to run to completion rather than aborting all the jobs.<li>Lines 12/13: We checkout the repo - nothing special here<li>Lines 16 - 19: We initialize the CodeQL scanner - this sets up the interception calls so that CodeQL can build a database of our code as we compile. This step would cause the entire job to “fan out” to multiple jobs if we had more than 1 language specified.<li>Lines 21/22: For Python we don’t run a compilation, so I’ve commented out the <code class="language-plaintext highlighter-rouge">autobuild</code> step. If you’re using a compiled language like C++ or C#, the <code class="language-plaintext highlighter-rouge">autobuild</code> will attempt to build your code. If this fails, you can swap it out for your own set of steps to build your code.<li>Lines 24/25: This is where CodeQL will run a scan using a default set of queries</ul><p>This already gets us a good way into integrating security into our pipelines. Without having to understand CodeQL or write our own custom queries, we can start scanning our code on whatever trigger makes sense. Typically, you want to scan on merges into your main branch. You may also want to add a scheduled scan so that the latest suites are run against your code even if it hasn’t changed.<h2 id="customizing-scans">Customizing Scans</h2><p>There are a couple of levels of customizations for scanning. The easiest are customizing the suites and customizing the paths to include in your scans.<p>To do this, add a yml file to your repo - you can place it anywhere, but convention is to place this file in <code class="language-plaintext highlighter-rouge">.github/codeql</code> inside your repo. Let’s look at this simple config:<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Custom</span><span class="nv"> </span><span class="s">CodeQL</span><span class="nv"> </span><span class="s">Config"</span>
    
    <span class="na">queries</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">security-and-quality</span>
    
    <span class="na">paths</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">src</span>
    
    <span class="na">paths-ignore</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">src/node_modules</span>
    <span class="pi">-</span> <span class="s1">'</span><span class="s">**/*.test.js'</span>

</code></pre></div></div><p>Notes:<ul><li>Line 1: we specifying a name for this configuration<li>Line 4: we customize the scans to use the <code class="language-plaintext highlighter-rouge">security-and-quality</code> suite (the default is just <code class="language-plaintext highlighter-rouge">security-extended</code> which does not include code quality scans)<li>Lines 6 - 11: we use <code class="language-plaintext highlighter-rouge">paths</code> and <code class="language-plaintext highlighter-rouge">paths-ignore</code> to specify which folders should be included or ignored in the scans</ul><p>Ignoring paths is useful when you want to exclude test code or 3rd party libraries: though you’ll want to integrate <a href="https://dependabot.com/">Dependabot</a>to ensure you’re scanning 3rd party libraries for vulnerabilities! Fortunately Dependabot is automatically enabled for public repos on GitHub.<p>Next, we update the <code class="language-plaintext highlighter-rouge">codeql-action/init</code> task to tell it to use our custom config file:<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Initialize CodeQL</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">github/codeql-action/init@v1</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">languages</span><span class="pi">:</span> <span class="s">${{ matrix.language }}</span>
        <span class="na">config-file</span><span class="pi">:</span> <span class="s">./.github/codeql/codeql-config.yml</span>

</code></pre></div></div><p>Now when scans are performed, CodeQL will read in the config file and configure itself according to our settings.<h2 id="custom-queries">Custom Queries</h2><p>We can, however, also create custom queries. As I mentioned previously, CodeQL is a strange and arcane language, so this is only recommended for advanced scenarios and users.<p>There are two considerations with creating custom queries: firstly, the development environment. You need to create and run the queries locally. Once you’ve created a query, you can integrate it into your pipeline with some more config customization.<h3 id="local-development">Local Development</h3><p>To develop queries locally, you should install <a href="https://code.visualstudio.com/">VSCode</a>. After that, install the <a href="https://codeql.github.com/docs/codeql-for-visual-studio-code/">CodeQL extension</a>. If you don’t have any code to work on, you can install the <a href="https://codeql.github.com/docs/codeql-for-visual-studio-code/setting-up-codeql-in-visual-studio-code/#starter-workspace">starter workspace</a>. However, I want to show you how you can get CodeQL working on <em>your</em> code.<p>The trick is to clone the CodeQL core libraries <em>to your VSCode workspace</em>. Clone your repo locally and open it in VSCode. Then clone the <a href="https://github.com/github/codeql">CodeQL repo</a> to a location on your machine (not inside your repo). Finally, use <code class="language-plaintext highlighter-rouge">File-&gt;Add Folder to Workspace</code> to add the codeQL folder to your VSCode workspace. Your Workspace explorer should look something like this:<figure class="kg-card kg-image-card kg-card-hascaption"><img src="/assets/images/2021/2/91547_image.png" class="kg-image" alt="" loading="lazy" /><figcaption>Workspace Explorer after importing CodeQL libraries</figcaption></figure><p>Now you need to create a code database. In a console, <code class="language-plaintext highlighter-rouge">cd</code> to your repo directory and run the following command:<p><code class="language-plaintext highlighter-rouge">codeql database create codeqldb --language=python</code><p>Of course you’ll have to update the <code class="language-plaintext highlighter-rouge">--language</code> setting to the appropriate language. This will create a code database inside a folder called <code class="language-plaintext highlighter-rouge">codeqldb</code> (you can customize that name too if needed). Don’t forget to add this folder to your <code class="language-plaintext highlighter-rouge">.gitignore</code> file! In your CI/CD workflows, CodeQL will create a new database from the latest code, so you don’t want this database in source control.<p>Now you can open your code database in the CodeQL extension. Click on the <code class="language-plaintext highlighter-rouge">CodeQL</code> icon in the extension pane. In the <code class="language-plaintext highlighter-rouge">DATABASES</code> section, click <code class="language-plaintext highlighter-rouge">Add from folder</code> and browse to the folder above - in my case, <code class="language-plaintext highlighter-rouge">codeqldb</code>. It should import the database and show a check-mark:<figure class="kg-card kg-image-card kg-card-hascaption"><img src="/assets/images/2021/2/91552_image.png" class="kg-image" alt="" loading="lazy" /><figcaption>Importing the code database</figcaption></figure><p>Now you can run queries that you write against the code database.<h3 id="writing-codeql-for-code-scanning">Writing CodeQL for Code Scanning</h3><p>A full CodeQL tutorial is beyond the scope of this post, but you can follow these fun <a href="https://codeql.github.com/docs/writing-codeql-queries/ql-tutorials/">detective tutorials</a> here. They’re good for introducing CodeQL concepts, but mapping these to actual code is a challenge.<p>If you just want to analyze your code, you can output whatever you want from a custom query. However, for custom queries to work in a pipeline, they must output specific values.<p>There are two kinds of query: <code class="language-plaintext highlighter-rouge">problem</code> and <code class="language-plaintext highlighter-rouge">path-problem</code>. <code class="language-plaintext highlighter-rouge">problem</code> is used for detecting issues in a specific location in the code, while <code class="language-plaintext highlighter-rouge">path-problem</code> is used to analyze flow between sources and sinks.<p>For <code class="language-plaintext highlighter-rouge">problem</code> queries, we must only output two values: a CodeQL object and a description string. You’ll also want to add meaningful metadata to describe what the query is doing - the metadata is used to mark up results in the repo itself. There is also the ability to write <a href="https://codeql.github.com/docs/writing-codeql-queries/query-help-files/">CodeQL help files</a> that can guide developers on what the query is detecting and include examples of how to fix issues and links to CVEs and other useful information. Unfortunately, help files only render for standard queries, and not for custom queries.<h3 id="example-codeql-query">Example CodeQL Query</h3><p>I was working with a customer that wanted to ensure that files are deleted in a certain way. As a naïve check, we wanted to find all calls to <code class="language-plaintext highlighter-rouge">shutil.rmtree()</code> in the code base and surface them as warnings for review. Here’s the <code class="language-plaintext highlighter-rouge">problem</code> CodeQL query we wrote:<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    /**
    * @id python/call-to-shutil-rmtree
    * @name Use of shutil.rmtree
    * @description We have specific ways to delete files - this query
    * notifies when there are calls to `shutil.rmtree` so
    * that we can revue how deletion is done.
    * @kind problem
    * @problem.severity warning
    * @precision high
    * @tags correctness
    * rmtree
    * 
    */
    
    import python
    
    from ControlFlowNode call, Value eval
    where eval = Value::named("shutil.rmtree") and
          call = eval.getACall()
    select call, "Call to 'shutil.rmtree' detected."

</code></pre></div></div><p>Let’s first examine the metadata:<ul><li>Line 2 - 4: we specify an <code class="language-plaintext highlighter-rouge">id</code>, <code class="language-plaintext highlighter-rouge">name</code> and <code class="language-plaintext highlighter-rouge">description</code> for this query<li>Line 7: we specify that this is a <code class="language-plaintext highlighter-rouge">problem</code> query (as opposed to a <code class="language-plaintext highlighter-rouge">path-problem</code>)<li>Line 8: we specify the <code class="language-plaintext highlighter-rouge">severity</code> of this query - in this case we just wanted to surface this as a <code class="language-plaintext highlighter-rouge">warning</code><li>Line 9: we specify the <code class="language-plaintext highlighter-rouge">precision</code> is <code class="language-plaintext highlighter-rouge">high</code> since we will not get many false positives for this query<li>Line 10/11: we add tags that can be used to filter/analyze results</ul><p>We can now look at the query itself:<ul><li>Line 15: we import the <code class="language-plaintext highlighter-rouge">python</code> core libraries that contain definitions about python programs and constructs<li>Line 17: we are looking for <code class="language-plaintext highlighter-rouge">Value</code> objects as well as <code class="language-plaintext highlighter-rouge">ControlFlowNode</code> nodes<li>Line 18/19: we are looking for any <code class="language-plaintext highlighter-rouge">call</code> that is targeting <code class="language-plaintext highlighter-rouge">shutil.rmtree</code> either directly or indirectly<li>Line 20: we select the <code class="language-plaintext highlighter-rouge">call</code> object and specify a string message for matches</ul><p>In VSCode, we write this query in a <code class="language-plaintext highlighter-rouge">.ql</code> file. This file can reside anywhere, but conventionally we should put it into the <code class="language-plaintext highlighter-rouge">.github/codeql/custom-queries/&lt;language&gt;</code> folder (where language is one of the supported CodeQL languages).<p>We can test this against our code by right-clicking the file and selecting <code class="language-plaintext highlighter-rouge">CodeQL: Run Query</code>:<figure class="kg-card kg-image-card kg-card-hascaption"><img src="/assets/images/2021/2/91643_image.png" class="kg-image" alt="" loading="lazy" /><figcaption>Running a query</figcaption></figure><p>Assuming everything works, we should see results:<figure class="kg-card kg-image-card kg-width-wide kg-card-hascaption"><img src="/assets/images/2021/2/91645_image.png" class="kg-image" alt="" loading="lazy" /><figcaption>Local VSCode CodeQL results</figcaption></figure><p>In the results pane on the right, we can see the message text as well as a link (this is generates from the object we selected). Clicking on the link will navigate us to the location of that object in the code.<blockquote><p>Note: This does not simply do a regex match - CodeQL understands syntax, so it will find references to shutil.rmtree even if you try to obfuscate it by creating a var for shutil and calling var.rmtree. It will also exclude functions called rmtree that are not defined in shutil.</blockquote><p>When this is run against a codebase that contains calls to <code class="language-plaintext highlighter-rouge">shutil.rmtree</code>, we’ll see alerts like this in the CodeQL scanning alerts section of the Security tab in the repo:<figure class="kg-card kg-image-card kg-width-wide kg-card-hascaption"><img src="/assets/images/2021/2/91640_image.png" class="kg-image" alt="" loading="lazy" /><figcaption>Results of matches to CodeQL queries</figcaption></figure><h2 id="custom-queries-in-your-action">Custom Queries in Your Action</h2><p>Now that we have a query, we need to customize the CodeQL config to tell the engine to include our query when performing a scan.<p>The first thing we need to do is create a <code class="language-plaintext highlighter-rouge">qlpack</code> file - this tells the CodeQL engine where to find any dependencies. In our case, we have a dependency on the <code class="language-plaintext highlighter-rouge">python</code> core libs, so we create a <code class="language-plaintext highlighter-rouge">qlpack</code> file like so:<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Custom Python Queries</span>
    <span class="na">version</span><span class="pi">:</span> <span class="s">0.0.0</span>
    <span class="na">libraryPathDependencies</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">codeql-python</span>

</code></pre></div></div><p>This specifies a <code class="language-plaintext highlighter-rouge">name</code> for the pack (which is any query in this folder, so we put the <code class="language-plaintext highlighter-rouge">qlpack</code> file in the <code class="language-plaintext highlighter-rouge">.github/codeql/custom-queries/python</code> folder). We also specify a <code class="language-plaintext highlighter-rouge">version</code> and list the <code class="language-plaintext highlighter-rouge">libraryPathDependencies</code>.<p>Next, we update the <code class="language-plaintext highlighter-rouge">codeql-config.yml</code> file to look as follows:<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Custom</span><span class="nv"> </span><span class="s">CodeQL</span><span class="nv"> </span><span class="s">Config"</span>
    
    <span class="na">disable-default-queries</span><span class="pi">:</span> <span class="no">true</span>
    
    <span class="na">queries</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">security-and-quality</span>
    <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">./.github/codeql/custom-queries/python</span>

</code></pre></div></div><p>We disable the default queries (so that we don’t get duplicates) and specify that we want to run the <code class="language-plaintext highlighter-rouge">security-and-quality</code> suite as well as the custom queries in the <code class="language-plaintext highlighter-rouge">.github/codeql/custom-queries/python</code> folder.<p>That’s it! Now we’ll get alerts as shown above.<h3 id="repo">Repo</h3><p>The code I used can be found in <a href="https://github.com/10thmagnitude/custom-codeql-python">this repo</a>.<blockquote><p>You cannot see the security alerts unless you are a repo owner, so if you want to follow along with this and see the results, you’ll have to fork the repo and then enable Actions (by default Actions are disabled on forks).</blockquote><h2 id="conclusion">Conclusion</h2><p>CodeQL is a powerful tool that can be incorporated fairly easily into your daily workflow. By using the standard queries, you get a strong foundation for securing your code.<p>If you have security professionals who can author CodeQL queries, you can integrate those queries into your pipelines to customize the scanning.<p>Unfortunately, the documentation for CodeQL, while extensive, proved to be a bit hard to apply to real-world examples. I also spent several hours trying to figure out why my <code class="language-plaintext highlighter-rouge">qhelp</code> file was not rendering - only to be informed by a GitHub engineer that custom query <code class="language-plaintext highlighter-rouge">qhelp</code> rendering is not currently supported - something the documentation does not mention anywhere.<p>However, assuming you can get a grasp on CodeQL, it is easy to integrate into scanning Actions. CodeQL is a great tool for shifting security left, so use it!<p>Happy securing!<blockquote><p>Post image from ShutterStock</blockquote></article><hr class="dingbat related mb6" /><aside class="comments related" role="complementary"><h2 class="hr-bottom">Comments</h2><div id="giscus"><div></div></div><script> function toggle_giscus() { const c = document.body.classList; const dark = c.contains("dark-mode") || "_sunset" in window && !c.contains("light-mode") && matchMedia("(prefers-color-scheme: dark)").matches; const theme = dark ? "dark" : "light"; const scriptEl = document.createElement("script"); scriptEl.src = "https://giscus.app/client.js"; scriptEl.setAttribute("data-repo", "colindembovsky/colindembovsky.github.io"); scriptEl.setAttribute("data-repo-id", "MDEwOlJlcG9zaXRvcnk0MDczMjI3MjU="); scriptEl.setAttribute("data-category", "Giscussions"); scriptEl.setAttribute("data-category-id", "DIC_kwDOGEdAZc4B_F18"); scriptEl.setAttribute("data-mapping", "pathname"); scriptEl.setAttribute("data-reactions-enabled", "1"); scriptEl.setAttribute("data-emit-metadata", "colindembovsky/colindembovsky.github.io"); scriptEl.setAttribute("data-theme", theme); scriptEl.setAttribute("crossorigin", "anonymous"); const container = document.getElementById("giscus"); const old = container.firstElementChild; container.removeChild(old); container.appendChild(scriptEl); } document.addEventListener("hydejack-dark-mode-toggle", function() { toggle_giscus(); }); toggle_giscus(); </script></aside><aside class="other-projects related mb0" role="complementary"><h2>Related Posts</h2><div class="columns"><div class="column column-1-2"><article class="project-card"> <a href="/pages/colindembovsky/actions-authenticate-to-azure-without-a-secret/" class="no-hover no-print-link flip-project" tabindex="-1"><div class="project-card-img aspect-ratio sixteen-nine flip-project-img"> <img src="/pages/colindembovsky/assets/images/2021/11/oidc/Data_security_27.jpg" alt="GitHub Actions: Authenticate to Azure Without a Secret using OIDC" width="864" height="486" loading="lazy"/></div></a><h3 class="project-card-title flip-project-title"> <a href="/pages/colindembovsky/actions-authenticate-to-azure-without-a-secret/" class="flip-title">GitHub Actions: Authenticate to Azure Without a Secret using OIDC</a></h3><p class="project-card-text fine" property="disambiguatingDescription"> Authenticating to Azure in GitHub Actions requires a secret for a Service Principal. However, at Universe, GitHub released a new OIDC-based authentication mechanism that eliminates the need for secrets in secure deployments. <a class="fill-card no-hover" href="/pages/colindembovsky/actions-authenticate-to-azure-without-a-secret/" tabindex="-1"><span class="sr-only">Continue reading GitHub Actions: Authenticate to Azure Without a Secret using OIDC</span></a></article></div><div class="column column-1-2"><article class="project-card"> <a href="/pages/colindembovsky/enforcing-reusable-workflows-for-standardization/" class="no-hover no-print-link flip-project" tabindex="-1"><div class="project-card-img aspect-ratio sixteen-nine flip-project-img"> <img src="/pages/colindembovsky/assets/images/2021/11/compliance-reusable/hacker.jpg" alt="Enforcing Reusable Workflows for Standardization" width="864" height="486" loading="lazy"/></div></a><h3 class="project-card-title flip-project-title"> <a href="/pages/colindembovsky/enforcing-reusable-workflows-for-standardization/" class="flip-title">Enforcing Reusable Workflows for Standardization</a></h3><p class="project-card-text fine" property="disambiguatingDescription"> Reusable workflows are great, but how do you ensure that teams are using your reusable workflows? In this post I show how you can structure repos, teams and environments to ensure standardization for your workflows. <a class="fill-card no-hover" href="/pages/colindembovsky/enforcing-reusable-workflows-for-standardization/" tabindex="-1"><span class="sr-only">Continue reading Enforcing Reusable Workflows for Standardization</span></a></article></div></div></aside><aside class="related mb4" role="complementary"><h2 class="hr-bottom">Random Posts</h2><ul class="related-posts"><li class="h4"> <a href="/pages/colindembovsky/testing-windows-8-applications/" class="flip-title"><span>Testing Windows 8 Applications</span></a> <time class="faded fine" datetime="2013-05-29T15:02:00+00:00">29 May 2013</time><li class="h4"> <a href="/pages/colindembovsky/container-devops-beyond-build-part-4-telemetry-with-prometheus/" class="flip-title"><span>Container DevOps: Beyond Build (Part 4) - Telemetry with Prometheus</span></a> <time class="faded fine" datetime="2019-05-08T09:37:11+00:00">08 May 2019</time><li class="h4"> <a href="/pages/colindembovsky/azdo-create-work-item-action/" class="flip-title"><span>Create Azure DevOps Work Item Action</span></a> <time class="faded fine" datetime="2021-09-01T17:22:01+00:00">01 Sep 2021</time></ul></aside><footer class="content" role="contentinfo"><hr/><p><small class="copyright">© 2021. All rights reserved. </small><hr class="sr-only"/></footer></main><hy-drawer id="_drawer" class="" side="left" threshold="10" noscroll ><header id="_sidebar" class="sidebar" role="banner"><div class="sidebar-bg sidebar-overlay" style="background-color:rgb(5,19,24);background-image:url(/pages/colindembovsky/assets/img/sidebar-bg.jpg)"></div><div class="sidebar-sticky"><div class="sidebar-about"> <a class="no-hover" href="/pages/colindembovsky/" tabindex="-1"> <img src="/pages/colindembovsky/assets/img/logo.png" class="avatar" alt="Colin's ALM Corner" width="120" height="120" loading="lazy" /> </a> <a class="sidebar-title" href="/pages/colindembovsky/"><h2 class="h1">Colin's ALM Corner</h2></a><p class=""> DevOpsology &amp; GitHub. <br /> <em>Opinions my own</em>.</div><nav class="sidebar-nav heading" role="navigation"> <span class="sr-only">Navigation:</span><ul><li> <a id="_drawer--opened" href="/pages/colindembovsky/tags/" class="sidebar-nav-item " > Tags </a><li> <a href="/pages/colindembovsky/about/" class="sidebar-nav-item " > About </a></ul></nav><div class="sidebar-social"> <span class="sr-only">Social:</span><ul><li> <a href="https://twitter.com/colindembovsky" title="Twitter" class="no-mark-external"> <span class="icon-twitter"></span> <span class="sr-only">Twitter</span> </a><li> <a href="https://github.com/colindembovsky" title="GitHub" class="no-mark-external"> <span class="icon-github"></span> <span class="sr-only">GitHub</span> </a><li> <a href="https://colinsalmcorner.com/feed.xml" title="RSS" class="no-mark-external"> <span class="icon-rss2"></span> <span class="sr-only">RSS</span> </a></ul></div></div></header></hy-drawer><hr class="sr-only" hidden /> </hy-push-state> <!--[if gt IE 10]><!----> <script nomodule>!function(){var t,n=document.createElement("script");!("noModule"in n)&&"onbeforeload"in n&&(t=!1,document.addEventListener("beforeload",function(e){if(e.target===n)t=!0;else if(!e.target.hasAttribute("nomodule")||!t)return;e.preventDefault()},!0),n.type="module",n.src=".",document.head.appendChild(n),n.remove())}(); </script> <script src="/pages/colindembovsky/assets/js/hydejack-9.1.4.js" type="module"></script> <script src="/pages/colindembovsky/assets/js/LEGACY-hydejack-9.1.4.js" nomodule defer></script> <script type="module"> if ('serviceWorker' in navigator) { /**/ navigator.serviceWorker.getRegistration() .then(r => r.unregister()) .catch(() => {}); /**/ } </script> <!--<![endif]--><div hidden><h2 class="sr-only">Templates (for web app):</h2><clap-config> <clap-text at="1">Keep going!</clap-text> <clap-text at="2">Keep going ×2!</clap-text> <clap-text at="3">Give me more!</clap-text> <clap-text at="5">Thank you, thank you</clap-text> <clap-text at="7">Far too kind!</clap-text> <clap-text at="10">Never gonna give me up?</clap-text> <clap-text at="14">Never gonna let me down?</clap-text> <clap-text at="20">Turn around and desert me!</clap-text> <clap-text at="30">You're an addict!</clap-text> <clap-text at="40">Son of a clapper!</clap-text> <clap-text at="50">No way</clap-text> <clap-text at="60">Go back to work!</clap-text> <clap-text at="70">This is getting out of <em>hand</em></clap-text> <clap-text at="80">Unbelievable</clap-text> <clap-text at="90">PREPOSTEROUS</clap-text> <clap-text at="100">I N S A N I T Y</clap-text> <clap-text at="185"><span style="font-family:monospace">FEED ME A STRAY CAT</span></clap-text> </clap-config> <template id="_animation-template"><div class="animation-main fixed-top"><nav id="breadcrumbs" class="screen-only"><ul></ul></nav><div class="content"><div class="page"></div></div></div></template> <template id="_loading-template"><div class="loading nav-btn fr"> <span class="sr-only">Loading…</span> <span class="icon-cog"></span></div></template> <template id="_error-template"><div class="page"><h1 class="page-title">Error</h1><p class="lead"> Sorry, an error occurred while loading <a class="this-link" href=""></a>.</div></template> <template id="_permalink-template"> <a href="#" class="permalink"> <span class="sr-only">Permalink</span> <span class="content-hash"></span> </a> </template> <template id="_cookies-banner-template"><div id="_cookies-banner" class="navbar fixed-bottom CookiesOK"><div class="content"><div class="nav-btn-bar"> <small class="faded"> <span>This site uses cookies. <a href="/cookies-policy/">Cookies Policy</a>. </span> <button id="_cookies-ok" class="btn btn-primary btn-sm">Okay</button> </small></div></div></div></template> <template id="_dark-mode-template"> <button id="_dark-mode" class="nav-btn no-hover" > <span class="sr-only">Dark Mode</span> <span class="icon-brightness-contrast"></span> </button> </template> <template id="_search-template"> <button id="_search" class="nav-btn no-hover"> <label class="sr-only" for="_search-input">Search</label> <span class="icon-search"></span> </button><div id="_search-box"><div class="nav-btn"> <span class="icon-search"></span></div><input id="_search-input" type="search" class="form-control form-control-lg nav-btn" placeholder="Type something…" /> <button type="reset" class="nav-btn no-hover"> <span class="sr-only">Close</span> <span class="icon-cross"></span> </button></div><div id="_hits"></div></template></div></html>
